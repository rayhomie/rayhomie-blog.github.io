(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{390:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ä»é›¶æ­å»ºgitlabciç¯å¢ƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»é›¶æ­å»ºgitlabciç¯å¢ƒ"}},[t._v("#")]),t._v(" ä»é›¶æ­å»ºgitlabciç¯å¢ƒ")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.bilibili.com/video/BV1iv41177zU",target:"_blank",rel:"noopener noreferrer"}},[t._v("å­¦ä¹ é€”å¾„"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"æ­å»ºç¯å¢ƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ­å»ºç¯å¢ƒ"}},[t._v("#")]),t._v(" æ­å»ºç¯å¢ƒ")]),t._v(" "),s("p",[t._v("å°†gitlabé•œåƒæ‹‰åˆ°æœåŠ¡å™¨ä¸Šè·‘èµ·æ¥ã€‚")]),t._v(" "),s("h3",{attrs:{id:"_1ã€‘æ‹‰å–é•œåƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1ã€‘æ‹‰å–é•œåƒ"}},[t._v("#")]),t._v(" 1ã€‘æ‹‰å–é•œåƒ")]),t._v(" "),s("ul",[s("li",[t._v("ä½¿ç”¨dockeræ‹‰å–"),s("code",[t._v("gitlab/gitlab-ce")]),t._v("çš„é•œåƒ")]),t._v(" "),s("li",[t._v("dockeræ‹‰å–"),s("code",[t._v("nginx")]),t._v("é•œåƒ")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#æŸ¥çœ‹æœ¬åœ°é•œåƒ")]),t._v("\ndocker images\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ä»è¿œç¨‹ä»“åº“æ‹‰å–gitlab/gitlab-ceçš„é•œåƒ")]),t._v("\ndocker pull gitlab/gitlab-ce\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ä»è¿œç¨‹ä»“åº“æ‹‰å–nginxé•œåƒ")]),t._v("\ndocker pull nginx\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker images\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#REPOSITORY         TAG       IMAGE ID       CREATED      SIZE")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#node               latest    8f1b7f0dfc2f   5 days ago   907MB")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#nginx              latest    08b152afcfae   5 days ago   133MB")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gitlab/gitlab-ce   latest    75d591b81fd7   6 days ago   2.23GB")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2ã€‘è¿è¡Œé•œåƒåˆ°å®¹å™¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2ã€‘è¿è¡Œé•œåƒåˆ°å®¹å™¨"}},[t._v("#")]),t._v(" 2ã€‘è¿è¡Œé•œåƒåˆ°å®¹å™¨")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker run --detach --hostname gitlab.rayhomie.icu --publish "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(":443 --publish "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":80 --publish "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("222")]),t._v(":22 --name gitlab --restart always --volume /srv/gitlab/config:/etc/gitlab --volume /srv/gitlab/logs:/var/log/gitlab --volume /srv/gitlab/data:/var/opt/gitlab gitlab/gitlab-ce:latest\n")])])]),s("h3",{attrs:{id:"_3ã€‘æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3ã€‘æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨"}},[t._v("#")]),t._v(" 3ã€‘æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker container "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" -a\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#CONTAINER ID   IMAGE                     COMMAND             CREATED         STATUS    PORTS     NAMES")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#df62d4c44c25   gitlab/gitlab-ce:latest   "/assets/wrapper"   3 minutes ago   Created             gitlab')]),t._v("\n")])])]),s("h3",{attrs:{id:"_4ã€‘æŸ¥çœ‹å®¹å™¨åä¸ºgitlabçš„æ—¥å¿—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4ã€‘æŸ¥çœ‹å®¹å™¨åä¸ºgitlabçš„æ—¥å¿—"}},[t._v("#")]),t._v(" 4ã€‘æŸ¥çœ‹å®¹å™¨åä¸ºgitlabçš„æ—¥å¿—")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#æ‰“å°å½“å‰è¿è¡Œæ—¥å¿—")]),t._v("\ndocker logs gitlab\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å®æ—¶æ‰“å°æ—¥å¿—")]),t._v("\ndocker logs -f gitlab\n")])])]),s("h3",{attrs:{id:"_5ã€‘æˆåŠŸè¿è¡Œgitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5ã€‘æˆåŠŸè¿è¡Œgitlab"}},[t._v("#")]),t._v(" 5ã€‘æˆåŠŸè¿è¡Œgitlab")]),t._v(" "),s("p",[t._v("æ­¤æ—¶æˆ‘ä»¬å°±æˆåŠŸåœ°å°†gitlabé•œåƒè·‘åœ¨äº†æœ¬åœ°çš„dockerå®¹å™¨ä¸­ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡åœ°å€æ¥è®¿é—®gitlabç•Œé¢ã€‚")]),t._v(" "),s("h2",{attrs:{id:"gitlab-ci-cdåŸºç¡€çŸ¥è¯†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-cdåŸºç¡€çŸ¥è¯†"}},[t._v("#")]),t._v(" GitLab CI/CDåŸºç¡€çŸ¥è¯†")]),t._v(" "),s("p",[t._v("ç®€å•ç†è§£ï¼šä½†æˆ‘ä»¬æŠŠæœ¬åœ°ä»£ç æ¨åˆ°gitlabè¿œç¨‹ä»“åº“æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªæµç¨‹ï¼Œè¿™ä¸ªæµç¨‹ä¼šæ‰§è¡Œä¸€ç³»åˆ—çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡ç»„è£…èµ·æ¥å°±æ˜¯ä¸€ä¸ªpipelineï¼ˆæµæ°´çº¿ï¼‰ã€‚")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("pipeline")]),t._v("ï¼ˆæµæ°´çº¿ï¼‰")]),t._v(" "),s("li",[s("strong",[t._v("stage")]),t._v("ï¼ˆé˜¶æ®µï¼‰")]),t._v(" "),s("li",[s("strong",[t._v("job")]),t._v("ï¼ˆä»»åŠ¡ï¼‰")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/e67ebcaeeac14e8e92c43db4b8c43a90.png",alt:"gitlabcicdæ¦‚å¿µ"}})]),t._v(" "),s("p",[t._v("å¦‚ä¸Šå›¾å¯ä»¥çœ‹å‡ºè¿™å‡ ä¸ªæ¦‚å¿µä¹‹é—´çš„å…³ç³»æ˜¯ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ä¸€ä¸ª"),s("strong",[t._v("æµæ°´çº¿")]),t._v("åŒ…å«å¤šä¸ª"),s("strong",[t._v("é˜¶æ®µ")]),t._v("ï¼›")]),t._v(" "),s("li",[t._v("ä¸€ä¸ª"),s("strong",[t._v("é˜¶æ®µ")]),t._v("åŒ…å«å¤šä¸ª"),s("strong",[t._v("ä»»åŠ¡")]),t._v("ï¼›")])]),t._v(" "),s("p",[t._v("gitlabåªæ˜¯ä¸€ä¸ªä»£ç ä»“åº“ï¼ˆä»£ç ç®¡ç†å·¥å…·å¹³å°ï¼‰ï¼Œå®ƒæ˜¯ä¸ä¼šå»è·‘è¿™äº›æµæ°´çº¿ä¸Šçš„ä»»åŠ¡ã€‚æ‰€ä»¥åˆè¦å¼•å‡ºä¸€ä¸ªæ¦‚å¿µ"),s("strong",[t._v("gitlab runner")]),t._v("ï¼ˆä¸€ä¸ªå®‰è£…åœ¨æœåŠ¡å™¨ä¸Šçš„è½¯ä»¶ï¼‰ï¼Œæ‰€æœ‰çš„æˆ‘ä»¬å®šä¹‰çš„cicdçš„æ“ä½œéƒ½æ˜¯åœ¨gitlab runnerä¸Šå»è·‘ã€‚ï¼ˆgitlab runnerå°±æ˜¯ç»™cicdæä¾›ä¸€ä¸ªç¯å¢ƒï¼‰")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v(".gitlab-ci.yml")]),t._v("æ–‡ä»¶ï¼šç”¨æ¥å®šä¹‰æµæ°´çº¿ã€é˜¶æ®µã€ä»»åŠ¡ã€‚")])]),t._v(" "),s("h2",{attrs:{id:"dockerå®‰è£…gitlab-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerå®‰è£…gitlab-runner"}},[t._v("#")]),t._v(" dockerå®‰è£…GitLab Runner")]),t._v(" "),s("h3",{attrs:{id:"_1ã€‘æ‹‰å–runneré•œåƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1ã€‘æ‹‰å–runneré•œåƒ"}},[t._v("#")]),t._v(" 1ã€‘æ‹‰å–runneré•œåƒ")]),t._v(" "),s("p",[t._v("åœ¨dockerè¿œç¨‹ä»“åº“æ‹‰å–gitlab/gitlab-runneré•œåƒåˆ°æœ¬åœ°ï¼š")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#æ‹‰å–é•œåƒåˆ°æœ¬åœ°")]),t._v("\ndocker pull gitlab/gitlab-runner\n")])])]),s("h3",{attrs:{id:"_2ã€‘è¿è¡Œé•œåƒåˆ°å®¹å™¨-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2ã€‘è¿è¡Œé•œåƒåˆ°å®¹å™¨-2"}},[t._v("#")]),t._v(" 2ã€‘è¿è¡Œé•œåƒåˆ°å®¹å™¨")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker run -d --name gitlab-runner --restart always -v /srv/gitlab-runner/config:/etc/gitlab-runner -v /var/run/docker.sock:/var/run/docker.sock gitlab/gitlab-runner:latest\n")])])]),s("h3",{attrs:{id:"_3ã€‘æ³¨å†Œgitlab-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3ã€‘æ³¨å†Œgitlab-runner"}},[t._v("#")]),t._v(" 3ã€‘æ³¨å†Œgitlab runner")]),t._v(" "),s("p",[t._v("è¦ä½¿gitlab runnerå’Œgitlabäº§ç”Ÿè”ç³»ï¼Œéœ€è¦æ‰¾åˆ°æˆ‘ä»¬gitlabçš„"),s("strong",[t._v("Token")]),t._v("ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/ded7b9fce6b4470786316e3284bd80f7.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"token"}})]),t._v(" "),s("p",[t._v("ç„¶ååœ¨gitlab runnerè¿è¡Œçš„dockerå®¹å™¨ä¸­ç”¨è¿™ä¸ªTokenå»æ³¨å†Œä¸€ä¸‹ï¼Œè„šæœ¬å…·ä½“å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run --rm -v /srv/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register --non-interactive --executor "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker"')]),t._v(" --docker-image alpine:latest --url "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://gitlab.xxxx.com/"')]),t._v(" --registration-token "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vtizNrFzQKFacsSMxsJX"')]),t._v(" --description "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"first-register-runner"')]),t._v(" --tag-list "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-cicd,dockercicd"')]),t._v(" --run-untagged"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v(" --locked"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v(" --access-level"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"not_protected"')]),t._v("\n")])])]),s("ul",[s("li",[t._v("urlå‚æ•°æ˜¯æˆ‘ä»¬gitlabçš„åœ°å€")]),t._v(" "),s("li",[t._v("registration-tokenå‚æ•°æ˜¯ä¸Šå›¾gitlabçš„token")]),t._v(" "),s("li",[t._v("tag-listå‚æ•°æ˜¯æ³¨å†Œè¿™ä¸ªrunnerçš„æ ‡ç­¾ï¼ˆåé¢å¯ç”¨äºæŒ‡å®šå…·ä½“å“ªä¸ªrunnerå»æ‰§è¡Œæµæ°´çº¿ä»»åŠ¡ï¼‰")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/32b8717e7f8644c6bdd5b2096b94b4a2.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"runner"}})]),t._v(" "),s("h2",{attrs:{id:"gitlab-ci-ymlçš„ç¼–å†™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-ymlçš„ç¼–å†™"}},[t._v("#")]),t._v(" .gitlab-ci.ymlçš„ç¼–å†™")]),t._v(" "),s("h3",{attrs:{id:"åŸºæœ¬å…³é”®è¯ä½¿ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŸºæœ¬å…³é”®è¯ä½¿ç”¨"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://blog.csdn.net/github_35631540/article/details/111029151",target:"_blank",rel:"noopener noreferrer"}},[t._v("åŸºæœ¬å…³é”®è¯ä½¿ç”¨"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/",target:"_blank",rel:"noopener noreferrer"}},[t._v("å®˜æ–¹æ–‡æ¡£"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#script",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("script")]),s("OutboundLink")],1),t._v("ï¼šè®©gitlab runnerå»æ‰§è¡Œshellè„šæœ¬ï¼ˆæ‰€æœ‰çš„ä»»åŠ¡éƒ½éœ€è¦æœ‰scriptå…³é”®å­—å»æ‰§è¡Œï¼‰")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#stages",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("stages")]),s("OutboundLink")],1),t._v("ï¼šå…¨å±€è‡ªå®šä¹‰é˜¶æ®µ")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#stage",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("stage")]),s("OutboundLink")],1),t._v("ï¼šåœ¨æ¯ä¸ª"),s("strong",[t._v("jobï¼ˆä»»åŠ¡ï¼‰ä¸­å®šä¹‰")]),t._v("è¯¥ä»»åŠ¡å±äºå“ªä¸ªstageé˜¶æ®µã€‚stage æ˜¯é˜¶æ®µçš„æ„æ€ï¼Œç”¨äºå½’æ¡£ä¸€éƒ¨åˆ†çš„jobï¼ŒæŒ‰ç…§å®šä¹‰çš„stageé¡ºåºæ¥æ‰§è¡Œã€‚ï¼ˆé»˜è®¤çš„stageæœ‰"),s("code",[t._v(".pre")]),t._v("ï¼Œ"),s("code",[t._v("build")]),t._v("ï¼Œ"),s("code",[t._v("test")]),t._v("ï¼Œ"),s("code",[t._v("deploy")]),t._v("ï¼Œ"),s("code",[t._v(".post")]),t._v("ï¼‰jobæ‰§è¡Œçš„é¡ºåºä¸æ˜¯æŒ‰ç…§ç¼–å†™çš„é¡ºåºï¼Œå¤§ä½“ä¸Šæ˜¯æŒ‰ç…§stageå®šä¹‰çš„é¡ºåºæ¥æ‰§è¡Œçš„,æ³¨æ„æ˜¯å¤§ä½“ï¼Œä¹Ÿæœ‰ä¾‹å¤–çš„æƒ…å†µã€‚")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#retry",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("retry")]),s("OutboundLink")],1),t._v("ï¼šæœ‰å¯èƒ½è¿™ä¸ªä»»åŠ¡ä¼šå¤±è´¥ï¼Œéœ€è¦æœ‰ä¸ªé‡è¯•çš„æœºåˆ¶ï¼ˆ"),s("code",[t._v("retry:2")]),t._v("æŒ‡å®šå¦‚æœå¤±è´¥é‡è¯•2æ¬¡ï¼Œæœ€å¤šè®¾ç½®ä¸ºé‡è¯•2æ¬¡ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šè¿è¡Œ3æ¬¡ï¼‰")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#image",target:"_blank",rel:"noopener noreferrer"}},[t._v("image"),s("OutboundLink")],1),t._v("ï¼šæŒ‡å®šä¸€ä¸ªåŸºç¡€Dockeré•œåƒä½œä¸ºåŸºç¡€è¿è¡Œç¯å¢ƒï¼Œç»å¸¸ç”¨åˆ°çš„é•œåƒæœ‰nodeã€javaã€pythonã€docker")]),t._v(" "),s("li",[s("strong",[t._v("tags")]),t._v("ï¼š"),s("strong",[t._v("tags å…³é”®è¯æ˜¯ç”¨äºæŒ‡å®šRunner")]),t._v("ï¼Œtagsçš„å–å€¼èŒƒå›´æ˜¯åœ¨è¯¥é¡¹ç›®å¯è§çš„runner tagsä¸­")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#only--except",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("only")]),s("OutboundLink")],1),t._v("ã€exceptï¼šé™å®šå½“å‰ä»»åŠ¡æ‰§è¡Œçš„æ¡ä»¶ï¼ˆé™å®šåˆ†æ”¯ç­‰ï¼‰")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#when",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("when")]),s("OutboundLink")],1),t._v("ï¼šwhenå…³é”®è¯æ˜¯å®ç°åœ¨å‘ç”Ÿæ•…éšœæˆ–å°½ç®¡å‘ç”Ÿæ•…éšœæ—¶ä»èƒ½è¿è¡Œçš„ä½œä¸šï¼Œæ¯”å¦‚ä½ è¦åœ¨ä»»åŠ¡å¤±è´¥åéœ€è¦å‡ºå‘ä¸€ä¸ªjobï¼Œæˆ–è€…ä½ éœ€è¦æ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡ï¼Œæˆ–è€…å½“ä½ ä¸€ä¸ªä»»åŠ¡æ‰§è¡ŒæˆåŠŸåï¼Œæ‰§è¡Œå¦ä¸€ä¸ªä»»åŠ¡ã€‚\n"),s("ul",[s("li",[t._v("on_successï¼šæ‰€æœ‰ä»»åŠ¡æ‰§è¡ŒæˆåŠŸå")]),t._v(" "),s("li",[t._v("on_failureï¼šå½“è‡³å°‘ä¸€ä¸ªä»»åŠ¡å¤±è´¥å")]),t._v(" "),s("li",[t._v("alwaysï¼šæ‰§è¡Œä½œä¸šï¼Œè€Œä¸è€ƒè™‘ä½œä¸šåœ¨æ—©æœŸé˜¶æ®µçš„çŠ¶æ€")]),t._v(" "),s("li",[t._v("manualï¼šæ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡")]),t._v(" "),s("li",[t._v("delayedï¼šå»¶è¿Ÿæ‰§è¡Œä»»åŠ¡")]),t._v(" "),s("li",[t._v("neverï¼šåœ¨"),s("code",[t._v("rules")]),t._v("ä¸­ä¸æ’é™¤æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåœ¨"),s("code",[t._v("workflow:rules")]),t._v("ä¸å…è®¸çš„æµæ°´çº¿")])])]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#cache",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("cache")]),s("OutboundLink")],1),t._v("ï¼šæŠŠä¸€äº›æ–‡ä»¶åˆ—è¡¨ä¿å­˜åˆ°ç¼“å­˜ä¸­ï¼Œåœ¨å„ä¸ªä»»åŠ¡ä¹‹é—´äº’ç›¸ä¼ é€’ã€‚ç¼“å­˜æ˜¯å°†å½“å‰å·¥ä½œç¯å¢ƒç›®å½•ä¸­çš„ä¸€äº›æ–‡ä»¶ï¼Œä¸€äº›æ–‡ä»¶å¤¹å­˜å‚¨èµ·æ¥ï¼Œç”¨äºåœ¨å„ä¸ªä»»åŠ¡åˆå§‹åŒ–çš„æ—¶å€™æ¢å¤")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/#artifacts",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("artifacts")]),s("OutboundLink")],1),t._v("ï¼šæˆåŠŸæ—¶é™„åŠ åˆ°ä½œä¸šçš„æ–‡ä»¶å’Œç›®å½•åˆ—è¡¨ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("variables")]),t._v("ï¼šåœ¨.gitlab-ci.ymlæ–‡ä»¶ä¸­å®šä¹‰å…¨å±€å˜é‡æˆ–è€…å±€éƒ¨å˜é‡ã€‚ï¼ˆåœ¨å…¨å±€å®šä¹‰å³å…¨å±€å˜é‡ï¼Œåœ¨ä»»åŠ¡ä¸­å•ç‹¬å®šä¹‰å³å±€éƒ¨å˜é‡ï¼‰")]),t._v(" "),s("li",[t._v("releaseï¼šè‡ªåŠ¨åŒ–å‘å¸ƒåŒ…")]),t._v(" "),s("li",[t._v("timeoutï¼šè®¾ç½®è¶…æ—¶æ—¶é—´")]),t._v(" "),s("li",[t._v("resource_groupï¼šç¡®ä¿ä¸€ä¸ªåˆ†æ”¯åŒæ—¶åªæœ‰ä¸€ä¸ªæµæ°´çº¿åœ¨å·¥ä½œ")]),t._v(" "),s("li",[t._v("after_script")]),t._v(" "),s("li",[t._v("allow_failure")]),t._v(" "),s("li",[t._v("before_script")]),t._v(" "),s("li",[t._v("coverage")]),t._v(" "),s("li",[t._v("dependencies")]),t._v(" "),s("li",[t._v("environment")]),t._v(" "),s("li",[t._v("extends")]),t._v(" "),s("li",[t._v("include")]),t._v(" "),s("li",[t._v("interruptible")]),t._v(" "),s("li",[t._v("pages")]),t._v(" "),s("li",[t._v("parallel")]),t._v(" "),s("li",[t._v("rules")]),t._v(" "),s("li",[t._v("services")]),t._v(" "),s("li",[t._v("trigger")])]),t._v(" "),s("h3",{attrs:{id:"stage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stage"}},[t._v("#")]),t._v(" stage")]),t._v(" "),s("p",[t._v("ç”±äº"),s("code",[t._v("build")]),t._v("åœ¨"),s("code",[t._v("test")]),t._v("ä¹‹å‰æ‰€æœ‰ä¼šå…ˆæŒ‡å‘"),s("code",[t._v("job1")]),t._v("è¿™ä¸ªä»»åŠ¡ï¼ŒåæŒ‡å‘"),s("code",[t._v("job0")]),t._v("ä»»åŠ¡ï¼šï¼ˆä¸‹é¢ğŸ‘‡ï¼šï¼‰")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deploy\n\njob 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo 'tets'\n\njob 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo 'build'\n")])])]),s("p",[t._v("ä¸‹é¢å†™äº†ä¸€ä¸ªé»˜è®¤å®˜æ–¹æä¾›stageçš„æ¡ˆä¾‹ï¼Œå«5ä¸ªjobså±äº5ä¸ªé˜¶æ®µï¼š")]),t._v(" "),s("p",[t._v("å®˜æ–¹é»˜è®¤çš„é˜¶æ®µstagesé¡ºåºæ˜¯"),s("code",[t._v(".pre")]),t._v("ï¼Œ"),s("code",[t._v("build")]),t._v("ï¼Œ"),s("code",[t._v("test")]),t._v("ï¼Œ"),s("code",[t._v("deploy")]),t._v("ï¼Œ"),s("code",[t._v(".post")])]),t._v(" "),s("p",[t._v("é»˜è®¤çš„gitlab runneråœ¨åŒä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡æ˜¯æŒ‰é¡ºåºåŒæ­¥æ‰§è¡Œçš„ï¼ˆå¦‚æœéœ€è¦ä»–æ¯ä¸ªé˜¶æ®µä»»åŠ¡å¹¶å‘æ‰§è¡Œçš„è¯ï¼Œéœ€è¦å¯¹gitlab runnerè¿›è¡Œé…ç½®ï¼‰")]),t._v(" "),s("p",[t._v("æ‰€ä»¥æˆ‘ä»¬ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼šjob1 -> job2 -> job4 -> job6 -> job3 -> job5")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" .pre\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" .post\n\njob 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .pre\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo '.pre job'\n\njob 2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'build job'\n\njob 3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'deploy job'\n   \njob 4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'test1 job'\n    \njob 5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .post\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo '.post job'\n   \njob 6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'test2 job'\n    \n")])])]),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/9591e288aa8f48489e9d714240d9eaae.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"è¯·æ·»åŠ å›¾ç‰‡æè¿°"}})]),t._v(" "),s("h3",{attrs:{id:"cache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cache"}},[t._v("#")]),t._v(" cache")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:12.6.0'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" install\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deploy\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  stage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("install\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner001\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm install\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  stage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner001\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run build\n  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  stage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner001\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'start deploy'\n")])])]),s("p",[t._v("æ­¤æ—¶è·‘æµæ°´çº¿çš„è¯ï¼Œåœ¨buildé˜¶æ®µä¼šæŠ¥é”™ï¼Œå› ä¸ºåœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡ç»“æŸæ—¶ä¼šå°†node_modulesæ–‡ä»¶å¤¹åˆ é™¤æ‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ç¼“å­˜å°†node_modulesæ–‡ä»¶å¤¹è¿›è¡Œç¼“å­˜ï¼Œç¼“å­˜çš„æ–‡ä»¶å¤¹æ‰å¯ä»¥åœ¨å„ä¸ªä»»åŠ¡ä¸­ä¸€ç›´è¢«ä½¿ç”¨ã€‚")]),t._v(" "),s("p",[t._v("ï¼ˆ"),s("strong",[t._v("ymlæ–‡ä»¶ä¸­çš„ â€œ-â€ å’Œ â€œ:â€ä¹‹åä¸€å®šè¦ç•™ä¸‹ç©ºæ ¼")]),t._v("ï¼‰")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:12.6.0'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" install\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deploy\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ç¼“å­˜node_modulesæ–‡ä»¶å¤¹ï¼Œå¹¶æŒ‡å®šå”¯ä¸€æ ‡è¯†key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hello"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ci\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules\n  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner001\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm install\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner001\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run build\n  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner001\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'start deploy'\n")])])]),s("p",[t._v("æ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„pipelineæµæ°´çº¿å·²ç»æˆåŠŸæ‰§è¡Œå®Œæˆï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/5383daa973c14ea4a67ee9cf6966e67f.png",alt:"pipline"}})]),t._v(" "),s("h4",{attrs:{id:"job-install"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#job-install"}},[t._v("#")]),t._v(" job_install")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/f18661b1b5a546da8b7368b0b881d26f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"install"}})]),t._v(" "),s("h4",{attrs:{id:"job-build"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#job-build"}},[t._v("#")]),t._v(" job_build")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/bbb3beea62eb4447a910ff251404a708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"build"}})]),t._v(" "),s("h4",{attrs:{id:"job-deploy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#job-deploy"}},[t._v("#")]),t._v(" job_deploy")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/84b614313ed24a499bac8d09e6dbdd44.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"deploy"}})]),t._v(" "),s("h3",{attrs:{id:"onlyã€when"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#onlyã€when"}},[t._v("#")]),t._v(" onlyã€when")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:12.6.0'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" install\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deploy\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ç¼“å­˜node_modulesæ–‡ä»¶å¤¹ï¼Œå¹¶æŒ‡å®šå”¯ä¸€æ ‡è¯†key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hello"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ci\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules\n  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner001\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm install\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner001\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" release  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#é™å®šåœ¨releaseåˆ†æ”¯æ‰§è¡Œ")]),t._v("\n  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner001\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'start deploy'\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manual\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#æ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/0aba7a82b9244c1b9db2bb9f53cf78f7.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"only"}})]),t._v(" "),s("h2",{attrs:{id:"dockeréƒ¨ç½²å‰ç«¯é¡¹ç›®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockeréƒ¨ç½²å‰ç«¯é¡¹ç›®"}},[t._v("#")]),t._v(" dockeréƒ¨ç½²å‰ç«¯é¡¹ç›®")]),t._v(" "),s("h3",{attrs:{id:"ä»»åŠ¡åˆ—è¡¨ï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»»åŠ¡åˆ—è¡¨ï¼š"}},[t._v("#")]),t._v(" ä»»åŠ¡åˆ—è¡¨ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("å®‰è£…nodeåŒ…")]),t._v(" "),s("li",[t._v("ç¼–è¯‘")]),t._v(" "),s("li",[t._v("dockeré•œåƒéƒ¨ç½²")])]),t._v(" "),s("p",[t._v("ä½¿ç”¨çš„å…³é”®è¯æœ‰ï¼šimageï¼Œstagesï¼Œstageï¼Œtagï¼Œscriptï¼Œcacheï¼Œdockerï¼Œbuild")]),t._v(" "),s("h3",{attrs:{id:"ç¼–å†™dockerfileï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–å†™dockerfileï¼š"}},[t._v("#")]),t._v(" ç¼–å†™Dockerfileï¼š")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("lastest as builder\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /app\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" package.json .\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" npm install "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry=http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//registry.npm.taobao.org\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" . .\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" npm run build\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" ngins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("lastest\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from=builder /app/dist /usr/share/nginx/html\n")])])]),s("h3",{attrs:{id:"ç¼–å†™-gitlab-ci-ymlï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–å†™-gitlab-ci-ymlï¼š"}},[t._v("#")]),t._v(" ç¼–å†™.gitlab-ci.ymlï¼š")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#è®¾ç½®nodeä¸ºåŸºç¡€ç¯å¢ƒé•œåƒ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("alpine\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å£°æ˜é˜¶æ®µ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" install\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" lint"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("code\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deploy\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#è®¾ç½®ç¼“å­˜")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("platform\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å®šä¹‰installä»»åŠ¡(1.é€‰å®šé˜¶æ®µã€2.runnerçš„tagsã€3.è„šæœ¬)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_install")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("001")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm install\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å®šä¹‰buildä»»åŠ¡(artifactsæ˜¯å°†distç›®å½•å­˜å‚¨èµ·æ¥ï¼Œè®©å…¶ä»–ä»»åŠ¡ä¸­ä¹Ÿèƒ½ä½¿ç”¨åˆ°ã€‚å› ä¸ºæ¯ä¸ªä»»åŠ¡ä¹‹é—´éƒ½æ˜¯éš”ç¦»çš„ï¼Œä»»åŠ¡å¼€å§‹æ—¶éƒ½ä¼šé‡ç½®ç¯å¢ƒï¼Œå› æ­¤å°±éœ€è¦ä½¿ç”¨cacheã€artifactsç­‰å…³é”®å­—)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("001")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run build \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("artifacts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  \t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  \t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dist/\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å®šä¹‰deployä»»åŠ¡(1.ä½¿ç”¨dockeråŸºç¡€é•œåƒï¼Œ2.é€šè¿‡dockerfileæ„å»ºé•œåƒï¼Œ3.å¦‚æœç¯å¢ƒä¸­æœ‰å®¹å™¨åˆ™åˆ é™¤è¯¥å®¹å™¨å¹¶èµ·åŠ¨è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ4.ä¸”è®¾ç½®ä¸ºæ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("001")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("t xd_log_platform_images .\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" if "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $(docker ps "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("aq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("filter name=xd_log_platform_container) "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(";then docker rm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f xd_log_platform_container;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p 8001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name xd_log_platform_container xd_log_platform_images\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'deploy docker image success. visit http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//123.23.23.13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8001 '\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manual\n")])])]),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/d63bc0019f044d0fa69faf58d8edd92b.png",alt:"gitlabci"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/47ba029a3848455f8593b1a21f0bbbb6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"gitlabci"}})]),t._v(" "),s("p",[t._v("å¦‚æœå‘ç°æŠ¥é”™ï¼Œå¯èƒ½æ˜¯gitlab-runnerçš„é…ç½®æœ‰é—®é¢˜ï¼š")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#è¿›å…¥gitlab-runnerçš„é…ç½®ç›®å½•")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /srv/gitlab-runner/config\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ç¼–è¾‘é…ç½®æ–‡ä»¶")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" config.toml\n")])])]),s("p",[t._v("æ‰“å¼€ç¼–è¾‘é¡µé¢åä½ ä¼šå‘ç°æœ‰å¾ˆå¤šé…ç½®é¡¹ï¼š")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å…è®¸å½“å‰é˜¶æ®µå‡ ä¸ªä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("concurrent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ä»£ç æäº¤åå¤šä¹…æ£€æµ‹ä¸€æ¬¡ä»£ç å˜æ›´ï¼Œæ‰§è¡Œgitlab-ci")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("check_interval")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ä¸‹é¢å°±æ˜¯è¯¥æœºå™¨ä¸Šçš„æ‰€æœ‰gitlab-runnerçš„é…ç½®")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("runners")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev-runner-001"')]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("url")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxxx"')]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("token")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxxxxxxx"')]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("executor")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker"')]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("runners.custom_build_dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("runners.cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("runners.cache.s3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("runners.cache.gcs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("runners.cache.azure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("runners.docker")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("tls_verify")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("image")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alpine:latest"')]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("privileged")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("disable_entrypoint_overwrite")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("oom_kill_disable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("disable_cache")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#æ˜ å°„")]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("volumes")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/cache"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å¦‚æœdockeræ‰§è¡Œæœ‰é—®é¢˜éœ€è¦è®¾ç½®ä¸€ä¸‹å®˜æ–¹æä¾›çš„ç›®å½•æ˜ å°„")]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#volumes = ["/cache","/usr/bin/docker:/usr/bin/docker","/var/run/docker.sock:/var/run/docker.sock"]')]),t._v("\n \t\t"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("shm_size")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("h2",{attrs:{id:"osséƒ¨ç½²å‰ç«¯é¡¹ç›®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#osséƒ¨ç½²å‰ç«¯é¡¹ç›®"}},[t._v("#")]),t._v(" osséƒ¨ç½²å‰ç«¯é¡¹ç›®")]),t._v(" "),s("h3",{attrs:{id:"ä»»åŠ¡åˆ—è¡¨ï¼š-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»»åŠ¡åˆ—è¡¨ï¼š-2"}},[t._v("#")]),t._v(" ä»»åŠ¡åˆ—è¡¨ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("å¼€é¢˜oss")]),t._v(" "),s("li",[t._v("åˆ›å»ºbucket")]),t._v(" "),s("li",[t._v("åˆ›å»ºackå¯†é’¥")]),t._v(" "),s("li",[t._v("ä½¿ç”¨ossutil")]),t._v(" "),s("li",[t._v("éšç§˜ä¿¡æ¯å˜é‡å­˜å‚¨")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#...")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_deploy_oss")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("001")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" wget http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//gosspublic.alicdn.com/ossutil/1.6.18/ossutil64\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" chomd 755 ossutil64\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./ossutil64 config "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("e $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("endPoint"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("i $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("accessKeyID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("k $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("accessKeySecret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("L CH "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("loglevel debug "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("c ~/.ossutilconfig\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./ossutil64 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("c ~/.ossutilconfig cp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("r "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f dist oss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//bucket_name/\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manual\n")])])]),s("p",[t._v("æŒ‡å®šossé…ç½®æ–‡ä»¶ï¼Œé€’å½’å¼ºåˆ¶ä¸Šä¼ distæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åˆ°æŒ‡å®šçš„ossçš„bucketä¸Šã€‚")]),t._v(" "),s("h3",{attrs:{id:"ciç¯å¢ƒå˜é‡çš„ä½¿ç”¨ï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ciç¯å¢ƒå˜é‡çš„ä½¿ç”¨ï¼š"}},[t._v("#")]),t._v(" ciç¯å¢ƒå˜é‡çš„ä½¿ç”¨ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/af10fd258208457cade6c7243f438196.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"ciç¯å¢ƒå˜é‡"}})]),t._v(" "),s("p",[t._v("é€šè¿‡è¿™æ ·è®¾ç½®äº†çš„ç¯å¢ƒå˜é‡å€¼ï¼Œå°±å¯ä»¥åœ¨**.gitlab-ci.yml**æ–‡ä»¶ä¸­é€šè¿‡"),s("code",[t._v("${variables}")]),t._v("çš„å½¢å¼è¿›è¡Œä½¿ç”¨å˜é‡ã€‚")]),t._v(" "),s("h2",{attrs:{id:"å˜é‡çš„æ³¨å…¥ä¸ä½¿ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å˜é‡çš„æ³¨å…¥ä¸ä½¿ç”¨"}},[t._v("#")]),t._v(" å˜é‡çš„æ³¨å…¥ä¸ä½¿ç”¨")]),t._v(" "),s("p",[t._v("ä½†æˆ‘ä»¬.gitlab.ymlæ–‡ä»¶ä¸­æœ‰å¾ˆå¤šåœ°æ–¹ä½¿ç”¨åˆ°äº†ç›¸åŒçš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™äº›å€¼æå–æˆå˜é‡æ¥ä½¿ç”¨ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ä¸‰ç§å˜é‡çš„ä½¿ç”¨ï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ç§å˜é‡çš„ä½¿ç”¨ï¼š"}},[t._v("#")]),t._v(" ä¸‰ç§å˜é‡çš„ä½¿ç”¨ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åœ¨.gitlab-ci.ymlä¸­è‡ªå·±å®šä¹‰ï¼ˆvariableså…³é”®å­—ï¼‰")]),t._v(" "),s("li",[t._v("pipelineä¸­"),s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/variables/predefined_variables.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("é¢„å®šä¹‰çš„å˜é‡"),s("OutboundLink")],1),t._v("ï¼ˆæäº¤çš„commitçš„å“ˆå¸Œå€¼ï¼Œå½“å‰çš„åˆ†æ”¯ï¼Œå½“å‰çš„ä»»åŠ¡åç§°ç­‰ï¼‰")]),t._v(" "),s("li",[t._v("è‡ªå·±åœ¨é¡¹ç›®ä¸­è®¾ç½®å˜é‡ï¼ˆåœ¨å¯è§†åŒ–é¡µé¢ä¸­è¿›è¡Œè®¾ç½®ï¼‰")])]),t._v(" "),s("h3",{attrs:{id:"å˜é‡çš„ç±»å‹ï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å˜é‡çš„ç±»å‹ï¼š"}},[t._v("#")]),t._v(" å˜é‡çš„ç±»å‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("k-vå˜é‡")]),t._v(" "),s("li",[t._v("æ–‡ä»¶ï¼ˆç­¾åè¯ä¹¦ï¼Œå¯†é’¥ç­‰ï¼‰")])]),t._v(" "),s("h3",{attrs:{id:"å˜é‡èƒ½åœ¨å“ªäº›å…³é”®å­—ä¸­ä½¿ç”¨ï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å˜é‡èƒ½åœ¨å“ªäº›å…³é”®å­—ä¸­ä½¿ç”¨ï¼š"}},[t._v("#")]),t._v(" å˜é‡èƒ½åœ¨å“ªäº›å…³é”®å­—ä¸­ä½¿ç”¨ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("environment:url")])]),t._v(" "),s("li",[s("code",[t._v("environment:name")])]),t._v(" "),s("li",[s("code",[t._v("resource_group")])]),t._v(" "),s("li",[s("code",[t._v("include")])]),t._v(" "),s("li",[s("code",[t._v("variables")])]),t._v(" "),s("li",[s("code",[t._v("image")])]),t._v(" "),s("li",[s("code",[t._v("services:[]")])]),t._v(" "),s("li",[s("code",[t._v("services:[]:name")])]),t._v(" "),s("li",[s("code",[t._v("cache:key")])]),t._v(" "),s("li",[s("code",[t._v("artifacts:name")])]),t._v(" "),s("li",[s("code",[t._v("script,before_script,after_script")])]),t._v(" "),s("li",[s("code",[t._v("only:variables:[],export:variables:[],rules:if")])])]),t._v(" "),s("h3",{attrs:{id:"å¦‚ä½•ä½¿ç”¨ï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä½¿ç”¨ï¼š"}},[t._v("#")]),t._v(" å¦‚ä½•ä½¿ç”¨ï¼š")]),t._v(" "),s("h4",{attrs:{id:"variableså…³é”®å­—å®šä¹‰åŠä½¿ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#variableså…³é”®å­—å®šä¹‰åŠä½¿ç”¨"}},[t._v("#")]),t._v(" variableså…³é”®å­—å®šä¹‰åŠä½¿ç”¨")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#æ˜¯ä¸€ä¸ªå…¨å±€çš„å˜é‡ï¼Œä»»ä½•ä¸€ä¸ªä»»åŠ¡ä¸­éƒ½å¯ä»¥ä½¿ç”¨ã€‚")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("variables")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TEST_VAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"All jobs can use this variable\'s value"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#åœ¨ä»»åŠ¡ä¸­æ‰§è¡Œæ‰“å°å˜é‡ï¼ˆç›´æ¥ç”¨$ç¬¦å·+å˜é‡åå³å¯ï¼‰")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("log_var")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo $TEST_VAR\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#è¿™æ˜¯æˆ‘ä»¬åˆšæ‰ä½¿ç”¨dockeréƒ¨ç½²å‰ç«¯é¡¹ç›®ä¸­çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬æƒ³è¦æŠŠå½“å‰ä»»åŠ¡ä¸­çš„é•œåƒåç§°å’Œå®¹å™¨åç§°å®šä¹‰æˆå±€éƒ¨å˜é‡ï¼š")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("variables")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("IMAGE_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xd_log_platform_images"')]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("CONTAINER_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xd_log_platform_container"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("001")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("t $IMAGE_NAME .\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" if "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" $(docker ps "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("aq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("filter name=$CONTAINER_NAME) "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(";then docker rm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f $CONTAINER_NAME;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docker run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p 8001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("name $CONTAINER_NAME $IMAGE_NAME\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'deploy docker image success. visit http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//123.23.23.13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8001 '\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manual\n")])])]),s("h4",{attrs:{id:"åœ¨å¯è§†åŒ–é¡µé¢è®¾ç½®å˜é‡å¹¶ä½¿ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨å¯è§†åŒ–é¡µé¢è®¾ç½®å˜é‡å¹¶ä½¿ç”¨"}},[t._v("#")]),t._v(" åœ¨å¯è§†åŒ–é¡µé¢è®¾ç½®å˜é‡å¹¶ä½¿ç”¨")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/88222198a86c46739a37796d6e8e8223.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"å˜é‡çš„ä½¿ç”¨"}})]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#æ‰“å°æˆ‘ä»¬ä¸Šé¢ğŸ‘†è®¾ç½®çš„NAMEå˜é‡")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("log_project_var")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo $NAME\n")])])]),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/84d83a9ef3d744f1adf44420a4c8b758.png",alt:"nomask"}})]),t._v(" "),s("p",[t._v("å‹¾é€‰mask variableæ—¶çš„æ‰“å°æ•ˆæœå¦‚ä¸‹ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/23fe4271a2bd427a9aeb22004a18c70d.png",alt:"mask"}})]),t._v(" "),s("h4",{attrs:{id:"pipelineä¸­é¢„å®šä¹‰çš„å˜é‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pipelineä¸­é¢„å®šä¹‰çš„å˜é‡"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/variables/predefined_variables.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("pipelineä¸­é¢„å®šä¹‰çš„å˜é‡"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("å¯åœ¨å®˜ç½‘å»"),s("strong",[t._v("æŸ¥çœ‹é¢„å®šä¹‰çš„å˜é‡å")]),t._v("ï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆå»æŸ¥çœ‹åˆ°è¿™äº›é¢„å®šä¹‰å˜é‡å‘¢ï¼ŸğŸ‘‡")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥ä»»åŠ¡å»å¯¼å‡ºæ‰€æœ‰çš„å˜é‡ï¼ˆå³æ‰“å°å‡ºæ¥ï¼‰")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("get_all_var")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" export\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å½“å‰ä»»åŠ¡å°±æ˜¯ä½¿ç”¨é¢„è®¾å˜é‡çš„ä¾‹å­")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test_variable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo $CI_JOB_STAGE\n")])])]),s("h2",{attrs:{id:"æµæ°´çº¿çš„ç±»å‹ä»¥åŠæµæ°´çº¿çš„è§¦å‘æ–¹å¼"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµæ°´çº¿çš„ç±»å‹ä»¥åŠæµæ°´çº¿çš„è§¦å‘æ–¹å¼"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.bilibili.com/video/BV1Z64y1r7m9",target:"_blank",rel:"noopener noreferrer"}},[t._v("æµæ°´çº¿çš„ç±»å‹ä»¥åŠæµæ°´çº¿çš„è§¦å‘æ–¹å¼"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"æµæ°´çº¿ç±»å‹ï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµæ°´çº¿ç±»å‹ï¼š"}},[t._v("#")]),t._v(" æµæ°´çº¿ç±»å‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åŸºæœ¬æµæ°´çº¿")]),t._v(" "),s("li",[t._v("DAGæµæ°´çº¿ ï¼ˆä¸€ä¸ªé¡¹ç›®åŒæ—¶éƒ¨ç½²å¤šä¸ªå¹³å°ï¼Œå¤šæ¡æµæ°´çº¿å¹¶è¡Œæ‰§è¡Œï¼‰")]),t._v(" "),s("li",[t._v("å¤šé¡¹ç›®æµæ°´çº¿")]),t._v(" "),s("li",[t._v("çˆ¶å­æµæ°´çº¿")]),t._v(" "),s("li",[t._v("åˆå¹¶è¯·æ±‚æµæ°´çº¿")])]),t._v(" "),s("h3",{attrs:{id:"æµæ°´çº¿çš„è§¦å‘ï¼š"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµæ°´çº¿çš„è§¦å‘ï¼š"}},[t._v("#")]),t._v(" æµæ°´çº¿çš„è§¦å‘ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ¨é€ä»£ç ")]),t._v(" "),s("li",[t._v("å®šæ—¶è§¦å‘")]),t._v(" "),s("li",[t._v("urlè§¦å‘")]),t._v(" "),s("li",[t._v("æ‰‹åŠ¨è§¦å‘")])]),t._v(" "),s("h4",{attrs:{id:"å®šæ—¶è§¦å‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®šæ—¶è§¦å‘"}},[t._v("#")]),t._v(" å®šæ—¶è§¦å‘")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/b7cd1a45b1c1410d864fa6d69c19253b.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"å®šæ—¶è§¦å‘"}})]),t._v(" "),s("h4",{attrs:{id:"urlè§¦å‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#urlè§¦å‘"}},[t._v("#")]),t._v(" urlè§¦å‘")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/a60a1d8830114fcfb662f29d19fb2d5f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"urlè§¦å‘"}})]),t._v(" "),s("h2",{attrs:{id:"æµæ°´çº¿æœ€ä½³å®è·µåŠè°ƒè¯•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµæ°´çº¿æœ€ä½³å®è·µåŠè°ƒè¯•"}},[t._v("#")]),t._v(" æµæ°´çº¿æœ€ä½³å®è·µåŠè°ƒè¯•")]),t._v(" "),s("p",[t._v("ä½¿ç”¨å…³é”®è¯ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("interruptibleï¼šè®¾ç½®ä¸ºtrueï¼Œæ ‡è®°è¯¥ä»»åŠ¡å¯è¢«é˜»æ–­ã€‚")]),t._v(" "),s("li",[t._v("release")]),t._v(" "),s("li",[t._v("timeout")]),t._v(" "),s("li",[t._v("resource_group")])]),t._v(" "),s("p",[t._v("æ¶‰åŠåŠŸèƒ½ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("è‡ªåŠ¨å–æ¶ˆæ—§çš„æµæ°´çº¿")]),t._v(" "),s("li",[t._v("åˆ›å»ºä¸€ä¸ªrelease")]),t._v(" "),s("li",[t._v("è®¾ç½®è¶…æ—¶æ—¶é—´")]),t._v(" "),s("li",[t._v("ä¿è¯å®‰å…¨éƒ¨ç½²ï¼Œä¸€ä¸ªåˆ†æ”¯åªå…è®¸æœ‰ä¸€ä¸ªéƒ¨ç½²ä»»åŠ¡")]),t._v(" "),s("li",[t._v("æµæ°´çº¿çš„è°ƒè¯•")]),t._v(" "),s("li",[t._v("è®¾ç½®éƒ¨ç½²å†»ç»“")]),t._v(" "),s("li",[t._v("æµæ°´çº¿å†…ç½®çš„è°ƒè¯•")])]),t._v(" "),s("h3",{attrs:{id:"_1ã€‘è‡ªåŠ¨å–æ¶ˆæ—§çš„æµæ°´çº¿"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1ã€‘è‡ªåŠ¨å–æ¶ˆæ—§çš„æµæ°´çº¿"}},[t._v("#")]),t._v(" 1ã€‘è‡ªåŠ¨å–æ¶ˆæ—§çš„æµæ°´çº¿")]),t._v(" "),s("p",[s("strong",[t._v("åœ¨åŒä¸€ä¸ªåˆ†æ”¯ï¼ŒçŸ­æ—¶é—´å†…åªå¯¹æœ€æ–°çš„æäº¤è¿›è¡Œciï¼Œå–æ¶ˆæœªæ‰§è¡Œå®Œçš„æµæ°´çº¿ã€‚")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/b9a1d608178345c58c10e66b5d25e680.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"interruptible"}})]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install_job")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n\t  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'start install'\n\t  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" sleep 60\n\t  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo  'end install'\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interruptible")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\t  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build_job")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n \t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n \t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n \t  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'start build'\n \t  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" sleep 120\n \t  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'end build'\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interruptible")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("  \n \t\n")])])]),s("p",[t._v("ç¬¬ä¸€æ¬¡æäº¤ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/373b48c722234a199175387b32cc9397.png",alt:"first"}})]),t._v(" "),s("p",[t._v("ç´§æ¥ç€æäº¤ç¬¬äºŒæ¬¡ï¼šï¼ˆ"),s("strong",[t._v("ä¸Šä¸€æ¬¡çš„ciå°±è¢«å–æ¶ˆäº†")]),t._v("ï¼‰")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/6d321f9153524cf2948c22e485c2d74c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"second"}})]),t._v(" "),s("h3",{attrs:{id:"_2ã€‘åˆ›å»ºä¸€ä¸ªrelease"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2ã€‘åˆ›å»ºä¸€ä¸ªrelease"}},[t._v("#")]),t._v(" 2ã€‘åˆ›å»ºä¸€ä¸ªrelease")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/eb6f063aefad414f8c4ff47e5720cb83.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70",alt:"release"}})]),t._v(" "),s("p",[t._v("è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªreleaseï¼šï¼ˆreleaseå°±æ˜¯åŒ…ï¼Œæµæ°´çº¿ä¸­ä½¿ç”¨"),s("strong",[t._v("release")]),t._v("å…³é”®è¯ï¼‰")]),t._v(" "),s("ul",[s("li",[t._v("ä½¿ç”¨gitlabæä¾›çš„é•œåƒè¿›è¡Œæ‰“release")]),t._v(" "),s("li",[t._v("onlyæŒ‡å®šè§¦å‘ä»»åŠ¡çš„æ–¹å¼ï¼Œå½“æ‰“tagæ—¶å°±ä¼šåˆ›å»ºrelease")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("create_release")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry.gitlab.com/gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("org/release"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cli"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo 'start create release'\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("release")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tag_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $CI_COMMIT_TAG\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my release'")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" tags\n")])])]),s("h3",{attrs:{id:"_3ã€‘è®¾ç½®è¶…æ—¶æ—¶é—´"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3ã€‘è®¾ç½®è¶…æ—¶æ—¶é—´"}},[t._v("#")]),t._v(" 3ã€‘è®¾ç½®è¶…æ—¶æ—¶é—´")]),t._v(" "),s("p",[t._v("å®˜æ–¹é»˜è®¤çš„è¶…æ—¶æ—¶é—´æ˜¯ä¸€ä¸ªå°æ—¶ï¼ˆå¦‚æœéœ€è¦è‡ªå®šä¹‰çš„è¯éœ€è¦ä½¿ç”¨"),s("strong",[t._v("timeout")]),t._v("å…³é”®å­—ï¼‰")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build.sh\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3 hours 30 minutes\n\t\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rspec\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3h 30m\n")])])]),s("h3",{attrs:{id:"_4ã€‘é™å®šå¹¶å‘ä»»åŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4ã€‘é™å®šå¹¶å‘ä»»åŠ¡"}},[t._v("#")]),t._v(" 4ã€‘é™å®šå¹¶å‘ä»»åŠ¡")]),t._v(" "),s("p",[s("strong",[t._v("ä¿è¯å®‰å…¨éƒ¨ç½²ï¼Œä¸€ä¸ªåˆ†æ”¯åªå…è®¸æœ‰ä¸€ä¸ªéƒ¨ç½²ä»»åŠ¡(æµæ°´çº¿)")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" staging\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" echo 'start deploy'\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" sleep 120\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resource_group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" prod\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);