(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{389:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"koa部署服务器整理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#koa部署服务器整理"}},[t._v("#")]),t._v(" koa部署服务器整理")]),t._v(" "),s("p",[t._v("本期引用：关注")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.cn/post/6844904080414867469",target:"_blank",rel:"noopener noreferrer"}},[t._v("node服务开发和服务器部署（node.js+koa2+pm2+nginx）教程"),s("OutboundLink")],1),t._v("（带"),s("a",{attrs:{href:"https://www.bilibili.com/video/av92894716/",target:"_blank",rel:"noopener noreferrer"}},[t._v("视频"),s("OutboundLink")],1),t._v("）")]),t._v(" "),s("h3",{attrs:{id:"_1】代码传到服务器上"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1】代码传到服务器上"}},[t._v("#")]),t._v(" 1】代码传到服务器上")]),t._v(" "),s("p",[t._v("把代码上传到服务器：FTP、git、rz 。")]),t._v(" "),s("p",[t._v("安装依赖："),s("code",[t._v("npm i")])]),t._v(" "),s("p",[t._v("尝试启动服务："),s("code",[t._v("node app.js")])]),t._v(" "),s("p",[t._v("curl服务器本地访问："),s("code",[t._v("curl http://127.0.0.1:3000/api")])]),t._v(" "),s("h3",{attrs:{id:"_2】安装并使用pm2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2】安装并使用pm2"}},[t._v("#")]),t._v(" 2】安装并使用pm2")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -g pm2\n")])])]),s("p",[t._v("用pm2启动node服务：（需要在app.js目录下启动）")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("pm2 start app.js -i max -n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("program_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("a",{attrs:{href:"https://www.douban.com/note/314200231/",target:"_blank",rel:"noopener noreferrer"}},[t._v("pm2常用命令"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_3】在阿里云控制台打开端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3】在阿里云控制台打开端口"}},[t._v("#")]),t._v(" 3】在阿里云控制台打开端口")]),t._v(" "),s("p",[t._v("防火墙中添加需要开放给外网的端口号：比如这里的3000端口。")]),t._v(" "),s("p",[t._v("然后就可以通过服务器的外网ip地址访问3000端口，进行访问我们的koa服务了。")]),t._v(" "),s("h3",{attrs:{id:"_4】安装nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4】安装nginx"}},[t._v("#")]),t._v(" 4】安装nginx")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx\n")])])]),s("p",[t._v("查看版本号："),s("code",[t._v("nginx -v")])]),t._v(" "),s("h3",{attrs:{id:"_5】配置nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5】配置nginx"}},[t._v("#")]),t._v(" 5】配置nginx")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/3/1/17095bfda1f55339?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}})]),t._v(" "),s("h3",{attrs:{id:"_6】nginx反向代理配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6】nginx反向代理配置"}},[t._v("#")]),t._v(" 6】Nginx反向代理配置")]),t._v(" "),s("p",[t._v("一般的nginx默认安装的配置文件都是在：/etc/nginx/conf.d/")]),t._v(" "),s("p",[t._v("进入配置文件目录：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /etc/nginx/conf.d/\n")])])]),s("p",[t._v("创建配置文件：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" node.lijicheng.cn.80.confcd\n")])])]),s("p",[t._v("写入配置文件里粘贴一下代码：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server {\n    listen 80;\n    server_name node.lijicheng.cn;\n    root html;\n    index index.html index.htm;\n    location /api/ {\n            root   /usr/share/nginx/html;\n            index  index.html index.htm;\n            proxy_pass http://127.0.0.1:3000;\n        }\n    \n    \tlocation / {\n            proxy_pass http://127.0.0.1:7001;\n        }\n        #error_page  404              /404.html;\n    \n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   /usr/share/nginx/html;\n        }\n}\n")])])]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name  rayhomie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("icu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3001")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  error_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name  ui"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rayhomie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("icu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3002")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  error_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("检查配置文件是否合格：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("nginx -t\n复制代码\n")])])]),s("p",[t._v("如果合格，会有如下输出：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("nginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n复制代码\n")])])]),s("p",[t._v("至此说明nginx配置没有语法问题了，可以考虑重启了：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("nginx -s reload\n复制代码\n")])])]),s("p",[t._v("如果有如下报错：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('nginx: [error] invalid PID number "" in "/run/nginx.pid"\n复制代码\n')])])]),s("p",[t._v("需要重新加载一下配置文件：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("nginx -c /etc/nginx/nginx.conf\n复制代码\n")])])]),s("p",[t._v("这个时候再重启nginx：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("nginx -s reload\n复制代码\n")])])]),s("p",[t._v("理论上是成功了的，如果有错误，还得看具体什么错了，然后针对性解决")]),t._v(" "),s("h3",{attrs:{id:"_7】mongodb的安装和开启"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7】mongodb的安装和开启"}},[t._v("#")]),t._v(" 7】mongoDB的安装和开启")]),t._v(" "),s("p",[t._v("如果使用了mongoDB还需要安装mongoDB，以及开启服务。")]),t._v(" "),s("p",[t._v("具体操作可以参考"),s("a",{attrs:{href:"https://www.runoob.com/mongodb/mongodb-osx-install.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("mongo菜鸟教程"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);