<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1】浏览器引擎 | rayhomie&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/headPic.png">
    <link rel="stylesheet" href="/css/style.css">
    <script charset="utf-8" src="/js/showNav.js"></script>
    <meta name="description" content="雷浩的前端开发之路">
    <link rel="preload" href="/assets/css/0.styles.1fbdf1a8.css" as="style"><link rel="preload" href="/assets/js/app.27102bc9.js" as="script"><link rel="preload" href="/assets/js/2.8dfe8e5f.js" as="script"><link rel="preload" href="/assets/js/47.e9ddff76.js" as="script"><link rel="prefetch" href="/assets/js/10.a5add0c3.js"><link rel="prefetch" href="/assets/js/100.8c89d648.js"><link rel="prefetch" href="/assets/js/101.fc717ec9.js"><link rel="prefetch" href="/assets/js/102.d6e7edc0.js"><link rel="prefetch" href="/assets/js/103.8030fd4b.js"><link rel="prefetch" href="/assets/js/104.fef64d82.js"><link rel="prefetch" href="/assets/js/105.c3fca9d7.js"><link rel="prefetch" href="/assets/js/106.b504056d.js"><link rel="prefetch" href="/assets/js/107.c31048aa.js"><link rel="prefetch" href="/assets/js/108.ae5626e1.js"><link rel="prefetch" href="/assets/js/11.7c494a87.js"><link rel="prefetch" href="/assets/js/12.d1bbbdaf.js"><link rel="prefetch" href="/assets/js/13.82c9798f.js"><link rel="prefetch" href="/assets/js/14.2e6f50b9.js"><link rel="prefetch" href="/assets/js/15.b827ce0c.js"><link rel="prefetch" href="/assets/js/16.603efcc3.js"><link rel="prefetch" href="/assets/js/17.477dc29c.js"><link rel="prefetch" href="/assets/js/18.ab1b43d7.js"><link rel="prefetch" href="/assets/js/19.e0fa9ba5.js"><link rel="prefetch" href="/assets/js/20.d95066c8.js"><link rel="prefetch" href="/assets/js/21.6cd879b8.js"><link rel="prefetch" href="/assets/js/22.5324ab0e.js"><link rel="prefetch" href="/assets/js/23.9218d6d8.js"><link rel="prefetch" href="/assets/js/24.1e19c27f.js"><link rel="prefetch" href="/assets/js/25.6da3fde7.js"><link rel="prefetch" href="/assets/js/26.edd11d9d.js"><link rel="prefetch" href="/assets/js/27.eb67fea8.js"><link rel="prefetch" href="/assets/js/28.6565b2c5.js"><link rel="prefetch" href="/assets/js/29.23d65dc5.js"><link rel="prefetch" href="/assets/js/3.27135dec.js"><link rel="prefetch" href="/assets/js/30.3ad0f117.js"><link rel="prefetch" href="/assets/js/31.17792233.js"><link rel="prefetch" href="/assets/js/32.412220a3.js"><link rel="prefetch" href="/assets/js/33.dcee5d03.js"><link rel="prefetch" href="/assets/js/34.8aac186c.js"><link rel="prefetch" href="/assets/js/35.479f1f88.js"><link rel="prefetch" href="/assets/js/36.538c8db2.js"><link rel="prefetch" href="/assets/js/37.ca793177.js"><link rel="prefetch" href="/assets/js/38.a0bde2fd.js"><link rel="prefetch" href="/assets/js/39.5475ac02.js"><link rel="prefetch" href="/assets/js/4.74cf67b4.js"><link rel="prefetch" href="/assets/js/40.eeab06c6.js"><link rel="prefetch" href="/assets/js/41.33dc67c6.js"><link rel="prefetch" href="/assets/js/42.acb457e3.js"><link rel="prefetch" href="/assets/js/43.6fc9fe3f.js"><link rel="prefetch" href="/assets/js/44.eec80764.js"><link rel="prefetch" href="/assets/js/45.f180ce8d.js"><link rel="prefetch" href="/assets/js/46.c2a4d416.js"><link rel="prefetch" href="/assets/js/48.5d4fb10f.js"><link rel="prefetch" href="/assets/js/49.fa19c197.js"><link rel="prefetch" href="/assets/js/5.fff2dba8.js"><link rel="prefetch" href="/assets/js/50.1995f55f.js"><link rel="prefetch" href="/assets/js/51.ad9507a6.js"><link rel="prefetch" href="/assets/js/52.a0c7b4b4.js"><link rel="prefetch" href="/assets/js/53.e6270868.js"><link rel="prefetch" href="/assets/js/54.8b2ab146.js"><link rel="prefetch" href="/assets/js/55.d4b94501.js"><link rel="prefetch" href="/assets/js/56.8799f75c.js"><link rel="prefetch" href="/assets/js/57.70252bd5.js"><link rel="prefetch" href="/assets/js/58.b55c98a5.js"><link rel="prefetch" href="/assets/js/59.a40bf0aa.js"><link rel="prefetch" href="/assets/js/6.7a238015.js"><link rel="prefetch" href="/assets/js/60.b32822f8.js"><link rel="prefetch" href="/assets/js/61.96e132e4.js"><link rel="prefetch" href="/assets/js/62.5b156fb7.js"><link rel="prefetch" href="/assets/js/63.252fdde0.js"><link rel="prefetch" href="/assets/js/64.870eb635.js"><link rel="prefetch" href="/assets/js/65.00cf779d.js"><link rel="prefetch" href="/assets/js/66.edfb8eec.js"><link rel="prefetch" href="/assets/js/67.21c62f6c.js"><link rel="prefetch" href="/assets/js/68.e8153158.js"><link rel="prefetch" href="/assets/js/69.c886c8dc.js"><link rel="prefetch" href="/assets/js/7.4ccf6b5f.js"><link rel="prefetch" href="/assets/js/70.103bfe88.js"><link rel="prefetch" href="/assets/js/71.1da9ddc7.js"><link rel="prefetch" href="/assets/js/72.5259cf72.js"><link rel="prefetch" href="/assets/js/73.2e99bbf9.js"><link rel="prefetch" href="/assets/js/74.15325ce0.js"><link rel="prefetch" href="/assets/js/75.feb3fe93.js"><link rel="prefetch" href="/assets/js/76.c6ffd0de.js"><link rel="prefetch" href="/assets/js/77.1f15986e.js"><link rel="prefetch" href="/assets/js/78.26e8059a.js"><link rel="prefetch" href="/assets/js/79.5aecad9a.js"><link rel="prefetch" href="/assets/js/8.086b5469.js"><link rel="prefetch" href="/assets/js/80.0d468094.js"><link rel="prefetch" href="/assets/js/81.869965a4.js"><link rel="prefetch" href="/assets/js/82.5161670c.js"><link rel="prefetch" href="/assets/js/83.24394a20.js"><link rel="prefetch" href="/assets/js/84.4abbb214.js"><link rel="prefetch" href="/assets/js/85.c5442ded.js"><link rel="prefetch" href="/assets/js/86.787b4128.js"><link rel="prefetch" href="/assets/js/87.32e54ac7.js"><link rel="prefetch" href="/assets/js/88.5da20419.js"><link rel="prefetch" href="/assets/js/89.eccb9167.js"><link rel="prefetch" href="/assets/js/9.01377c1a.js"><link rel="prefetch" href="/assets/js/90.538ac538.js"><link rel="prefetch" href="/assets/js/91.ffb107cd.js"><link rel="prefetch" href="/assets/js/92.c683e420.js"><link rel="prefetch" href="/assets/js/93.e4e30951.js"><link rel="prefetch" href="/assets/js/94.6df7640a.js"><link rel="prefetch" href="/assets/js/95.9ea7d0a8.js"><link rel="prefetch" href="/assets/js/96.1659aa5a.js"><link rel="prefetch" href="/assets/js/97.3b3b507b.js"><link rel="prefetch" href="/assets/js/98.12e89dfd.js"><link rel="prefetch" href="/assets/js/99.a2de8da9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1fbdf1a8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">rayhomie's blog</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架学习" class="dropdown-title"><span class="title">框架学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VUE/vueBase/" class="nav-link">
  vue基础
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vueComponent/" class="nav-link">
  vue组件化编码
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue_webpack_modules/" class="nav-link">
  webpacke模块化开发
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue-cli/" class="nav-link">
  vue-cli脚手架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue-router/" class="nav-link">
  vue-router路由
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vuex-learn/" class="nav-link">
  vuex状态管理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/VueMixin/" class="nav-link">
  Mixins混入
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vueBoost/" class="nav-link">
  vue性能优化
</a></li><li class="dropdown-item"><!----> <a href="/VUE/axios/" class="nav-link">
  Axios框架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/ajax/" class="nav-link">
  Ajax
</a></li><li class="dropdown-item"><!----> <a href="/VUE/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/VUE/mock/" class="nav-link">
  mock
</a></li><li class="dropdown-item"><!----> <a href="/VUE/wxprogram/" class="nav-link">
  小程序入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/uniapp/" class="nav-link">
  uni-app入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Reactbase/" class="nav-link">
  React基础入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/ReactCli/" class="nav-link">
  React脚手架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Redux/" class="nav-link">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/VUE/react-redux/" class="nav-link">
  react-redux的实现原理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Hooks/" class="nav-link">
  React Hooks
</a></li><li class="dropdown-item"><!----> <a href="/VUE/reactRender/" class="nav-link">
  react渲染和更新机制
</a></li><li class="dropdown-item"><!----> <a href="/VUE/setState/" class="nav-link">
  setState进阶
</a></li><li class="dropdown-item"><!----> <a href="/VUE/nextTick/" class="nav-link">
  Vue.nextTick进阶
</a></li><li class="dropdown-item"><!----> <a href="/VUE/reactHighCom/" class="nav-link">
  react高阶组件
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Reactevent/" class="nav-link">
  react合成事件分析
</a></li><li class="dropdown-item"><!----> <a href="/VUE/frontLogin/" class="nav-link">
  前端登录
</a></li><li class="dropdown-item"><!----> <a href="/VUE/CORS&amp;proxy/" class="nav-link">
  CORS跨域和反向代理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/XHR&amp;AJAX/" class="nav-link">
  XHR对象和AJAX
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Node/Nodejs/" class="nav-link">
  Nodejs服务端
</a></li><li class="dropdown-item"><!----> <a href="/Node/restudyNode/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  重学Node
</a></li><li class="dropdown-item"><!----> <a href="/Node/restudyWebpack/" class="nav-link">
  重学Webpack
</a></li><li class="dropdown-item"><!----> <a href="/Node/promisify/" class="nav-link">
  手写util.promisify
</a></li><li class="dropdown-item"><!----> <a href="/Node/Blob/" class="nav-link">
  Blob数据
</a></li><li class="dropdown-item"><!----> <a href="/Node/nodejsStreamCopy/" class="nav-link">
  nodejs管道流复制文件
</a></li><li class="dropdown-item"><!----> <a href="/Node/Docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/Node/gitlabci/" class="nav-link">
  gitlab-ci
</a></li><li class="dropdown-item"><!----> <a href="/Node/Express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/Node/Koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-item"><!----> <a href="/Node/koaDeploy/" class="nav-link">
  koa部署服务器
</a></li><li class="dropdown-item"><!----> <a href="/Node/MongoDB/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/Node/Mongoose/" class="nav-link">
  Mongoose
</a></li><li class="dropdown-item"><!----> <a href="/Node/zx/" class="nav-link">
  zx库
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript学习" class="dropdown-title"><span class="title">JavaScript学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/note/" class="nav-link">
  js笔记
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/GOGOFACE/" class="nav-link">
  校招面试冲刺
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/manager/" class="nav-link">
  js知识整理
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Promise/" class="nav-link">
  Promise
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/AOP/" class="nav-link">
  AOP切面编程(闭包)
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Generator&amp;yield/" class="nav-link">
  Generator生成器&amp;Iterator迭代器
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/asyncReturn/" class="nav-link">
  async中return和return await的区别
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsFaceObject/" class="nav-link">
  js面向对象基础--创建对象
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsPtototypeChain/" class="nav-link">
  js面向对象基础--原型链
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsBaseExtends/" class="nav-link">
  js面向对象基础--继承
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsPrototypeExtends/" class="nav-link">
  js原型继承
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptCodeClean/" class="nav-link">
  JavaScript代码整洁之道
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptEventLoop/" class="nav-link">
  JavaScript事件循环各种概念剖析
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptThisPoint/" class="nav-link">
  JavaScript简单理解this指向
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/es6this/" class="nav-link">
  谈谈ES6箭头函数this指向问题
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/environment/" class="nav-link">
  词法环境[[environment]]--闭包
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/zuoyongyu/" class="nav-link">
  js函数作用域与闭包相关问题
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/varHosting/" class="nav-link">
  js中的变量提升和函数提升
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/VO&amp;AO/" class="nav-link">
  JS中的变量对象VO和活动对象AO
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JScenter/" class="nav-link">
  JS核心机制（数据类型、垃圾回收机制）
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/handCallApplyBind/" class="nav-link">
  手写call、apply、bind
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataStructure/note/" class="nav-link">
  笔记整理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS特效" class="dropdown-title"><span class="title">CSS特效</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CSSEffect/moreColumLayout/" class="nav-link">
  CSS多列布局的实现
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/writeWords/" class="nav-link">
  打字机效果以及animation中的steps()函数
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/box-shadow/" class="nav-link">
  CSS的box-shadow创建边框
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/CSSPointshow/" class="nav-link">
  纯CSS实现的滚动指示器效果
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/img-lazyload/" class="nav-link">
  图片模糊加载
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/tuozhuai/" class="nav-link">
  实现一个拖拽
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/positionSticky/" class="nav-link">
  实现position:sticky
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/lazyLoad/" class="nav-link">
  实现下拉加载更多，懒加载
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随便聊聊" class="dropdown-title"><span class="title">随便聊聊</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/talktalk/onePic/" class="nav-link">
  一张图总结系列
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/argument/" class="nav-link">
  js的argument
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/bibao/" class="nav-link">
  闭包个人理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/eventloop/" class="nav-link">
  Event Loop理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/chuandicanshu/" class="nav-link">
  js参数传递理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/var/" class="nav-link">
  聊聊js变量存储的本质和const修改对象问题
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/es6open/" class="nav-link">
  ES6扩展运算符的使用
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/dataInVue/" class="nav-link">
  为什么.vue文件中data必须用函数表达
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/jsMaopao/" class="nav-link">
  浅谈js事件捕获和事件冒泡
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFaceTest/" class="nav-link">
  CSS 面试知识点总结
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFirst/" class="nav-link">
  CSS 属性继承和优先级算法(权重)
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSSelector/" class="nav-link">
  了解 CSS 选择器
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSCenter/" class="nav-link">
  总结一下 CSS 居中的各种方法
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFloat/" class="nav-link">
  说说CSS浮动以及清除浮动
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSMargin/" class="nav-link">
  外边距塌陷问题
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSBFC/" class="nav-link">
  浅谈BFC
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HTTP/" class="nav-link">
  HTTP协议
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HTTPS/" class="nav-link">
  聊聊HTTPS工作原理
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/thread/" class="nav-link">
  进程与线程tcp/ip三次握手
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HtmlHead/" class="nav-link">
  你知道HTML中Head标签具体怎么用吗？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/JSONStringify/" class="nav-link">
  JSON.stringify()还可以这么玩
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/ObjectAssign/" class="nav-link">
  Object.assign()的使用指南
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/debounce/" class="nav-link">
  简单防抖函数中闭包的问题理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/throttle/" class="nav-link">
  简单节流函数中闭包的问题理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/doubleBinding/" class="nav-link">
  多种实现双向绑定方法
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/ReactClassComponent/" class="nav-link">
  React类组件的一些问题浅析
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/brower/" class="nav-link">
  浏览器运行原理
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/commonJS&amp;ESmodules/" class="nav-link">
  commonJS和ESmodules差异
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/DOMDIFF/" class="nav-link">
  vue中:key=index为什么不建议使用？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/constUseState/" class="nav-link">
  为什么useState可以使用const解构赋值？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/pipeCopy/" class="nav-link">
  使用管道流复制大文件
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架学习" class="dropdown-title"><span class="title">框架学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VUE/vueBase/" class="nav-link">
  vue基础
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vueComponent/" class="nav-link">
  vue组件化编码
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue_webpack_modules/" class="nav-link">
  webpacke模块化开发
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue-cli/" class="nav-link">
  vue-cli脚手架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue-router/" class="nav-link">
  vue-router路由
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vuex-learn/" class="nav-link">
  vuex状态管理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/VueMixin/" class="nav-link">
  Mixins混入
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vueBoost/" class="nav-link">
  vue性能优化
</a></li><li class="dropdown-item"><!----> <a href="/VUE/axios/" class="nav-link">
  Axios框架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/ajax/" class="nav-link">
  Ajax
</a></li><li class="dropdown-item"><!----> <a href="/VUE/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/VUE/mock/" class="nav-link">
  mock
</a></li><li class="dropdown-item"><!----> <a href="/VUE/wxprogram/" class="nav-link">
  小程序入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/uniapp/" class="nav-link">
  uni-app入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Reactbase/" class="nav-link">
  React基础入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/ReactCli/" class="nav-link">
  React脚手架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Redux/" class="nav-link">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/VUE/react-redux/" class="nav-link">
  react-redux的实现原理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Hooks/" class="nav-link">
  React Hooks
</a></li><li class="dropdown-item"><!----> <a href="/VUE/reactRender/" class="nav-link">
  react渲染和更新机制
</a></li><li class="dropdown-item"><!----> <a href="/VUE/setState/" class="nav-link">
  setState进阶
</a></li><li class="dropdown-item"><!----> <a href="/VUE/nextTick/" class="nav-link">
  Vue.nextTick进阶
</a></li><li class="dropdown-item"><!----> <a href="/VUE/reactHighCom/" class="nav-link">
  react高阶组件
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Reactevent/" class="nav-link">
  react合成事件分析
</a></li><li class="dropdown-item"><!----> <a href="/VUE/frontLogin/" class="nav-link">
  前端登录
</a></li><li class="dropdown-item"><!----> <a href="/VUE/CORS&amp;proxy/" class="nav-link">
  CORS跨域和反向代理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/XHR&amp;AJAX/" class="nav-link">
  XHR对象和AJAX
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Node/Nodejs/" class="nav-link">
  Nodejs服务端
</a></li><li class="dropdown-item"><!----> <a href="/Node/restudyNode/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  重学Node
</a></li><li class="dropdown-item"><!----> <a href="/Node/restudyWebpack/" class="nav-link">
  重学Webpack
</a></li><li class="dropdown-item"><!----> <a href="/Node/promisify/" class="nav-link">
  手写util.promisify
</a></li><li class="dropdown-item"><!----> <a href="/Node/Blob/" class="nav-link">
  Blob数据
</a></li><li class="dropdown-item"><!----> <a href="/Node/nodejsStreamCopy/" class="nav-link">
  nodejs管道流复制文件
</a></li><li class="dropdown-item"><!----> <a href="/Node/Docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/Node/gitlabci/" class="nav-link">
  gitlab-ci
</a></li><li class="dropdown-item"><!----> <a href="/Node/Express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/Node/Koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-item"><!----> <a href="/Node/koaDeploy/" class="nav-link">
  koa部署服务器
</a></li><li class="dropdown-item"><!----> <a href="/Node/MongoDB/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/Node/Mongoose/" class="nav-link">
  Mongoose
</a></li><li class="dropdown-item"><!----> <a href="/Node/zx/" class="nav-link">
  zx库
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript学习" class="dropdown-title"><span class="title">JavaScript学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/note/" class="nav-link">
  js笔记
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/GOGOFACE/" class="nav-link">
  校招面试冲刺
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/manager/" class="nav-link">
  js知识整理
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Promise/" class="nav-link">
  Promise
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/AOP/" class="nav-link">
  AOP切面编程(闭包)
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Generator&amp;yield/" class="nav-link">
  Generator生成器&amp;Iterator迭代器
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/asyncReturn/" class="nav-link">
  async中return和return await的区别
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsFaceObject/" class="nav-link">
  js面向对象基础--创建对象
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsPtototypeChain/" class="nav-link">
  js面向对象基础--原型链
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsBaseExtends/" class="nav-link">
  js面向对象基础--继承
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsPrototypeExtends/" class="nav-link">
  js原型继承
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptCodeClean/" class="nav-link">
  JavaScript代码整洁之道
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptEventLoop/" class="nav-link">
  JavaScript事件循环各种概念剖析
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptThisPoint/" class="nav-link">
  JavaScript简单理解this指向
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/es6this/" class="nav-link">
  谈谈ES6箭头函数this指向问题
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/environment/" class="nav-link">
  词法环境[[environment]]--闭包
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/zuoyongyu/" class="nav-link">
  js函数作用域与闭包相关问题
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/varHosting/" class="nav-link">
  js中的变量提升和函数提升
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/VO&amp;AO/" class="nav-link">
  JS中的变量对象VO和活动对象AO
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JScenter/" class="nav-link">
  JS核心机制（数据类型、垃圾回收机制）
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/handCallApplyBind/" class="nav-link">
  手写call、apply、bind
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataStructure/note/" class="nav-link">
  笔记整理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS特效" class="dropdown-title"><span class="title">CSS特效</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CSSEffect/moreColumLayout/" class="nav-link">
  CSS多列布局的实现
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/writeWords/" class="nav-link">
  打字机效果以及animation中的steps()函数
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/box-shadow/" class="nav-link">
  CSS的box-shadow创建边框
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/CSSPointshow/" class="nav-link">
  纯CSS实现的滚动指示器效果
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/img-lazyload/" class="nav-link">
  图片模糊加载
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/tuozhuai/" class="nav-link">
  实现一个拖拽
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/positionSticky/" class="nav-link">
  实现position:sticky
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/lazyLoad/" class="nav-link">
  实现下拉加载更多，懒加载
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随便聊聊" class="dropdown-title"><span class="title">随便聊聊</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/talktalk/onePic/" class="nav-link">
  一张图总结系列
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/argument/" class="nav-link">
  js的argument
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/bibao/" class="nav-link">
  闭包个人理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/eventloop/" class="nav-link">
  Event Loop理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/chuandicanshu/" class="nav-link">
  js参数传递理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/var/" class="nav-link">
  聊聊js变量存储的本质和const修改对象问题
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/es6open/" class="nav-link">
  ES6扩展运算符的使用
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/dataInVue/" class="nav-link">
  为什么.vue文件中data必须用函数表达
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/jsMaopao/" class="nav-link">
  浅谈js事件捕获和事件冒泡
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFaceTest/" class="nav-link">
  CSS 面试知识点总结
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFirst/" class="nav-link">
  CSS 属性继承和优先级算法(权重)
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSSelector/" class="nav-link">
  了解 CSS 选择器
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSCenter/" class="nav-link">
  总结一下 CSS 居中的各种方法
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFloat/" class="nav-link">
  说说CSS浮动以及清除浮动
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSMargin/" class="nav-link">
  外边距塌陷问题
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSBFC/" class="nav-link">
  浅谈BFC
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HTTP/" class="nav-link">
  HTTP协议
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HTTPS/" class="nav-link">
  聊聊HTTPS工作原理
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/thread/" class="nav-link">
  进程与线程tcp/ip三次握手
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HtmlHead/" class="nav-link">
  你知道HTML中Head标签具体怎么用吗？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/JSONStringify/" class="nav-link">
  JSON.stringify()还可以这么玩
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/ObjectAssign/" class="nav-link">
  Object.assign()的使用指南
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/debounce/" class="nav-link">
  简单防抖函数中闭包的问题理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/throttle/" class="nav-link">
  简单节流函数中闭包的问题理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/doubleBinding/" class="nav-link">
  多种实现双向绑定方法
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/ReactClassComponent/" class="nav-link">
  React类组件的一些问题浅析
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/brower/" class="nav-link">
  浏览器运行原理
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/commonJS&amp;ESmodules/" class="nav-link">
  commonJS和ESmodules差异
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/DOMDIFF/" class="nav-link">
  vue中:key=index为什么不建议使用？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/constUseState/" class="nav-link">
  为什么useState可以使用const解构赋值？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/pipeCopy/" class="nav-link">
  使用管道流复制大文件
</a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1】浏览器引擎"><a href="#_1】浏览器引擎" class="header-anchor">#</a> 1】浏览器引擎</h2> <h3 id="浏览器内核"><a href="#浏览器内核" class="header-anchor">#</a> 浏览器内核</h3> <p>就是指的：排版引擎（页面渲染引擎）。</p> <ul><li>Gecko：早期网景、火狐使用。</li> <li>Trident：微软开发，IE4~11浏览器，但是Edge转向Blink。</li> <li>Webkit：苹果基于KHTML开发、开源。用于Safari、谷歌之前也使用。</li> <li>Blink：是Webkit的一个分支，Google开发，目前用于谷歌、Edge、Opera等。</li></ul> <h3 id="javascript引擎"><a href="#javascript引擎" class="header-anchor">#</a> JavaScript引擎</h3> <p>职责：JS是高级语言------&gt;汇编语言-------&gt;机器语言-----&gt;cpu执行</p> <ul><li>SpiderMonkey</li> <li>Chakra</li> <li>JavaScriptCore：webkit</li> <li>V8：google</li></ul> <h2 id="_2】node版本管理"><a href="#_2】node版本管理" class="header-anchor">#</a> 2】node版本管理</h2> <ul><li>nvm：官方提供</li> <li>n：TJ大神提，供交互式的版本管理（推荐）</li></ul> <h3 id="n"><a href="#n" class="header-anchor">#</a> <a href="https://github.com/tj/n" target="_blank" rel="noopener noreferrer">n<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#安装最新的lts版本</span>
n lts
<span class="token comment">#安装最新的current版本（支持更多语法）</span>
n latest
<span class="token comment">#安装指定版本</span>
n <span class="token number">12.18</span>.1
</code></pre></div><h2 id="_3】repl"><a href="#_3】repl" class="header-anchor">#</a> 3】REPL</h2> <p>REPL（Read-Eval-Print Loop）译为：“读取-求值-输出” 循环；</p> <p>REPL是一个简单的、交互式的编程环境。（相当于浏览器的console控制台）</p> <p>直接在终端输入：<code>node</code>回车进入。</p> <h3 id="全局对象区别："><a href="#全局对象区别：" class="header-anchor">#</a> 全局对象区别：</h3> <p>浏览器中是有window、document等全局对象的，而node中则没有，而是有global、process等全局对象</p> <h2 id="_4】node命令行传参"><a href="#_4】node命令行传参" class="header-anchor">#</a> 4】node命令行传参</h2> <p>获取参数：<code>process.argv</code></p> <ul><li>argc：argument counter的缩写（传入的具体参数）</li> <li>argv：argument vector的缩写（传递参数的个数）
<ul><li>vector 翻译过来是矢量的意思，在程序中表示一直数据结构。</li> <li>JS中是一种数组结构，里面存储一些参数信息。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
</code></pre></div><p>1、当我们直接 <code>node index.js</code> 回车执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//打印出内容：</span>
<span class="token punctuation">[</span>
  <span class="token string">'/usr/local/bin/node'</span><span class="token punctuation">,</span><span class="token comment">//node的全局绝对路径</span>
  <span class="token string">'/Users/mac/Desktop/react_project/NodeRestudy/index.js'</span><span class="token comment">//index.js的绝对路径</span>
<span class="token punctuation">]</span>
</code></pre></div><p>2、当我们传递参数 <code>node index.js env=production platform=ios author=rayhomie</code> 回车执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//打印出内容：</span>
<span class="token punctuation">[</span>
  <span class="token string">'/usr/local/bin/node'</span><span class="token punctuation">,</span><span class="token comment">//node的全局绝对路径</span>
  <span class="token string">'/Users/mac/Desktop/react_project/NodeRestudy/node命令行传参.js'</span><span class="token punctuation">,</span><span class="token comment">//index.js的绝对路径</span>
  <span class="token string">'env=production'</span><span class="token punctuation">,</span><span class="token comment">//接收的参数</span>
  <span class="token string">'platform=ios'</span><span class="token punctuation">,</span><span class="token comment">//接收的参数</span>
  <span class="token string">'author=rayhomie'</span><span class="token comment">//接收的参数</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="_5】常见的全局对象"><a href="#_5】常见的全局对象" class="header-anchor">#</a> 5】常见的全局对象</h2> <h4 id="_1、特殊全局对象"><a href="#_1、特殊全局对象" class="header-anchor">#</a> 1、特殊全局对象</h4> <ul><li>这些特殊全局对象实际上是模块中的变量，只是每个模块有，看起来像是全局变量</li> <li>在命令行交互中不可以使用</li> <li>包括：<code>__dirname</code>、<code>__filename</code>、<code>exports</code>、<code>module</code>、<code>require()</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span>
<span class="token comment">/*
/Users/mac/Desktop/react_project/NodeRestudy
/Users/mac/Desktop/react_project/NodeRestudy/特殊全局对象.js
*/</span>
</code></pre></div><h4 id="_2、常见全局对象"><a href="#_2、常见全局对象" class="header-anchor">#</a> 2、常见全局对象</h4> <ul><li>process对象：提供Node进程相关的信息
<ul><li>比如Node的运行环境、参数信息等</li> <li>还可以将环境变量读取到process的env中</li></ul></li> <li>console对象</li> <li>定时器函数
<ul><li><code>setTimeout</code>：在n毫秒后执行一次</li> <li><code>setInterval</code>：每n毫秒重复执行一次</li> <li><code>setImmediate</code>：I/O事件后的回调“立即”执行</li> <li><code>process.nextTick</code>：添加到下一次tick队列中；</li></ul></li> <li>global对象：所有东西都放在了global对象上（类似浏览器的window对象）</li></ul> <h2 id="_6】模块化"><a href="#_6】模块化" class="header-anchor">#</a> 6】模块化</h2> <p>JavaScript被称之为披着C语言外衣的Lisp。（函数式编程）</p> <p>但是早期JS还是存在很多缺陷：</p> <ul><li>比如var定义的变量作用域问题</li> <li>比如JS的面向对象并不能像常规面向对象语言一样使用class</li> <li>比如JS没有模块化</li></ul> <p>模块化<strong>规范</strong>：AMD、CMD、CommonJS（CJS）、ES Module（ESM）</p> <ul><li>规范都该包含的功能：模块本身可以导出暴露的属性，模块又可以导入自己需要的属性。</li></ul> <h3 id="commonjs"><a href="#commonjs" class="header-anchor">#</a> CommonJS</h3> <ul><li>Node是CommonJS在服务器端一个具有代表性的实现</li> <li><strong>Browserify是CommonJS在浏览器中的一种实现</strong></li> <li>webpack打包工具内部对CommonJS的实现（还有各种模块规范实现）</li></ul> <p>Node中对CommonJS进行了实现和支持：</p> <ul><li>在Node中<strong>每一个js文件是都是一个单独的模块</strong></li> <li>在模块中CJS规范的<strong>核心变量</strong>：<code>exports</code>、<code>module.exports</code>、<code>require</code> <ul><li><code>exports</code>和<code>module.exports</code>负责对模块中的内容进行<strong>导出</strong>。</li> <li><code>require</code>函数可以导入其他模块（自定义模块，系统模块，第三方库模块）中的内容。</li></ul></li></ul> <h4 id="浅拷贝"><a href="#浅拷贝" class="header-anchor">#</a> 浅拷贝</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------------- CJS/module1.js -------------</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>

<span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">20</span>

<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'rayhomie'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token parameter">newName<span class="token punctuation">,</span> newAge</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> newName
  age <span class="token operator">=</span> newAge
  person<span class="token punctuation">.</span>name <span class="token operator">=</span> newName
  person<span class="token punctuation">.</span>age <span class="token operator">=</span> newAge
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//leihao 30</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment">/*
//使用exports导出
exports.name = name
exports.age = age
exports.person = person
exports.modify = modify
*/</span>

<span class="token comment">//使用module.exports导出</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> person<span class="token punctuation">,</span> modify <span class="token punctuation">}</span>

<span class="token comment">//----------------- CJS/main.js -----------------</span>
<span class="token keyword">const</span> module1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./module1.js'</span><span class="token punctuation">)</span>
<span class="token comment">//实际上是浅拷贝拷贝了一份module1.js模块对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
{
  name: 'rayhomie',
  age: 20,
  person: { name: 'rayhomie', age: 20 },
  modify: [Function: modify]
}
*/</span>
module1<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token string">'leihao'</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
{
  name: 'rayhomie',
  age: 20,
  person: { name: 'leihao', age: 30 },
  modify: [Function: modify]
}
*/</span>
<span class="token comment">/*
//module1.js中的setTimeout打印：
leihao 30
*/</span>
</code></pre></div><p>理解：默认情况下模块的exports变量指向一个空对象，<code>require()</code>执行返回的是exports变量指向的对象。我们导出的操作是<code>exports.key=value</code>或<code>module.exports={...}</code>，这样对对象设置属性也就是：将要暴露的属性浅拷贝到exports指向的对象上。所以<strong>CJS是导出其实是浅拷贝模块</strong>。</p> <p><img src="https://img-blog.csdnimg.cn/20210509172659636.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <h4 id="module-exports和exports有什么区别？"><a href="#module-exports和exports有什么区别？" class="header-anchor">#</a> module.exports和exports有什么区别？</h4> <p>通过维基百科中对CommonJS的规范的解析：</p> <ul><li>CJS中是没有module.exports的概念的</li> <li>但是为了实现模块的导出，Node中使用的是Module的类，每一个模块都是Module的一个实例（<code>new Module()</code>），也就是每一个文件都是一个module实例。</li> <li>所以在Node中真正用于导出的其实不是exports，而是<strong>module.exports</strong></li> <li><strong>其实直接使用exports导出，node内部也是通过module.exports来实现的</strong>。</li></ul> <p>因为源码里面做了一件事情：在当前模块最顶层执行<code>module.exports=exports</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ CJS/module2.js -------------------</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>

exports<span class="token punctuation">.</span>name <span class="token operator">=</span> name

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> exports <span class="token operator">===</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//{ name: 'rayhomie' } { name: 'rayhomie' } true</span>

<span class="token comment">//------------- CJS/module3.js --------------------</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//{} { name: 'rayhomie' }</span>
</code></pre></div><h4 id="require的查找规则"><a href="#require的查找规则" class="header-anchor">#</a> require的查找规则</h4> <p>常见：<code>require(X)</code></p> <ul><li>情况一：X是一个核心模块，比如path、http
<ul><li>直接返回核心模块，并停止查找</li></ul></li> <li>情况二：X是以<code>./</code>或<code>../</code>或<code>/</code>（根目录）开头的
<ul><li>将X当做一个文件在对应的本地目录下查找
<ul><li>如果有后缀名，按照后缀名的格式查找对应文件</li> <li>如果没有后缀名，会按照以下顺序：<code>X</code>、<code>X.js</code>、<code>X.json</code>、<code>X.node</code>的顺序查找</li></ul></li> <li>如果没有找到对应文件，则将X作为一个目录
<ul><li>查找该目录下的index文件：<code>X/index.js</code>、<code>X/index.json</code>、<code>X/index.node</code></li></ul></li> <li>如果还没有找到，那么就报错：not found</li></ul></li> <li>情况三：直接是一个X（没有路径），并且X不是一个核心模块
<ul><li>在当前文件夹下的node_modules文件夹下面查找</li> <li>如果没有，则递归依次向上层查找，直到<code>/node_modules</code>根目录下（全局依赖）</li> <li>如果还没有找到，那么报错：not found</li></ul></li></ul> <h4 id="模块加载过程"><a href="#模块加载过程" class="header-anchor">#</a> 模块加载过程</h4> <ul><li>模块在被第一次引入时，模块中的js代码会被<strong>运行一次</strong></li> <li>模块多次引入时，会<strong>缓存</strong>，最终只加载（运行）一次
<ul><li>Module实例上面有一个loaded属性，用于标记是否被加载过。</li></ul></li> <li>加载过程是深度优先算法DFS。</li> <li>加载过程是同步的，会阻塞代码执行</li></ul> <h3 id="amd"><a href="#amd" class="header-anchor">#</a> AMD</h3> <ul><li>Asynchronous Module Definition（异步模块定义）</li> <li>它采用的是异步异步加载模块（加载的时候不影响后面代码的运行）</li></ul> <p>规范这是定义代码应该如何去编写，只有有了具体的实现才能被应用：</p> <ul><li>AMD的实现比较常用的库是 require.js 和 curl.js</li></ul> <p>require.js的使用：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--  index.html  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./lib/require.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-main</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./index.js<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- data-main属性定义项目脚本入口（等到src中的require.js加载完，立即去获取data-main中的文件并执行） --&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ index.js --------------</span>
<span class="token comment">//入口用于声明配置管理模块</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//require是外部require.js加载的全局变量</span>
  require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//需要配置</span>
    baseUrl<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    paths<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//模块名与路径的映射(不加后缀名)</span>
      <span class="token string">&quot;module1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./modules/module1&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;module2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./modules/module2&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//加载module2.js中的代码</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'module2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//------------ ./modules/module1.js --------------</span>
<span class="token comment">//每个模块需要使用define来定义</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>
  <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">20</span>
  <span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好'</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token comment">//暴露给外部</span>
    name<span class="token punctuation">,</span>
    age<span class="token punctuation">,</span>
    sayHello
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//------------ ./modules/module2.js --------------</span>
<span class="token comment">//每个模块需要使用define来定义</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token string">'module1'</span><span class="token comment">//依赖的模块</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//使用参数来接收导入的变量</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
  module1<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">'leihao'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="cmd"><a href="#cmd" class="header-anchor">#</a> CMD</h3> <ul><li>Common Module Definition（通用模块定义）</li> <li>它采用了<strong>异步加载模块</strong>，吸取了Commonjs的写法简便的优点。</li> <li>（加载的时候不影响后面代码的运行）</li> <li>CMD规范的实现，比较常用的库是：Sea.js</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./lib/sea.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">//直接使用脚本的主入口(区别于AMD，主入口中不需要配置管理各个模块)。</span>
  seajs<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'./index.js'</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ index.js --------------</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//和Commonjs规范差不多的导出导入</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sayHello <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./modules/module1.js'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">'leihao'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//------------ ./modules/module1.js --------------</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>
  <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">20</span>
  <span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//和Commonjs规范差不多的导出导入</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sayHello <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="es-module"><a href="#es-module" class="header-anchor">#</a> ES Module</h3> <ul><li>它使用了 import 和 export <strong>关键字</strong>（并不是函数和对象，需要js引擎解析）</li> <li>它采用了编译期的静态分析，并且也加入了动态引用的方式</li> <li><strong>ESM由js引擎解析，在解析时已经确定了模块的依赖关系</strong>（在转换成AST之前），所以导入必须写在模块最前面。但ESM还提供了<code>import()</code>的运行时环境。
<ul><li><code>parse-&gt;ast-&gt;bytecode-&gt;runtime</code></li></ul></li> <li>ESM将自动采用严格模式：<code>use strict</code></li></ul> <h5 id="浏览器上使用"><a href="#浏览器上使用" class="header-anchor">#</a> 浏览器上使用</h5> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html --&gt;</span> 
<span class="token comment">&lt;!-- 设置type=&quot;module&quot;让js引擎识别 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./index.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ index.js --------------</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4" target="_blank" rel="noopener noreferrer">报错问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：直接在浏览器打开index.html本地文件，会报跨域错误，由于浏览器的安全限制，不支持module以file的协议引入。解决办法是把index.html放在服务器上面，然后浏览器去请求。（VScode中可以安装Live Server插件，然后打开）</p> <p><img src="https://img-blog.csdnimg.cn/20210511104303434.png" alt="cors报错"></p> <p><img src="https://img-blog.csdnimg.cn/20210511104923427.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="放到服务器"></p> <h5 id="导出方式"><a href="#导出方式" class="header-anchor">#</a> 导出方式</h5> <ul><li>方式一：导出变量<code>export const x</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ ./modules/module1.js --------------</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//------------ index.js --------------</span>
<span class="token comment">//分别导入变量</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sayHello <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./modules/module1.js'</span><span class="token punctuation">;</span>
<span class="token comment">//分别导入变量并起别名</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> name <span class="token keyword">as</span> Name<span class="token punctuation">,</span> age <span class="token keyword">as</span> Age<span class="token punctuation">,</span> sayHello <span class="token keyword">as</span> SayHello <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./modules/module1.js'</span><span class="token punctuation">;</span>
<span class="token comment">//分别导入全部变量放在一个对象中并起别名</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> module1 <span class="token keyword">from</span> <span class="token string">'./modules/module1.js'</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>方式二：导出变量列表<code>export { x, y, z }</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ ./modules/module1.js --------------</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sayHello <span class="token punctuation">}</span><span class="token comment">//导出的不是对象，只是语法（放置要导出的变量的引用列表）</span>
<span class="token comment">//------------ index.js --------------</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sayHello <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./modules/module1.js'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">'leihao'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>方式三：给变量起别名<code>export { x as X, y as Y, z as Z }</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ ./modules/module1.js --------------</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> name <span class="token keyword">as</span> Name<span class="token punctuation">,</span> age <span class="token keyword">as</span> Age<span class="token punctuation">,</span> sayHello <span class="token keyword">as</span> SayHello<span class="token punctuation">}</span>
<span class="token comment">//------------ index.js --------------</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Name<span class="token punctuation">,</span> Age<span class="token punctuation">,</span> SayHello <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./modules/module1.js'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> Age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SayHello</span><span class="token punctuation">(</span><span class="token string">'leihao'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>方式四：默认导出（不需要变量名字）<code>export default { xxx, yyy, zzz }</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ ./modules/module1.js --------------</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sayHello <span class="token punctuation">}</span>
<span class="token comment">//------------ index.js --------------</span>
<span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">'./modules/module1.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sayHello <span class="token punctuation">}</span> <span class="token operator">=</span> module1
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">'leihao'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>方式五：导入+导出的语法<code>export { * as module1 } from './modules/module1.js'</code></li></ul> <p>一般用于封装库的时候，将所有接口放在一个文件中暴露</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ ./modules/module1.js --------------</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sayHello <span class="token punctuation">}</span>
<span class="token comment">//------------ index.js --------------</span>
<span class="token comment">//先导入全部变量，再导出</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token operator">*</span> <span class="token keyword">as</span> module1 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./modules/module1.js'</span>
</code></pre></div><h5 id="import函数"><a href="#import函数" class="header-anchor">#</a> import函数</h5> <p><code>parse-&gt;ast-&gt;bytecode-&gt;runtime</code></p> <p><strong>ESM由js引擎解析，在解析时已经确定了模块的依赖关系</strong>（在转换成AST之前），所以导入必须写在模块最前面。但ESM还提供了<code>import()</code>的运行时环境（异步加载）。（浏览器环境没有<code>require()</code>来加载模块，因为不支持CommonJS）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ index.js --------------</span>
<span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//运行时环境</span>
  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./modules/module1.js'</span><span class="token punctuation">)</span>
  <span class="token comment">//返回promise</span>
  promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在webpack中使用ESM规范的<code>import()</code>会将该文件进行单独打包，用于动态加载。</p> <h5 id="打包工具和浏览器环境的esm区别"><a href="#打包工具和浏览器环境的esm区别" class="header-anchor">#</a> 打包工具和浏览器环境的ESM区别</h5> <p>webpack、rollup等模块化打包工具，只是<strong>实现了ESM规范，然后帮我们把代码解析转化模块化打包</strong>，打包出来的代码是常规浏览器都支持运行的代码（<strong>不需要浏览器再去解析一次</strong>，直接到浏览器运行代码即可）。需要跟浏览器环境的ESM做区别，<strong>浏览器环境的ESM代码是由JS引擎去解析并执行</strong>。</p> <h5 id="浏览器esm加载过程"><a href="#浏览器esm加载过程" class="header-anchor">#</a> 浏览器ESM加载过程</h5> <ul><li><p>浏览器ESM加载js文件的过程是<strong>编译（解析）时加载</strong>的，并且是<strong>异步</strong>的。</p> <ul><li><p>import不能和运行时相关的内容放在一起使用：from后面的路径不能动态获取；不能建import放在条件语句中；</p></li> <li><p>异步：体现在在script标签中设置了<code>type='module'</code>，那么这个srcipt脚本就是异步的就不会阻塞其他的脚本内容加载。相当于默认加了一个async属性。</p></li> <li><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 设置type=&quot;module&quot;让js引擎识别 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./index.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 由于浏览器中ES module异步加载，所以不会阻塞后面的脚本执行（相当于默认加了一个async属性） --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./react.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li> <li><p>ESM通过export导出的是<strong>变量本身的引用</strong>（无论 <strong>基本</strong> 还是 <strong>引用</strong> 类型变量，都可以实时的获取到修改后的值，区别于CommonJS）</p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//------------ ./modules/module1.js --------------</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">'leihao'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>

<span class="token comment">//CommonJS导出的是对象，所以基本类型就无法获取到变化之后的值。</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token comment">//记住导出的不是对象，而是一种语法！！！</span>


<span class="token comment">//------------ index.js --------------</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./modules/module1.js'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment">//结果：立即输出rayhomie，一秒后输出leihao。</span>
</code></pre></div></li></ul></li></ul> <p>ESM做了基本数据的实时绑定：（<strong>导入的基本数据类型值不能修改，但是引用数据类型可以修改它的属性</strong>）</p> <p><img src="https://img-blog.csdnimg.cn/20210511143948502.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="ESM绑定"></p> <h5 id="在node中使用esm"><a href="#在node中使用esm" class="header-anchor">#</a> 在node中使用ESM</h5> <p>node的JS引擎也是本身有ES module的实现，但是默认是使用的CommonJS模块，我们需要以下操作，才可以让nodeJS引擎去解析ES module的模块代码。</p> <ol><li>在package.json中设置<code>type:module</code></li> <li>或者使用.mjs作为拓展名，node才会把他当成ES的模块。</li></ol> <h5 id="cjs和esm交互"><a href="#cjs和esm交互" class="header-anchor">#</a> CJS和ESM交互</h5> <ul><li>通常情况下，<strong>CommonJS不能加载ES module</strong> <ul><li>CJS是同步执行加载，但ESM必须经过静态分析，才可以执行。</li> <li>Node中不支持</li> <li>webpack等打包工具，可以支持。</li></ul></li> <li>多数情况下，<strong>ES module可以加载CommonJS</strong> <ul><li>ES module在加载CommonJS时，会将其<code>module.exports</code>导出的内容作为<code>export default</code>导出方式来使用</li> <li>这个依然要看具体的规范实现，比如webpack中是支持的，Node最新的Current版本也是支持的</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//Node v16.1.0</span>
<span class="token comment">//------------ ./modules/module.js --------------</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'rayhomie'</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">20</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span><span class="token comment">//CommonJS导出</span>

<span class="token comment">//------------ index.mjs --------------</span>
<span class="token keyword">import</span> module2 <span class="token keyword">from</span> <span class="token string">'./modules/module2.js'</span><span class="token punctuation">;</span><span class="token comment">//ES module导入</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//{ name: 'rayhomie', age: 20 }</span>
</code></pre></div><h2 id="_7】常见内置模块"><a href="#_7】常见内置模块" class="header-anchor">#</a> 7】常见内置模块</h2> <h3 id="path模块"><a href="#path模块" class="header-anchor">#</a> path模块</h3> <h5 id="①路径拼接"><a href="#①路径拼接" class="header-anchor">#</a> ①路径拼接</h5> <ul><li><code>path.resolve</code></li> <li><code>path.join</code></li></ul> <p>区别：resolve会判断我们拼接的路径字符串<strong>第一个参数</strong>中，是否有以<code>/</code>或<code>./</code>或<code>../</code>开头的路径</p> <ol><li><code>/</code>：如果以<code>/</code>开头则直接拼接</li> <li><code>无/</code>或<code>./</code>：如果是以<code>./</code>开头，则是从电脑根路径开始cd拼接（没有<code>/</code>也会被当成<code>./</code>，比如：<code>'user/mac'等价于'./user/mac'</code>）</li> <li><code>../</code>：如果以<code>../</code>开头也是从电脑根路径开始cd拼接，但是需要cd到上一层目录</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//记住下面的这三个拼接是一样的：</span>
path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'index.js'</span><span class="token punctuation">)</span><span class="token comment">// /Users/mac/index.js</span>
path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'index.js'</span><span class="token punctuation">)</span><span class="token comment">// /Users/mac/index.js</span>
path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'/index.js'</span><span class="token punctuation">)</span><span class="token comment">// /Users/mac/index.js</span>
<span class="token comment">//但是下面这个不一样：</span>
path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'/index.js'</span><span class="token punctuation">)</span><span class="token comment">// /index.js</span>
</code></pre></div><p>写一个resolve方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">dir</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">///Users/mac/src</span>

<span class="token comment">//webpack中就使用这样的方式起别名：</span>
<span class="token punctuation">{</span>
  alias<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string">&quot;@&quot;</span><span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&quot;components&quot;</span><span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src/components&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="②获取路径信息"><a href="#②获取路径信息" class="header-anchor">#</a> ②获取路径信息</h5> <ul><li><code>path.dirname</code>：文件夹路径</li> <li><code>path.basename</code>：文件名</li> <li><code>path.extname</code>：后缀名</li></ul> <h3 id="fs模块"><a href="#fs模块" class="header-anchor">#</a> fs模块</h3> <p>①同步操作②异步回调③异步promises</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token string">'./text.txt'</span>

<span class="token comment">//同步操作</span>
<span class="token keyword">const</span> syncFile <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>syncFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//异步回调</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取的内容是：'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token comment">//默认是读取到十六进制的buffer类型</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//Buffer转成String类型</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//使用promises</span>
<span class="token keyword">const</span> promisesFile <span class="token operator">=</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
promisesFile<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="events模块"><a href="#events模块" class="header-anchor">#</a> events模块</h3> <h5 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>

<span class="token comment">//1.创建发射器实例</span>
<span class="token keyword">const</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//2.监听某个事件</span>
<span class="token comment">//on是addListener的简写</span>
emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'eventname'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听到了eventname事件第1次'</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
emitter<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'eventname'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听到了eventname事件第2次'</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//3.触发事件</span>
emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'eventname'</span><span class="token punctuation">,</span><span class="token string">'rayhomie'</span><span class="token punctuation">,</span><span class="token string">'leihao'</span><span class="token punctuation">)</span>


<span class="token comment">/*
打印结果:
监听到了eventname事件第1次 rayhomie leihao
监听到了eventname事件第2次 rayhomie leihao
*/</span>
</code></pre></div><h5 id="不常用"><a href="#不常用" class="header-anchor">#</a> 不常用</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'tap'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听到了tap'</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听到了click'</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>emitter<span class="token punctuation">.</span><span class="token function">eventNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [ 'tap', 'click' ]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>emitter<span class="token punctuation">.</span><span class="token function">listenerCount</span><span class="token punctuation">(</span><span class="token string">'tap'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>emitter<span class="token punctuation">.</span><span class="token function">listeners</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [ [Function (anonymous)] ]</span>
</code></pre></div><h2 id="_8】npm包管理"><a href="#_8】npm包管理" class="header-anchor">#</a> 8】Npm包管理</h2> <h3 id="package-json"><a href="#package-json" class="header-anchor">#</a> package.json</h3> <p>必填写的属性：name、version</p> <ul><li><p>name是项目的名称</p></li> <li><p>version是的当前项目的版本号</p></li> <li><p>private记录当前的项目是否私有</p></li> <li><p>description是描述信息</p></li> <li><p>author是作者相关信息</p></li> <li><p>license是开源协议</p></li> <li><p>main属性（在webpack中这个mian字段没有用，因为入口交给webpack去打包了，而且这个main定义的<strong>入口只遵循CommonJS规范</strong>，<strong>不支持tree-shaking</strong>）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//别人使用我们的包时，require时就会到node_modules下的包里面找main入口文件去加载。</span>
<span class="token keyword">const</span> rayhomieui<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rayhomieui'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>module属性不是npm官方的字段（webpack和rollup联合推出），定义了<strong>ES module规范的入口</strong>（<strong>方便tree-shaking</strong>）</p></li> <li><p>types属性是定义<strong>类型声明文件入口</strong></p></li> <li><p>browserslist属性：用于配置打包后的JavaScript浏览器的兼容情况，否则我们需要配置polyfills来支持语法。</p></li></ul> <h3 id="依赖版本号"><a href="#依赖版本号" class="header-anchor">#</a> 依赖版本号</h3> <p>semver版本规范X.Y.Z：</p> <ul><li>X主版本号（major）：兼容不了以前的版本。</li> <li>Y次版本号（minor）：向下兼容，加了新功能特性。</li> <li>Z修订号（patch）：没有新功能，只是修复之前版本的bug。</li></ul> <p><code>^x.y.z</code>：表示x保持不变的，y和z永远安装最新版本。</p> <p><code>~x.y.z</code>：表示x和y保持不变的，z永远安装最新版本。</p> <h3 id="npm-install原理"><a href="#npm-install原理" class="header-anchor">#</a> npm install原理</h3> <p><img src="https://img-blog.csdnimg.cn/20210515155727395.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="原理流程图"></p> <p>查看npm缓存</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#获取当前的缓存文件夹</span>
<span class="token function">npm</span> config get cache
</code></pre></div><h3 id="yarn工具"><a href="#yarn工具" class="header-anchor">#</a> yarn工具</h3> <p>弥补npm早期的缺陷，npm5改进升级了很多。</p> <p><code>npm i yarn -g</code>全局安装yarn。</p> <h3 id="npx"><a href="#npx" class="header-anchor">#</a> npx</h3> <p>npx是npm5.2之后自带的一个工具</p> <p>作用：常用用它来调用项目中的某个模块的命令。</p> <p>举例：比如我们全局安装webpack@5.37.0，项目中安装webpack@3.6.0。此时我们在项目中使用命令<code>webpack --version</code>，使用的是全局的5.37.0。此时我们想要使用项目中的局部命令，①只能通过<code>./node_modules/.bin/webpack --version</code>来使用局部webpack，②在package.json中设置脚本也是使用的局部的命令，③也可通过<code>npx webpack --version</code>来调用局部命令。</p> <h2 id="_9】手写脚手架"><a href="#_9】手写脚手架" class="header-anchor">#</a> 9】手写脚手架</h2> <h3 id="命令行编写"><a href="#命令行编写" class="header-anchor">#</a> 命令行编写</h3> <p>需要使用到Linux中的**shebang（hashbang）**符号<code>#!</code>，作用是根据环境来执行脚本。</p> <p>下面这个就是在index.js文件中写了一句shebang代码，表示的是别人在运行这个脚本的时候，需要根据环境去找node可执行文件，然后找到node之后去执行index.js后面的代码内容。</p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="配置bin字段"><a href="#配置bin字段" class="header-anchor">#</a> 配置bin字段</h3> <p>在package.json中有一个<strong>bin字段</strong>，可以对当前包的终端命令行进行配置：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lh&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//配置命令行</span>
    <span class="token property">&quot;lh&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token comment">//当别人安装我们的包之后，可以指向lh命令。然后就去运行index.js</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rayhomie &lt;1572801584@qq.com&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>流程：但别人安装了我们的包之后可以使用我们在bin中定义的<code>lh</code>命令，去执行<code>index.js</code>文件，而且会根据文件中的<code>shebang</code>指令去当前环境找node，器执行文件中的脚本。</p> <h3 id="开发时link测试"><a href="#开发时link测试" class="header-anchor">#</a> 开发时link测试</h3> <p>我们在开发时，可以在当前包下使用<code>npm link</code>命令。将包链接到当前环境，然后就可以模拟用户安装了我们的包的操作，再使用我们的包了。软链接后的包可以在全局包中目录下查看<code>npm root -g</code>，正式发包后可以把它删除了。</p> <p>此时在终端命令行使用<code>lh</code>命令，即可看到终端输出<code>hello world</code>。</p> <h3 id="命令参数传递"><a href="#命令参数传递" class="header-anchor">#</a> 命令参数传递</h3> <p>例子，写一个<code>lh --version</code>查看版本号的命令。</p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
<span class="token comment">//参数-v,--version获取版本号</span>
process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string">'--version'</span><span class="token punctuation">,</span> <span class="token string">'-V'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token operator">&amp;&amp;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样通过process.argv来获取参数判断显然很麻烦，所以我们可以使用一个<strong>commander库</strong>进行命令行开发更方便。</p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span>
program<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span>
program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token comment">//解析参数,--help</span>
</code></pre></div><p>此时在终端输入<code>lh --help</code>可以解析出所有的参数。<code>lh --version</code>就可以显示当前版本号。</p> <h3 id="commander"><a href="#commander" class="header-anchor">#</a> <a href="https://github.com/tj/commander.js/blob/master/Readme_zh-CN.md" target="_blank" rel="noopener noreferrer">commander<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span>
<span class="token comment">//查看版本号</span>
program<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span>

<span class="token comment">//添加自己的options</span>
program<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-h --lh'</span><span class="token punctuation">,</span> <span class="token string">'a lh cli'</span><span class="token punctuation">)</span>
<span class="token comment">//手动设置路径，&lt;&gt;为可选参数</span>
program<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d --dest &lt;dest&gt;'</span><span class="token punctuation">,</span> <span class="token string">'a destination folder, example: -d /src/components'</span><span class="token punctuation">)</span>
<span class="token comment">//监听参数传递</span>
program<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'--help'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听到--help!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//解析一定要写在参数配置的后面</span>
program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>

<span class="token comment">/*
//在program.parse后面可以获取到参数信息
const opts = program.opts()
//lh -h，打印：true
console.log(opts.lh);
//lh -d /src/components，打印：/src/components
console.log(opts.dest);
*/</span>

<span class="token comment">//命令</span>
program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'create &lt;project&gt; [others...]'</span><span class="token punctuation">)</span><span class="token comment">//创建命令</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'clone repository into a folder'</span><span class="token punctuation">)</span><span class="token comment">//描述</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">project<span class="token punctuation">,</span> others</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">//可以获取参数</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>project<span class="token punctuation">,</span> others<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//触发</span>
</code></pre></div><h3 id="download-git-repo"><a href="#download-git-repo" class="header-anchor">#</a> <a href="https://www.npmjs.com/package/download-git-repo" target="_blank" rel="noopener noreferrer">download-git-repo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>使用这个库可以用node克隆git的仓库到本地。</p> <h3 id="promisify"><a href="#promisify" class="header-anchor">#</a> promisify</h3> <p>在node中可以使用node提供的工具，将回调形式转成promise</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">download</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="node执行终端命令"><a href="#node执行终端命令" class="header-anchor">#</a> node执行终端命令</h3> <p>需要用到<a href="https://nodejs.org/dist/latest-v16.x/docs/api/child_process.html#child_process_child_process_spawn_command_args_options" target="_blank" rel="noopener noreferrer">child_process模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（封装terminal.js）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//进程通信</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> exec<span class="token punctuation">,</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">commandSpawn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建子进程，执行终端命令，并返回子进程，获取子进程信息</span>
    <span class="token keyword">const</span> childProcess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token comment">//返回值是该子进程（进行进程间通信）</span>
    childProcess<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token comment">//将子进程的输出流导入到当前进程的输出流中</span>
    childProcess<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span><span class="token comment">//错误信息导入</span>
    childProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//监听关闭</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">commandExec</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> childProcess <span class="token operator">=</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
    childProcess<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
    childProcess<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
    childProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  commandSpawn<span class="token punctuation">,</span>
  commandExec
<span class="token punctuation">}</span>
</code></pre></div><p>进行调用执行终端命令。具体exec和spawn的参数可以在<a href="https://nodejs.org/dist/latest-v16.x/docs/api/child_process.html#child_process_child_process_spawn_command_args_options" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查看。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">commandSpawn</span><span class="token punctuation">(</span>npm<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token string">'--force'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> cwd<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>project<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//cwd选择执行路径</span>
</code></pre></div><h3 id="使用node修改文件内容"><a href="#使用node修改文件内容" class="header-anchor">#</a> 使用node修改文件内容</h3> <p>这里就举个栗子，修改packge.json中的name字段</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">//使用promisify包裹</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> readFile <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readFile<span class="token punctuation">)</span>
<span class="token keyword">const</span> writeFile <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>writeFile<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">writeProjectName</span><span class="token punctuation">(</span><span class="token parameter">Path<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//修改package.json的name（传入的参数是项目根路径，name字段需要更改的名字）</span>
  <span class="token comment">//读取文件</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>Path<span class="token punctuation">,</span> <span class="token string">'package.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> newList <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">//暂存新对象</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> name
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>
    newList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> newContent <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>newList<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//重写文件</span>
  <span class="token keyword">await</span> <span class="token function">writeFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>Path<span class="token punctuation">,</span> <span class="token string">'package.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newContent<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> writeProjectName
</code></pre></div><h2 id="_10】buffer"><a href="#_10】buffer" class="header-anchor">#</a> 10】Buffer</h2> <p>计算机中所有的内容最终都会使用二进制来表示，如文字、数字、图片、音频、视频等。</p> <p><strong>js中0x开头的都是16进制数。</strong></p> <p>使用常用场景：</p> <ul><li>在node使用buffer对二进制数据进行处理。Node中可以使用<a href="https://sharp.pixelplumbing.com/" target="_blank" rel="noopener noreferrer"><strong>sharp库</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，就是读取图片或者传入图片的Buffer对其再进行处理。</li> <li>一个保存文本的文件并不是使用utf-8进行编码的，而是使用GBK，那么我们必须读取到他们的二进制数据，再通过GBK转换成对应的文字。</li> <li>Node中通过TCP建立长连接，TCP传输的是字节流，我们需要将数据转成字节再进行传入，并且需要知道传输字节的大小（客户端需要根据大小来判断读取多少内容）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//推荐使用Buffer.from,而不是new Buffer</span>

<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token string">'你好啊'</span>
<span class="token comment">//1.对中文使用buffer进行utf8的编码 </span>
<span class="token keyword">let</span> utf8buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utf8buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &lt;Buffer e4 bd a0 e5 a5 bd e5 95 8a&gt;</span>
<span class="token comment">//2.toString默认对utf8解码</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utf8buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 你好啊</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utf8buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf16le'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 뷤붥闥</span>

<span class="token comment">//1.对中文使用buffer进行utf16le的编码 </span>
<span class="token keyword">let</span> utf16lebuffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token string">'utf16le'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utf16lebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &lt;Buffer 60 4f 7d 59 4a 55&gt;</span>
<span class="token comment">//2.toString对utf16le解码</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utf16lebuffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf16le'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 你好啊</span>
</code></pre></div><h3 id="buffer的创建方式"><a href="#buffer的创建方式" class="header-anchor">#</a> buffer的创建方式</h3> <h4 id="new-buffer"><a href="#new-buffer" class="header-anchor">#</a> <a href="https://nodejs.org/dist/latest-v16.x/docs/api/buffer.html#buffer_new_buffer_string_encoding" target="_blank" rel="noopener noreferrer">new Buffer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Deprecated: Use <code>Buffer.from(string[, encoding])</code>instead.</p> <p>被重声明，请使用Buffer.from</p> <h4 id="buffer-from"><a href="#buffer-from" class="header-anchor">#</a> <a href="https://nodejs.org/dist/latest-v16.x/docs/api/buffer.html#buffer_static_method_buffer_from_string_encoding" target="_blank" rel="noopener noreferrer">Buffer.from<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//Buffer.from(string[, encoding])</span>
<span class="token keyword">const</span> buf1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'buffer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> buf2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>buf1<span class="token punctuation">)</span><span class="token punctuation">;</span>

buf1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x61</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Prints: auffer</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Prints: buffer</span>
</code></pre></div><h4 id="buffer-alloc"><a href="#buffer-alloc" class="header-anchor">#</a> <a href="https://nodejs.org/dist/latest-v16.x/docs/api/buffer.html#buffer_static_method_buffer_alloc_size_fill_encoding" target="_blank" rel="noopener noreferrer">Buffer.alloc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//Buffer.alloc(size[,fill[,encoding]])</span>
<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token comment">//给当前buffer分配8个字节内存</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &lt;Buffer 00 00 00 00 00 00 00 00&gt;</span>
<span class="token comment">//直接修改buffer内容</span>
buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">88</span><span class="token comment">// 十进制的88</span>
buffer<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x88</span><span class="token comment">// 十六进制的88</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &lt;Buffer 58 88 00 00 00 00 00 00&gt;</span>

<span class="token keyword">let</span> fillbuffer<span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'12'</span><span class="token punctuation">)</span><span class="token comment">// 分配8字节并填充满字符串</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fillbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &lt;Buffer 31 32 31 32 31 32 31 32&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fillbuffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 12121212</span>
</code></pre></div><h3 id="buffer和文件操作"><a href="#buffer和文件操作" class="header-anchor">#</a> Buffer和文件操作</h3> <p><strong>读取文件的本质都是读取二进制数据</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//文本文件处理</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./text.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> encoding<span class="token operator">:</span> <span class="token string">'utf8'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 雷浩</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./text.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &lt;Buffer e9 9b b7 e6 b5 a9&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 雷浩</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="使用sharp处理图片文件"><a href="#使用sharp处理图片文件" class="header-anchor">#</a> 使用<a href="https://github.com/lovell/sharp#documentation" target="_blank" rel="noopener noreferrer">sharp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>处理图片文件</h3> <p>（它内部也是需要拿到buffer数据来处理图片）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//处理图片文件</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">//使用sharp库来处理图片数据https://github.com/lovell/sharp#documentation</span>
<span class="token keyword">const</span> sharp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sharp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//方式一：传入buffer</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./picture.jpg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">sharp</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token string">'./20x20.jpg'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//方式二：传入路径</span>
<span class="token function">sharp</span><span class="token punctuation">(</span><span class="token string">'./picture.jpg'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token string">'./100x100.jpg'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_11】事件循环和异步io"><a href="#_11】事件循环和异步io" class="header-anchor">#</a> 11】事件循环和异步IO</h2> <h3 id="事件循环"><a href="#事件循环" class="header-anchor">#</a> 事件循环</h3> <ul><li>事实上我们把事件循环理解成我们编写的JavaScript和浏览器或者Node之间的一个桥梁。</li> <li>浏览器事件循环是一个我们编写的JavaScript代码和浏览器Api调用（setTimeout/AJAX/监听事件等）的一个桥梁，桥梁之间他们通过回调函数进行沟通。</li> <li>Node的事件循环是一个我们编写的JavaScript代码和系统调用（fs、network）之间的一个桥梁，桥梁之间他们通过回调函数进行沟通。</li></ul> <h3 id="进程和线程"><a href="#进程和线程" class="header-anchor">#</a> 进程和线程</h3> <ul><li>进程（process）：计算机已经运行的应用程序；</li> <li>线程（thread）：操作系统中能够运行运算调度的最小单位；</li> <li>进程可以看成线程的容器。</li></ul> <h3 id="浏览器事件循环"><a href="#浏览器事件循环" class="header-anchor">#</a> 浏览器事件循环</h3> <p>宏任务：同步代码、timer回调、浏览器事件回调、ajax回调、DOM监听、UI Rendering</p> <p>微任务：Promise的then回调、Mutation Observer API、queueMicrotask()等</p> <p>宏任务执行结束完成后立即去<strong>清空微任务队列</strong>，直到微任务被清空才去执行下一轮宏任务。（<strong>只维护两个队列：消息队列和微任务队列</strong>）</p> <ul><li>在执行任何<strong>一个宏任务</strong>之前（不是列队，是一个宏任务），都会先去查看微任务队列中是否有任务需要执行
<ul><li>也就是宏任务执行之前，必须保证微任务队列是空的</li> <li>如果不为空，那么就优先执行微任务队列中的任务（回调）</li></ul></li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'开始'</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'结束'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'then'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//顺序：开始-----------&gt;then--&gt;结束</span>
  <span class="token comment">//等待若干秒后才执行结束。因为timer的回调需要等待宏任务结束才执行</span>
  <span class="token comment">//浏览器事件、ajax等和timer一样都是异步宏任务，会被加到宏任务队列</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="题目一："><a href="#题目一：" class="header-anchor">#</a> 题目一：</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pr1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'queueMicrotask1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//答案：</span>
<span class="token comment">/*
pr1
2
then1
queueMicrotask1
then3
set1
then2
then4
set2
*/</span>
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/20210517164211964.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <h4 id="题目二："><a href="#题目二：" class="header-anchor">#</a> 题目二：</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//答案：</span>
<span class="token comment">/*
script start
async1 start
async2
promise1
script end
async1 end
promise2
setTimeout
*/</span>
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/2021051716583952.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p><code>await async2()</code>可以看做成<code>new Promise(resolve=&gt;{ async2() .. })</code></p> <p><code>await</code>下面的代码就是认为是<code>then</code>回调函数中的代码</p> <h4 id="题目三："><a href="#题目三：" class="header-anchor">#</a> 题目三：</h4> <p>被resolve之后才会调用一次.then。（连续的.then调用是一次一次加入微任务中的）</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/*
1
3
2
*/</span>
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/21875fab528a470789d71cfc6e7a5953.png" alt="题目三"></p> <h4 id="题目四："><a href="#题目四：" class="header-anchor">#</a> 题目四：</h4> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'宏任务'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/*
0
1
2
3
4
5
6
宏任务
*/</span>
</code></pre></div><p>讲道理，按照我们对事件循环的知识体系去解答，得到的答案应该是这样的：<code>0，1，4，2，3，5，6，宏任务</code>。但是在node环境和浏览器环境运行却答案不一致。</p> <p>这道题答不对没关系，这题属于是顶级牛角尖的题目（与Promise实现有关）</p> <p>顶级解释在这里：<a href="https://www.zhihu.com/question/430549238" target="_blank" rel="noopener noreferrer">求前端大佬解析这道Promise题，为啥resolved 是在 promise2之后输出?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="node事件循环"><a href="#node事件循环" class="header-anchor">#</a> Node事件循环</h3> <h4 id="node架构分析"><a href="#node架构分析" class="header-anchor">#</a> node架构分析</h4> <p><strong>浏览器</strong>中的EventLoop是根据<strong>HTML5规范</strong>来实现的，不同的浏览器可能会有不同的实现，而<strong>Node</strong>中是由<strong>libuv</strong>实现的。</p> <ul><li>libuv中主要维护了一个EventLoop和worker threads（线程池），libuv是一个多平台的专注于异步IO的库。libuv采用的是<strong>非阻塞异步IO</strong>的调用方式</li> <li>Event Loop负责调用系统的一些其他操作：文件的IO、Network、child-process等</li></ul> <p><img src="https://img-blog.csdnimg.cn/20210517175205873.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <h4 id="阻塞io和非阻塞io"><a href="#阻塞io和非阻塞io" class="header-anchor">#</a> 阻塞IO和非阻塞IO</h4> <p>操作系统通常提供了两种调用方式：<strong>阻塞式调用</strong>和<strong>非阻塞式调用</strong></p> <ul><li>阻塞式调用：调用结果返回之前，当前线程处于阻塞态（阻塞态CPU是不会分配时间片的）调用线程只有在得到调用结果之后才会继续执行</li> <li>非阻塞式调用：调用执行之后，当前线程不会停止执行，只需要过一段时间来检查一下有没有结果返回即可（<strong>轮询操作</strong>：需要知道是否系统调用完成）</li></ul> <p>开发中的很多<strong>耗时操作</strong>都是基于<strong>非阻塞式调用</strong>：</p> <ul><li>网络请求本身使用了<strong>Socket通信</strong>，而Socket本身提供了select模型，可以进行非阻塞式的工作</li> <li>文件读写的<strong>IO操作</strong>，我们可以使用操作系统提供的基于事件的回调机制</li></ul> <p>如果主线程频繁的去进行轮询的工作，那么必然会大大降低性能，并且开发中我们不只是一个文件的读写，可能是多个文件，而且可能是多个功能的系统非阻塞式调用，如：网络IO、数据库IO、子进程调用等。所以libuv提供了一个<strong>线程池（thread pool）</strong>:</p> <ul><li>线程池会负责所有相关的操作，并且会通过轮询或者其他的方式等待结果</li> <li>当获取到结果时，就可以将对应的<strong>回调函数</strong>放到事件循环中（<strong>某一个事件队列</strong>）</li> <li>事件循环就可以负责接管后续的回调工作，告知JavaScript应用程序执行对应的回调函数</li></ul> <h4 id="阻塞和非阻塞，同步和异步的区别？"><a href="#阻塞和非阻塞，同步和异步的区别？" class="header-anchor">#</a> 阻塞和非阻塞，同步和异步的区别？</h4> <p>阻塞和非阻塞是对于被调用者来说的</p> <ul><li>这里就是系统调用，操作系统为我们提供了阻塞调用和非阻塞调用</li></ul> <p>同步和异步是对于调用者来说的</p> <ul><li>我们在程序中发起调用之后，不会进行其他任何的操作，只是等待结果，这个过程就称之为<strong>同步调用</strong></li> <li>发起调用之后，并不会等待结果，继续完成其他的工作，等到有回调时再去执行，这个过程就是<strong>异步调用</strong></li></ul> <p><img src="https://img-blog.csdnimg.cn/20210517192545749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <h4 id="node事件循环阶段"><a href="#node事件循环阶段" class="header-anchor">#</a> node事件循环阶段</h4> <p><img src="https://img-blog.csdnimg.cn/20210517203309929.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>无论是我们的文件IO、数据库、网络IO、定时器、子进程，在完成对应的操作后，都会将对应的结果和回调函数放到事件循环（任务队列）中，事件循环会不断地从任务队列中取出对应的事件（回调函数）来执行。</p> <p>Node中<strong>一次完整的事件循环Tick分成很多个阶段</strong>：（也就是我们注册调度任务（交给Node完成一些IO事件），Node处理完成之后，将结果以回调函数的形式返回给我们，这些回调函数按照事件循环的顺序来执行）</p> <ul><li>定时器（Timers）：本阶段执行已经被<code>setTimeout()</code>和<code>setInterval()</code>的调度回调函数</li> <li>待定回调（Pending Callback）：对某些系统操作（如TCP错误类型）执行回调，比如TCP连接时接收到ECONNREFUSED</li> <li>Idle、prepare：仅系统内部使用</li> <li><strong>轮询</strong>（Poll）：检索新的I/O事件；执行与I/O相关的回调；（停留时间最长，希望IO的回调尽早响应）</li> <li>检测：<code>setImmediate()</code>的回调函数在这里执行</li> <li>关闭的回调函数：一些关闭的回调函数，如：<code>socket.on('close',...)</code></li></ul> <h5 id="宏任务微任务"><a href="#宏任务微任务" class="header-anchor">#</a> 宏任务微任务</h5> <p>Node宏任务：setTimeout、setInterval、IO事件、setImmediate、close事件；</p> <p>Node微任务：Promise的then回调、queueMicrotask、process.nextTick</p> <p>注意：process.nextTick是放在单独的一个队列里面存放（不和Promise.then、queueMicrotask放在一起）</p> <h5 id="node事件循环维护的队列"><a href="#node事件循环维护的队列" class="header-anchor">#</a> Node事件循环维护的队列</h5> <p>微任务队列：next ticks队列、其他微任务队列（promise.then、queueMicrotask）</p> <p>宏任务队列：timers队列（setTimeout、setInterval）、轮询队列（io事件）、check队列（setImmediate）、close队列（close回调）</p> <h4 id="题目一：-2"><a href="#题目一：-2" class="header-anchor">#</a> 题目一：</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>

<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//会被同步执行</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//答案：</span>
<span class="token comment">/*
script start
async1 start
async2
promise1
promise2
script end
nextTick1
nextTick2
async1 end
promise3
setTimeout0
setImmediate
setTimeout2
*/</span>
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/20210517223702827.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <h4 id="题目二：-2"><a href="#题目二：-2" class="header-anchor">#</a> 题目二：</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//答案：</span>
<span class="token comment">/*
setTimeout
setImmediate
或者
setImmediate
setTimeout
*/</span>
</code></pre></div><p>原因：初始化事件循环队列需要时间，timers的回调先保存到红黑树再放到timers队列中也需要时间，setImmediate的回调不需要保存直接加入到check队列几乎不耗时。</p> <p><img src="https://img-blog.csdnimg.cn/20210518112523418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <h2 id="_12】stream"><a href="#_12】stream" class="header-anchor">#</a> 12】Stream</h2> <p>Node中很多对象是基于流实现的：</p> <ul><li>http模块的Request和Response对象</li> <li>process.stdout对象</li></ul> <p>另外：官网说所有的流都是EventEmitter的实例</p> <p>Nodejs中有四种基本流类型：</p> <ul><li>Writable：可以向其写入数据的流（<code>fs.createReadStream</code>）</li> <li>Readable：可以从中读取数据的流（<code>fs.createWriteStream</code>）</li> <li>Duplex：同时为Readable和Writable的流</li> <li>Transform：Duplex可以在写入和读取数据时修改或转换数据的流</li></ul> <h3 id="readable流的使用"><a href="#readable流的使用" class="header-anchor">#</a> Readable流的使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">//流的方式读取</span>
<span class="token keyword">const</span> reader <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./read.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  code<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
  highWaterMark<span class="token operator">:</span> <span class="token number">2</span><span class="token comment">//每次最多读两个字节</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//监听data回调获取读取的数据</span>
reader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  reader<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//暂停读取</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    reader<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//恢复读取</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//监听文件被打开</span>
reader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件被打开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//监听文件关闭</span>
reader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件被关闭'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="writable流的使用"><a href="#writable流的使用" class="header-anchor">#</a> Writable流的使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> writer <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./write.txt'</span><span class="token punctuation">)</span>

writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'你好啊'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功一次'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'雷浩'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功二次'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// writer.close()//可以使用close</span>
writer<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'End'</span><span class="token punctuation">)</span><span class="token comment">//也可以使用end（传入参数可以写入到文件中）</span>

<span class="token comment">//监听关闭</span>
writer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件已关闭'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="pipe方法的使用"><a href="#pipe方法的使用" class="header-anchor">#</a> pipe方法的使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> writer <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./write.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> reader <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./read.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  code<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
  highWaterMark<span class="token operator">:</span> <span class="token number">2</span><span class="token comment">//每次最多读两个字节</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

reader<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token comment">//将读到的值，导入输出流</span>

writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_13】http"><a href="#_13】http" class="header-anchor">#</a> 13】Http</h2> <p>web服务器：当客户端需要某一个资源时，可以向一台服务器，通过Http请求获取到这个资源；提供资源的这个服务器，就是web服务器。</p> <h3 id="创建web服务器"><a href="#创建web服务器" class="header-anchor">#</a> 创建web服务器</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建一个web服务器</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;hello server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//启动服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">~服务器已经启动在3000端口~</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>由于原生http较为复杂：url判断、method判断、参数处理、逻辑代码处理等，所以我们需要框架进行处理。</p> <h2 id="_14】express"><a href="#_14】express" class="header-anchor">#</a> 14】Express</h2> <p>Express整个框架的核心就是中间件，理解了中间件其他都很简单，其实中间件就是一个回调函数。</p> <h3 id="使用方式："><a href="#使用方式：" class="header-anchor">#</a> 使用方式：</h3> <p>方式一：通过<code>express-generator</code>脚手架创建</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#安装</span>
<span class="token function">npm</span> i -g express-generator
<span class="token comment">#创建脚手架模板</span>
express demo_name
</code></pre></div><p>方式二：从零自己搭建</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//express其实是一个函数：createApplication =&gt; 返回app对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//监听默认路径</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;hello get express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;hello post express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//开启监听</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;express服务器启动成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>express是一个路由和中间件的web框架，它本身的功能非常少，Express应用程序的本质上是一系列中间件函数的调用。</p> <p>中间件：<strong>本质上是传递给express的一个回调函数</strong>。</p> <ul><li>这个回调函数接收三个参数：
<ul><li>请求对象（request对象）</li> <li>响应对象（response对象）</li> <li>next函数（在express中定义的用于执行下一个中间件的函数）</li></ul></li> <li>如果当前中间件功能<strong>没有结束请求-响应周期</strong>，则必须调用<code>next()</code>，将控制权传递给下一个中间件功能，否则请求将被挂起。</li></ul> <p>以路由中间件为例：</p> <p><img src="https://img-blog.csdnimg.cn/20210630203945353.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <h3 id="源码分析："><a href="#源码分析：" class="header-anchor">#</a> 源码分析：</h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/1/2021, 1:43:20 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.27102bc9.js" defer></script><script src="/assets/js/2.8dfe8e5f.js" defer></script><script src="/assets/js/47.e9ddff76.js" defer></script>
  </body>
</html>
