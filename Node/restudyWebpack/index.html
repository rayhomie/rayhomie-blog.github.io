<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>重学webpack | rayhomie&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/headPic.png">
    <link rel="stylesheet" href="/css/style.css">
    <script charset="utf-8" src="/js/showNav.js"></script>
    <meta name="description" content="雷浩的前端开发之路">
    <link rel="preload" href="/assets/css/0.styles.1fbdf1a8.css" as="style"><link rel="preload" href="/assets/js/app.27102bc9.js" as="script"><link rel="preload" href="/assets/js/2.8dfe8e5f.js" as="script"><link rel="preload" href="/assets/js/48.5d4fb10f.js" as="script"><link rel="prefetch" href="/assets/js/10.a5add0c3.js"><link rel="prefetch" href="/assets/js/100.8c89d648.js"><link rel="prefetch" href="/assets/js/101.fc717ec9.js"><link rel="prefetch" href="/assets/js/102.d6e7edc0.js"><link rel="prefetch" href="/assets/js/103.8030fd4b.js"><link rel="prefetch" href="/assets/js/104.fef64d82.js"><link rel="prefetch" href="/assets/js/105.c3fca9d7.js"><link rel="prefetch" href="/assets/js/106.b504056d.js"><link rel="prefetch" href="/assets/js/107.c31048aa.js"><link rel="prefetch" href="/assets/js/108.ae5626e1.js"><link rel="prefetch" href="/assets/js/11.7c494a87.js"><link rel="prefetch" href="/assets/js/12.d1bbbdaf.js"><link rel="prefetch" href="/assets/js/13.82c9798f.js"><link rel="prefetch" href="/assets/js/14.2e6f50b9.js"><link rel="prefetch" href="/assets/js/15.b827ce0c.js"><link rel="prefetch" href="/assets/js/16.603efcc3.js"><link rel="prefetch" href="/assets/js/17.477dc29c.js"><link rel="prefetch" href="/assets/js/18.ab1b43d7.js"><link rel="prefetch" href="/assets/js/19.e0fa9ba5.js"><link rel="prefetch" href="/assets/js/20.d95066c8.js"><link rel="prefetch" href="/assets/js/21.6cd879b8.js"><link rel="prefetch" href="/assets/js/22.5324ab0e.js"><link rel="prefetch" href="/assets/js/23.9218d6d8.js"><link rel="prefetch" href="/assets/js/24.1e19c27f.js"><link rel="prefetch" href="/assets/js/25.6da3fde7.js"><link rel="prefetch" href="/assets/js/26.edd11d9d.js"><link rel="prefetch" href="/assets/js/27.eb67fea8.js"><link rel="prefetch" href="/assets/js/28.6565b2c5.js"><link rel="prefetch" href="/assets/js/29.23d65dc5.js"><link rel="prefetch" href="/assets/js/3.27135dec.js"><link rel="prefetch" href="/assets/js/30.3ad0f117.js"><link rel="prefetch" href="/assets/js/31.17792233.js"><link rel="prefetch" href="/assets/js/32.412220a3.js"><link rel="prefetch" href="/assets/js/33.dcee5d03.js"><link rel="prefetch" href="/assets/js/34.8aac186c.js"><link rel="prefetch" href="/assets/js/35.479f1f88.js"><link rel="prefetch" href="/assets/js/36.538c8db2.js"><link rel="prefetch" href="/assets/js/37.ca793177.js"><link rel="prefetch" href="/assets/js/38.a0bde2fd.js"><link rel="prefetch" href="/assets/js/39.5475ac02.js"><link rel="prefetch" href="/assets/js/4.74cf67b4.js"><link rel="prefetch" href="/assets/js/40.eeab06c6.js"><link rel="prefetch" href="/assets/js/41.33dc67c6.js"><link rel="prefetch" href="/assets/js/42.acb457e3.js"><link rel="prefetch" href="/assets/js/43.6fc9fe3f.js"><link rel="prefetch" href="/assets/js/44.eec80764.js"><link rel="prefetch" href="/assets/js/45.f180ce8d.js"><link rel="prefetch" href="/assets/js/46.c2a4d416.js"><link rel="prefetch" href="/assets/js/47.e9ddff76.js"><link rel="prefetch" href="/assets/js/49.fa19c197.js"><link rel="prefetch" href="/assets/js/5.fff2dba8.js"><link rel="prefetch" href="/assets/js/50.1995f55f.js"><link rel="prefetch" href="/assets/js/51.ad9507a6.js"><link rel="prefetch" href="/assets/js/52.a0c7b4b4.js"><link rel="prefetch" href="/assets/js/53.e6270868.js"><link rel="prefetch" href="/assets/js/54.8b2ab146.js"><link rel="prefetch" href="/assets/js/55.d4b94501.js"><link rel="prefetch" href="/assets/js/56.8799f75c.js"><link rel="prefetch" href="/assets/js/57.70252bd5.js"><link rel="prefetch" href="/assets/js/58.b55c98a5.js"><link rel="prefetch" href="/assets/js/59.a40bf0aa.js"><link rel="prefetch" href="/assets/js/6.7a238015.js"><link rel="prefetch" href="/assets/js/60.b32822f8.js"><link rel="prefetch" href="/assets/js/61.96e132e4.js"><link rel="prefetch" href="/assets/js/62.5b156fb7.js"><link rel="prefetch" href="/assets/js/63.252fdde0.js"><link rel="prefetch" href="/assets/js/64.870eb635.js"><link rel="prefetch" href="/assets/js/65.00cf779d.js"><link rel="prefetch" href="/assets/js/66.edfb8eec.js"><link rel="prefetch" href="/assets/js/67.21c62f6c.js"><link rel="prefetch" href="/assets/js/68.e8153158.js"><link rel="prefetch" href="/assets/js/69.c886c8dc.js"><link rel="prefetch" href="/assets/js/7.4ccf6b5f.js"><link rel="prefetch" href="/assets/js/70.103bfe88.js"><link rel="prefetch" href="/assets/js/71.1da9ddc7.js"><link rel="prefetch" href="/assets/js/72.5259cf72.js"><link rel="prefetch" href="/assets/js/73.2e99bbf9.js"><link rel="prefetch" href="/assets/js/74.15325ce0.js"><link rel="prefetch" href="/assets/js/75.feb3fe93.js"><link rel="prefetch" href="/assets/js/76.c6ffd0de.js"><link rel="prefetch" href="/assets/js/77.1f15986e.js"><link rel="prefetch" href="/assets/js/78.26e8059a.js"><link rel="prefetch" href="/assets/js/79.5aecad9a.js"><link rel="prefetch" href="/assets/js/8.086b5469.js"><link rel="prefetch" href="/assets/js/80.0d468094.js"><link rel="prefetch" href="/assets/js/81.869965a4.js"><link rel="prefetch" href="/assets/js/82.5161670c.js"><link rel="prefetch" href="/assets/js/83.24394a20.js"><link rel="prefetch" href="/assets/js/84.4abbb214.js"><link rel="prefetch" href="/assets/js/85.c5442ded.js"><link rel="prefetch" href="/assets/js/86.787b4128.js"><link rel="prefetch" href="/assets/js/87.32e54ac7.js"><link rel="prefetch" href="/assets/js/88.5da20419.js"><link rel="prefetch" href="/assets/js/89.eccb9167.js"><link rel="prefetch" href="/assets/js/9.01377c1a.js"><link rel="prefetch" href="/assets/js/90.538ac538.js"><link rel="prefetch" href="/assets/js/91.ffb107cd.js"><link rel="prefetch" href="/assets/js/92.c683e420.js"><link rel="prefetch" href="/assets/js/93.e4e30951.js"><link rel="prefetch" href="/assets/js/94.6df7640a.js"><link rel="prefetch" href="/assets/js/95.9ea7d0a8.js"><link rel="prefetch" href="/assets/js/96.1659aa5a.js"><link rel="prefetch" href="/assets/js/97.3b3b507b.js"><link rel="prefetch" href="/assets/js/98.12e89dfd.js"><link rel="prefetch" href="/assets/js/99.a2de8da9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1fbdf1a8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">rayhomie's blog</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架学习" class="dropdown-title"><span class="title">框架学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VUE/vueBase/" class="nav-link">
  vue基础
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vueComponent/" class="nav-link">
  vue组件化编码
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue_webpack_modules/" class="nav-link">
  webpacke模块化开发
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue-cli/" class="nav-link">
  vue-cli脚手架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue-router/" class="nav-link">
  vue-router路由
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vuex-learn/" class="nav-link">
  vuex状态管理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/VueMixin/" class="nav-link">
  Mixins混入
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vueBoost/" class="nav-link">
  vue性能优化
</a></li><li class="dropdown-item"><!----> <a href="/VUE/axios/" class="nav-link">
  Axios框架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/ajax/" class="nav-link">
  Ajax
</a></li><li class="dropdown-item"><!----> <a href="/VUE/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/VUE/mock/" class="nav-link">
  mock
</a></li><li class="dropdown-item"><!----> <a href="/VUE/wxprogram/" class="nav-link">
  小程序入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/uniapp/" class="nav-link">
  uni-app入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Reactbase/" class="nav-link">
  React基础入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/ReactCli/" class="nav-link">
  React脚手架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Redux/" class="nav-link">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/VUE/react-redux/" class="nav-link">
  react-redux的实现原理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Hooks/" class="nav-link">
  React Hooks
</a></li><li class="dropdown-item"><!----> <a href="/VUE/reactRender/" class="nav-link">
  react渲染和更新机制
</a></li><li class="dropdown-item"><!----> <a href="/VUE/setState/" class="nav-link">
  setState进阶
</a></li><li class="dropdown-item"><!----> <a href="/VUE/nextTick/" class="nav-link">
  Vue.nextTick进阶
</a></li><li class="dropdown-item"><!----> <a href="/VUE/reactHighCom/" class="nav-link">
  react高阶组件
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Reactevent/" class="nav-link">
  react合成事件分析
</a></li><li class="dropdown-item"><!----> <a href="/VUE/frontLogin/" class="nav-link">
  前端登录
</a></li><li class="dropdown-item"><!----> <a href="/VUE/CORS&amp;proxy/" class="nav-link">
  CORS跨域和反向代理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/XHR&amp;AJAX/" class="nav-link">
  XHR对象和AJAX
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Node/Nodejs/" class="nav-link">
  Nodejs服务端
</a></li><li class="dropdown-item"><!----> <a href="/Node/restudyNode/" class="nav-link">
  重学Node
</a></li><li class="dropdown-item"><!----> <a href="/Node/restudyWebpack/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  重学Webpack
</a></li><li class="dropdown-item"><!----> <a href="/Node/promisify/" class="nav-link">
  手写util.promisify
</a></li><li class="dropdown-item"><!----> <a href="/Node/Blob/" class="nav-link">
  Blob数据
</a></li><li class="dropdown-item"><!----> <a href="/Node/nodejsStreamCopy/" class="nav-link">
  nodejs管道流复制文件
</a></li><li class="dropdown-item"><!----> <a href="/Node/Docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/Node/gitlabci/" class="nav-link">
  gitlab-ci
</a></li><li class="dropdown-item"><!----> <a href="/Node/Express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/Node/Koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-item"><!----> <a href="/Node/koaDeploy/" class="nav-link">
  koa部署服务器
</a></li><li class="dropdown-item"><!----> <a href="/Node/MongoDB/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/Node/Mongoose/" class="nav-link">
  Mongoose
</a></li><li class="dropdown-item"><!----> <a href="/Node/zx/" class="nav-link">
  zx库
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript学习" class="dropdown-title"><span class="title">JavaScript学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/note/" class="nav-link">
  js笔记
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/GOGOFACE/" class="nav-link">
  校招面试冲刺
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/manager/" class="nav-link">
  js知识整理
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Promise/" class="nav-link">
  Promise
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/AOP/" class="nav-link">
  AOP切面编程(闭包)
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Generator&amp;yield/" class="nav-link">
  Generator生成器&amp;Iterator迭代器
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/asyncReturn/" class="nav-link">
  async中return和return await的区别
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsFaceObject/" class="nav-link">
  js面向对象基础--创建对象
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsPtototypeChain/" class="nav-link">
  js面向对象基础--原型链
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsBaseExtends/" class="nav-link">
  js面向对象基础--继承
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsPrototypeExtends/" class="nav-link">
  js原型继承
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptCodeClean/" class="nav-link">
  JavaScript代码整洁之道
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptEventLoop/" class="nav-link">
  JavaScript事件循环各种概念剖析
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptThisPoint/" class="nav-link">
  JavaScript简单理解this指向
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/es6this/" class="nav-link">
  谈谈ES6箭头函数this指向问题
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/environment/" class="nav-link">
  词法环境[[environment]]--闭包
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/zuoyongyu/" class="nav-link">
  js函数作用域与闭包相关问题
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/varHosting/" class="nav-link">
  js中的变量提升和函数提升
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/VO&amp;AO/" class="nav-link">
  JS中的变量对象VO和活动对象AO
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JScenter/" class="nav-link">
  JS核心机制（数据类型、垃圾回收机制）
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/handCallApplyBind/" class="nav-link">
  手写call、apply、bind
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataStructure/note/" class="nav-link">
  笔记整理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS特效" class="dropdown-title"><span class="title">CSS特效</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CSSEffect/moreColumLayout/" class="nav-link">
  CSS多列布局的实现
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/writeWords/" class="nav-link">
  打字机效果以及animation中的steps()函数
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/box-shadow/" class="nav-link">
  CSS的box-shadow创建边框
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/CSSPointshow/" class="nav-link">
  纯CSS实现的滚动指示器效果
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/img-lazyload/" class="nav-link">
  图片模糊加载
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/tuozhuai/" class="nav-link">
  实现一个拖拽
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/positionSticky/" class="nav-link">
  实现position:sticky
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/lazyLoad/" class="nav-link">
  实现下拉加载更多，懒加载
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随便聊聊" class="dropdown-title"><span class="title">随便聊聊</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/talktalk/onePic/" class="nav-link">
  一张图总结系列
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/argument/" class="nav-link">
  js的argument
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/bibao/" class="nav-link">
  闭包个人理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/eventloop/" class="nav-link">
  Event Loop理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/chuandicanshu/" class="nav-link">
  js参数传递理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/var/" class="nav-link">
  聊聊js变量存储的本质和const修改对象问题
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/es6open/" class="nav-link">
  ES6扩展运算符的使用
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/dataInVue/" class="nav-link">
  为什么.vue文件中data必须用函数表达
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/jsMaopao/" class="nav-link">
  浅谈js事件捕获和事件冒泡
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFaceTest/" class="nav-link">
  CSS 面试知识点总结
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFirst/" class="nav-link">
  CSS 属性继承和优先级算法(权重)
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSSelector/" class="nav-link">
  了解 CSS 选择器
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSCenter/" class="nav-link">
  总结一下 CSS 居中的各种方法
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFloat/" class="nav-link">
  说说CSS浮动以及清除浮动
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSMargin/" class="nav-link">
  外边距塌陷问题
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSBFC/" class="nav-link">
  浅谈BFC
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HTTP/" class="nav-link">
  HTTP协议
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HTTPS/" class="nav-link">
  聊聊HTTPS工作原理
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/thread/" class="nav-link">
  进程与线程tcp/ip三次握手
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HtmlHead/" class="nav-link">
  你知道HTML中Head标签具体怎么用吗？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/JSONStringify/" class="nav-link">
  JSON.stringify()还可以这么玩
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/ObjectAssign/" class="nav-link">
  Object.assign()的使用指南
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/debounce/" class="nav-link">
  简单防抖函数中闭包的问题理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/throttle/" class="nav-link">
  简单节流函数中闭包的问题理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/doubleBinding/" class="nav-link">
  多种实现双向绑定方法
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/ReactClassComponent/" class="nav-link">
  React类组件的一些问题浅析
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/brower/" class="nav-link">
  浏览器运行原理
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/commonJS&amp;ESmodules/" class="nav-link">
  commonJS和ESmodules差异
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/DOMDIFF/" class="nav-link">
  vue中:key=index为什么不建议使用？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/constUseState/" class="nav-link">
  为什么useState可以使用const解构赋值？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/pipeCopy/" class="nav-link">
  使用管道流复制大文件
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架学习" class="dropdown-title"><span class="title">框架学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VUE/vueBase/" class="nav-link">
  vue基础
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vueComponent/" class="nav-link">
  vue组件化编码
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue_webpack_modules/" class="nav-link">
  webpacke模块化开发
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue-cli/" class="nav-link">
  vue-cli脚手架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vue-router/" class="nav-link">
  vue-router路由
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vuex-learn/" class="nav-link">
  vuex状态管理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/VueMixin/" class="nav-link">
  Mixins混入
</a></li><li class="dropdown-item"><!----> <a href="/VUE/vueBoost/" class="nav-link">
  vue性能优化
</a></li><li class="dropdown-item"><!----> <a href="/VUE/axios/" class="nav-link">
  Axios框架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/ajax/" class="nav-link">
  Ajax
</a></li><li class="dropdown-item"><!----> <a href="/VUE/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/VUE/mock/" class="nav-link">
  mock
</a></li><li class="dropdown-item"><!----> <a href="/VUE/wxprogram/" class="nav-link">
  小程序入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/uniapp/" class="nav-link">
  uni-app入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Reactbase/" class="nav-link">
  React基础入门
</a></li><li class="dropdown-item"><!----> <a href="/VUE/ReactCli/" class="nav-link">
  React脚手架
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Redux/" class="nav-link">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/VUE/react-redux/" class="nav-link">
  react-redux的实现原理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Hooks/" class="nav-link">
  React Hooks
</a></li><li class="dropdown-item"><!----> <a href="/VUE/reactRender/" class="nav-link">
  react渲染和更新机制
</a></li><li class="dropdown-item"><!----> <a href="/VUE/setState/" class="nav-link">
  setState进阶
</a></li><li class="dropdown-item"><!----> <a href="/VUE/nextTick/" class="nav-link">
  Vue.nextTick进阶
</a></li><li class="dropdown-item"><!----> <a href="/VUE/reactHighCom/" class="nav-link">
  react高阶组件
</a></li><li class="dropdown-item"><!----> <a href="/VUE/Reactevent/" class="nav-link">
  react合成事件分析
</a></li><li class="dropdown-item"><!----> <a href="/VUE/frontLogin/" class="nav-link">
  前端登录
</a></li><li class="dropdown-item"><!----> <a href="/VUE/CORS&amp;proxy/" class="nav-link">
  CORS跨域和反向代理
</a></li><li class="dropdown-item"><!----> <a href="/VUE/XHR&amp;AJAX/" class="nav-link">
  XHR对象和AJAX
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Node/Nodejs/" class="nav-link">
  Nodejs服务端
</a></li><li class="dropdown-item"><!----> <a href="/Node/restudyNode/" class="nav-link">
  重学Node
</a></li><li class="dropdown-item"><!----> <a href="/Node/restudyWebpack/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  重学Webpack
</a></li><li class="dropdown-item"><!----> <a href="/Node/promisify/" class="nav-link">
  手写util.promisify
</a></li><li class="dropdown-item"><!----> <a href="/Node/Blob/" class="nav-link">
  Blob数据
</a></li><li class="dropdown-item"><!----> <a href="/Node/nodejsStreamCopy/" class="nav-link">
  nodejs管道流复制文件
</a></li><li class="dropdown-item"><!----> <a href="/Node/Docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/Node/gitlabci/" class="nav-link">
  gitlab-ci
</a></li><li class="dropdown-item"><!----> <a href="/Node/Express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/Node/Koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-item"><!----> <a href="/Node/koaDeploy/" class="nav-link">
  koa部署服务器
</a></li><li class="dropdown-item"><!----> <a href="/Node/MongoDB/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/Node/Mongoose/" class="nav-link">
  Mongoose
</a></li><li class="dropdown-item"><!----> <a href="/Node/zx/" class="nav-link">
  zx库
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript学习" class="dropdown-title"><span class="title">JavaScript学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/note/" class="nav-link">
  js笔记
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/GOGOFACE/" class="nav-link">
  校招面试冲刺
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/manager/" class="nav-link">
  js知识整理
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Promise/" class="nav-link">
  Promise
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/AOP/" class="nav-link">
  AOP切面编程(闭包)
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/Generator&amp;yield/" class="nav-link">
  Generator生成器&amp;Iterator迭代器
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/asyncReturn/" class="nav-link">
  async中return和return await的区别
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsFaceObject/" class="nav-link">
  js面向对象基础--创建对象
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsPtototypeChain/" class="nav-link">
  js面向对象基础--原型链
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsBaseExtends/" class="nav-link">
  js面向对象基础--继承
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/jsPrototypeExtends/" class="nav-link">
  js原型继承
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptCodeClean/" class="nav-link">
  JavaScript代码整洁之道
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptEventLoop/" class="nav-link">
  JavaScript事件循环各种概念剖析
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScriptThisPoint/" class="nav-link">
  JavaScript简单理解this指向
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/es6this/" class="nav-link">
  谈谈ES6箭头函数this指向问题
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/environment/" class="nav-link">
  词法环境[[environment]]--闭包
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/zuoyongyu/" class="nav-link">
  js函数作用域与闭包相关问题
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/varHosting/" class="nav-link">
  js中的变量提升和函数提升
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/VO&amp;AO/" class="nav-link">
  JS中的变量对象VO和活动对象AO
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/JScenter/" class="nav-link">
  JS核心机制（数据类型、垃圾回收机制）
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/handCallApplyBind/" class="nav-link">
  手写call、apply、bind
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/DataStructure/note/" class="nav-link">
  笔记整理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS特效" class="dropdown-title"><span class="title">CSS特效</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CSSEffect/moreColumLayout/" class="nav-link">
  CSS多列布局的实现
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/writeWords/" class="nav-link">
  打字机效果以及animation中的steps()函数
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/box-shadow/" class="nav-link">
  CSS的box-shadow创建边框
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/CSSPointshow/" class="nav-link">
  纯CSS实现的滚动指示器效果
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/img-lazyload/" class="nav-link">
  图片模糊加载
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/tuozhuai/" class="nav-link">
  实现一个拖拽
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/positionSticky/" class="nav-link">
  实现position:sticky
</a></li><li class="dropdown-item"><!----> <a href="/CSSEffect/lazyLoad/" class="nav-link">
  实现下拉加载更多，懒加载
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随便聊聊" class="dropdown-title"><span class="title">随便聊聊</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/talktalk/onePic/" class="nav-link">
  一张图总结系列
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/argument/" class="nav-link">
  js的argument
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/bibao/" class="nav-link">
  闭包个人理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/eventloop/" class="nav-link">
  Event Loop理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/chuandicanshu/" class="nav-link">
  js参数传递理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/var/" class="nav-link">
  聊聊js变量存储的本质和const修改对象问题
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/es6open/" class="nav-link">
  ES6扩展运算符的使用
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/dataInVue/" class="nav-link">
  为什么.vue文件中data必须用函数表达
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/jsMaopao/" class="nav-link">
  浅谈js事件捕获和事件冒泡
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFaceTest/" class="nav-link">
  CSS 面试知识点总结
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFirst/" class="nav-link">
  CSS 属性继承和优先级算法(权重)
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSSelector/" class="nav-link">
  了解 CSS 选择器
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSCenter/" class="nav-link">
  总结一下 CSS 居中的各种方法
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSFloat/" class="nav-link">
  说说CSS浮动以及清除浮动
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSMargin/" class="nav-link">
  外边距塌陷问题
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/CSSBFC/" class="nav-link">
  浅谈BFC
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HTTP/" class="nav-link">
  HTTP协议
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HTTPS/" class="nav-link">
  聊聊HTTPS工作原理
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/thread/" class="nav-link">
  进程与线程tcp/ip三次握手
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/HtmlHead/" class="nav-link">
  你知道HTML中Head标签具体怎么用吗？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/JSONStringify/" class="nav-link">
  JSON.stringify()还可以这么玩
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/ObjectAssign/" class="nav-link">
  Object.assign()的使用指南
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/debounce/" class="nav-link">
  简单防抖函数中闭包的问题理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/throttle/" class="nav-link">
  简单节流函数中闭包的问题理解
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/doubleBinding/" class="nav-link">
  多种实现双向绑定方法
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/ReactClassComponent/" class="nav-link">
  React类组件的一些问题浅析
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/brower/" class="nav-link">
  浏览器运行原理
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/commonJS&amp;ESmodules/" class="nav-link">
  commonJS和ESmodules差异
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/DOMDIFF/" class="nav-link">
  vue中:key=index为什么不建议使用？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/constUseState/" class="nav-link">
  为什么useState可以使用const解构赋值？
</a></li><li class="dropdown-item"><!----> <a href="/talktalk/pipeCopy/" class="nav-link">
  使用管道流复制大文件
</a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="重学webpack"><a href="#重学webpack" class="header-anchor">#</a> 重学webpack</h1> <h2 id="_1】入口出口配置"><a href="#_1】入口出口配置" class="header-anchor">#</a> 1】入口出口配置</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

<span class="token comment">//生成一个html模板</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">//启动时清空dist文件夹</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">//单独打包css，不使用style标签，自动使用Link标签</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span><span class="token comment">//基础配置</span>
    <span class="token comment">// theory_analysis: './src/theory_analysis.js'//打包优化，dll</span>
    <span class="token comment">// lazyLoad: './src/lazyLoad.js'//路由懒加载、按需加载</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span><span class="token string">'eval-source-map'</span><span class="token punctuation">,</span><span class="token comment">//开启SourceMap代码映射//默认是eval</span>
  <span class="token comment">//配置告诉devServer，打包好的文件该到dist文件夹下去取</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span> 
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span><span class="token comment">//在webpack4+该字段也可以用static</span>
    hot<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//启动热模块更新webpack-dev-server3默认不启动，4+默认启动</span>
    proxy<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//配置反向代理</span>
      <span class="token string">'/api'</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//只要是遇到域名后面是/api开头的请求都转发到target去</span>
        target<span class="token operator">:</span><span class="token string">'http://www.weshineapp.com/'</span><span class="token punctuation">,</span>  
        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//将/api开头的，'/api'改成'api'</span>
          <span class="token string">'^/api'</span><span class="token operator">:</span> <span class="token string">'/api'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        changeOrigin<span class="token operator">:</span><span class="token boolean">true</span><span class="token comment">//跨域请求</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//publicPath: 'http://cdn.xxx.com',</span>
    <span class="token comment">//添加src时，的根路径比如现在就是src='http://cdn.xxx.com/[name].bundle.js'</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_[hash].bundle.js'</span><span class="token punctuation">,</span>
    <span class="token comment">/*[name]对应的是entry中的名字;这里的'[name]'的规则命名称为占位符。
      也可以使用[ext]、[hash]；来使用占位符。这里的hash是根据文件内容来生成hash值（可以用于网络资源请求的缓存）*/</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token comment">//打包到的文件夹</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.tsx'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//不需要写后缀名，按顺序去找文件</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//别名</span>
      <span class="token string">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">]</span>
    <span class="token comment">//告诉 webpack 解析模块时应该搜索的目录，即 require 或 import 模块的时候，只写模块名的时候，到哪里去找，其属性值为数组，因为可配置多个模块搜索路径，其搜索路径必须为绝对路径，</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token comment">//使用插件</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//引用动态链接库的插件(告诉webpack我们用了哪些动态链接库，该怎么使用这些dll)</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//要使用Dll的话还需要单独打包动态链接库</span>
      <span class="token comment">//需要找到生成的dll动态链接库的manifest映射文件</span>
      manifest<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll'</span><span class="token punctuation">,</span> <span class="token string">'react.manifest.json'</span><span class="token punctuation">)</span>
      <span class="token comment">//manifest: require('./dll/react.manifest.json'),//这样也可以</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>  
  resolveLoader<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//配置loader存在的文件夹，默认只有node_modules（自定义loader）</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'custom-loader'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//使用loader</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">/*配置项在这里*/</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// {</span>
      <span class="token comment">//   test: /\.(jpg|jpeg|png|gif)$/,</span>
      <span class="token comment">//   exclude: /node_modules/,</span>
      <span class="token comment">//   use: {</span>
      <span class="token comment">//     loader: 'file-loader',</span>
      <span class="token comment">//     options: { // 配置项在这里</span>
      <span class="token comment">//       name: '[name]_[hash].[ext]',//使用原先的文件名和后缀名</span>
      <span class="token comment">//       outputPath: 'images/'//（匹配到的静态图片放到dist目录的imges下）</span>
      <span class="token comment">//     }</span>
      <span class="token comment">//   },</span>
      <span class="token comment">// },</span>
   <span class="token comment">/*url-loader和file-loader两者不能同时使用：
    - url-loader内置了file-loader（可以直接安装url-loader使用）
    - 可以设置file-loader的所有配置选项
    - 使用limit属性来限制超过多大的图片，就不使用base64来打包图片
    - 所有推荐使用url-loader（也可以处理css中的background-image:url()图片）*/</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(jpg|jpeg|png)$/</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//使用url-loader，自动把图片转成base64的文件格式</span>
          loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            limit<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'[name]_[hash].[ext]'</span><span class="token punctuation">,</span><span class="token comment">//使用原先的文件名和后缀名</span>
            outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token comment">//（匹配到的静态图片放到dist目录的imges下）</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        <span class="token comment">//use的数组里面是从后往前加载，我们需要先解析css代码以及文件之间的依赖关系，再将style标签插入head中</span>
        <span class="token comment">//写法一：use: ['style-loader', 'css-loader']</span>
        <span class="token comment">//写法二：从后往前的顺序进行读取：</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">//  { loader: &quot;style-loader&quot; },</span>
          MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span><span class="token comment">//单独打包css，不使用style标签，自动使用Link标签</span>
          <span class="token punctuation">{</span> loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
           options<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//开启cssmodule</span>
             modules<span class="token operator">:</span> <span class="token punctuation">{</span> localIdentName<span class="token operator">:</span> <span class="token string">'[name][hash:base64:6]'</span> <span class="token punctuation">}</span>
           <span class="token punctuation">}</span> 
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> loader<span class="token operator">:</span> <span class="token string">&quot;postcss-loader&quot;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span><span class="token comment">//前提是安装sass预处理器</span>
        test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        <span class="token comment">//从后往前的顺序进行读取：</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">//'style-loader',</span>
          MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span><span class="token comment">//单独打包css，不使用style标签，自动使用Link标签</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">,</span><span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span><span class="token comment">//前提是安装less预处理器</span>
        test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        <span class="token comment">//从后往前的顺序进行读取：</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">//'style-loader',</span>
          MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span><span class="token comment">//单独打包css，不使用style标签，自动使用Link标签</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span><span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">/*需要注意的是：postcss的目的是让css3的属性通过脚本的方式生成厂商前缀的工具，
      使用方式类似于babel，也需要安装相应想要使用的插件，
      在`postcss.config.js`中进行配置，在`packege.json`中有browerslist字段设置。*/</span>
      <span class="token punctuation">{</span><span class="token comment">//解析加载iconfont需要的文件并打包</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(eot|woff|ttf|svg)/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/font'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">//只处理src下的font文件夹</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span> outputPath<span class="token operator">:</span> <span class="token string">'font/'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//打包到dist下的font文件夹</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2】loader"><a href="#_2】loader" class="header-anchor">#</a> 2】loader</h2> <p>loader的执行顺序是<strong>从下到上，从右到左</strong>。</p> <h3 id="babel-loader"><a href="#babel-loader" class="header-anchor">#</a> babel-loader</h3> <h5 id="怎么在webpack中使用babel呢"><a href="#怎么在webpack中使用babel呢" class="header-anchor">#</a> 怎么在webpack中使用babel呢?</h5> <p>①首先安装babel-loader</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i babel-loader --save-dev
</code></pre></div><p>②webpack配置文件中配置loader（module的配置项中）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//写法一：</span>
module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span><span class="token comment">//这样也可以：loader:'babel-loader'</span>
    exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">//写法二：（如果需要配置loader）</span>
module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 配置项在这里</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>③将babel插件的名字增加到配置文件中 (根目录下创建 .babelrc、.babelrc.js 、babel.config.js或者 package.json 的 <code>babel</code> 里面来进行配置)</p> <p>这里使用的是.babelrc的形式：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>④再安装我们我们需要使用的babel插件和预设</p> <p>这里使用的预设是env预设：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i @babel/preset-env --save-dev
</code></pre></div><h5 id="使用babel-polyfill（垫片）补充es6代码的实现"><a href="#使用babel-polyfill（垫片）补充es6代码的实现" class="header-anchor">#</a> 使用babel-polyfill（垫片）补充ES6代码的实现</h5> <p>低版本的浏览器没有新版本的API，如：promise、Array.from、Map等。所以我们需要使用babel-polyfill来在代码中补充这些缺少的api的实现。</p> <p>①安装<code>npm i --save @babel/polyfill</code>，它不是开发时依赖，是生产环境也需要的依赖。</p> <p>②在项目入口文件中导入垫片</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//index.js</span>
<span class="token keyword">import</span> <span class="token string">'@babel/polyfill'</span>

<span class="token keyword">const</span> promiseArray <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

promiseArray<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token operator">=&gt;</span>promise<span class="token punctuation">)</span>
</code></pre></div><p>③在presets的设置中进行配置（告诉babel我们只需要使用到的ES6+的api的实现，减少没必要的多余代码）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//.babelrc</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>


<span class="token comment">//webpack.config.js</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">/*配置项在这里*/</span>
            presets<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">[</span>
                <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token comment">//垫片polyfill（告诉babel我们只需要使用到的ES6+的api的实现，减少没必要的多余代码）</span>
                  useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="file-loader"><a href="#file-loader" class="header-anchor">#</a> file-loader</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//使用loader</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(jpg|jpeg|png|gif)$/</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 配置项在这里：（一般的打包name规则都支持占位符[]）</span>
            name<span class="token operator">:</span> <span class="token string">'[name]_[hash].[ext]'</span><span class="token punctuation">,</span><span class="token comment">//使用原先的文件名和后缀名</span>
            outputPath<span class="token operator">:</span> <span class="token string">'images/'</span>
            <span class="token comment">//（匹配到的静态图片放到dist目录的imges下）</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="url-loader"><a href="#url-loader" class="header-anchor">#</a> url-loader</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//使用loader</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(jpg|jpeg|png)$/</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//使用url-loader，自动把图片转成base64的文件格式</span>
          loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><strong>url-loader</strong>和<strong>file-loader</strong>两者<strong>不能同时使用</strong>：</p> <ul><li>url-loader内置了file-loader（可以直接安装url-loader使用）</li> <li>可以设置file-loader的所有配置选项</li> <li>使用limit属性来限制超过多大的图片，就不使用base64来打包图片</li> <li>所有<strong>推荐使用url-loader</strong>（也可以处理css中的<code>background-image:url()</code>图片）</li></ul> <h3 id="css-loader、style-loader"><a href="#css-loader、style-loader" class="header-anchor">#</a> css-loader、style-loader</h3> <p>注意：use的数组里面是<strong>从后往前加载</strong>，我们需要先解析css、再将style标签插入到模板中（使用js插入运行时），所以写法必须是<code>use:['style-loader','css-loader']</code></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//使用loader</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
      <span class="token comment">//use的数组里面是从后往前加载，我们需要先解析css代码以及文件之间的依赖关系，再将style标签插入head中</span>
      <span class="token comment">//写法一：use: ['style-loader', 'css-loader']</span>
      <span class="token comment">//写法二：从后往前的顺序进行读取：</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span> 
</code></pre></div><h3 id="sass-loader、less-loader、postcss-loader"><a href="#sass-loader、less-loader、postcss-loader" class="header-anchor">#</a> sass-loader、less-loader、postcss-loader</h3> <p>前提需要安装sass或者less才能使用哦！</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#sass预处理器写样式，使用sass-loader处理.scss文件解析</span>
<span class="token function">npm</span> i -D sass sass-loader 
<span class="token comment">#less预处理器写样式，使用less-loader处理.less文件</span>
<span class="token function">npm</span> i -D <span class="token function">less</span> less-loader 
<span class="token comment">#安装</span>
<span class="token function">npm</span> i -D postcss postcss-loader
</code></pre></div><p><a href="https://www.postcss.com.cn/" target="_blank" rel="noopener noreferrer">postcss<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的目的是让css3的属性通过脚本的方式生成厂商前缀的工具，使用方式类似于babel，也需要安装相应想要使用的插件，在<code>postcss.config.js</code>中进行配置，在<code>packege.json</code>中有browerslist字段设置。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">//package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  ...
  <span class="token property">&quot;browerslist&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span><span class="token comment">//兼容市场份额大于1%的浏览器</span>
    <span class="token string">&quot;last 2 versions&quot;</span><span class="token comment">//并且这些浏览器上两个版本都要去兼容</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
  
<span class="token comment">//postcss.config.js</span>
module.exports = <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  	require('autoprefixer')
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>webpack配置：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//使用loader</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token comment">//前提是安装sass预处理器</span>
      test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
      <span class="token comment">//从后往前的顺序进行读取：</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token comment">//前提是安装less预处理器</span>
      test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
      <span class="token comment">//从后往前的顺序进行读取：</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span> 
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span> 
</code></pre></div><h3 id="cssmodule启用"><a href="#cssmodule启用" class="header-anchor">#</a> cssModule启用</h3> <p>需要注意的是<strong>如果启用了cssmodule的话就不能使用普通的方式进行导入css</strong>，因为css文件打包后类名变成了hash值，不能用我们自己定义的类名去找样式。</p> <p>如果不启用cssmodule的话，<code>import './index.css'</code>是全局的引入，在全局都生效。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//使用loader</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span><span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
        	options<span class="token operator">:</span><span class="token punctuation">{</span>
            modules<span class="token operator">:</span><span class="token boolean">true</span><span class="token comment">//css-module打开。</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//此时我们的配置是遇到.css文件就回去开启,而引入的npm包的样式还没有处理。所以还需要一个配置：单独处理node_module内的css文件</span>

    <span class="token punctuation">{</span> 
      test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">,</span><span class="token string">'postcss-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    include<span class="token operator">:</span><span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后再每个模块中就可以使用cssmodule的语法了：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//index.css</span>
<span class="token punctuation">.</span>avatar<span class="token punctuation">{</span>
  width<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">;</span>
  height<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//index.js</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> '<span class="token punctuation">.</span><span class="token operator">/</span>index<span class="token punctuation">.</span>css
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token comment">//{avatar: &quot;_1ofLYuuFNEe_WYUYkaG3VO&quot;}</span>
<span class="token comment">//import './index.css'//启用之后就不能这样导入，因为css文件打包后类名变成了hash值，不能用.avatar找到相应类名。</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> avatar
image<span class="token punctuation">.</span>className <span class="token operator">+=</span> styles<span class="token punctuation">.</span>avatar<span class="token comment">//只能由这种方式去使用类名</span>
App<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
</code></pre></div><h4 id="支持css-module模式和普通模式混用"><a href="#支持css-module模式和普通模式混用" class="header-anchor">#</a> <a href="https://www.cnblogs.com/walls/p/9153555.html" target="_blank" rel="noopener noreferrer">支持<code>css module</code>模式和普通模式混用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>1.用文件名区分两种模式</p> <ul><li><code>*.global.css</code> 普通模式</li> <li><code>*.css</code> css module模式</li></ul> <p>这里统一用 <code>global</code> 关键词进行识别。</p> <p>2.用正则表达式匹配文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// css module</span>
<span class="token punctuation">{</span> 
    test<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^(?!.*\\.global).*\\.css</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'style-loader'</span>
        <span class="token punctuation">}</span>，
        <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
                modules<span class="token operator">:</span> <span class="token punctuation">{</span>  localIdentName<span class="token operator">:</span> <span class="token string">'[hash:base64:6]'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'postcss-loader'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span><span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 普通模式</span>
<span class="token punctuation">{</span> 
    test<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^(.*\\.global).*\\.css</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'style-loader'</span>
        <span class="token punctuation">}</span>，
        <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'postcss-loader'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span><span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="file-loader打包字体图标"><a href="#file-loader打包字体图标" class="header-anchor">#</a> file-loader打包字体图标</h3> <p>①首先我们到iconfont去下载我们需要的字体和图标源文件。在把他们保存到前端项目的静态资源文件夹font中。</p> <p>其中有个css文件如下：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/*iconfont配置*/</span>
<span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">&quot;iconfont&quot;</span><span class="token punctuation">;</span>
  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>&quot;./font/iconfont.eot?t=1619246879033&quot;<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token comment">/* IE9 */</span>
  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>&quot;./font/iconfont.eot?t=1619246879033#iefix&quot;<span class="token punctuation">)</span></span>
      <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;embedded-opentype&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/* IE6-IE8 */</span>
      <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>&quot;data:application/x-font-woff2;charset=utf-8;base64,d09GMgABAAAAAAOUAAsAAAAAB/gAAANGAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHEIGVgCCcAqEAIMRATYCJAMICwYABCAFhG0HMRu4BhEVnBXIfhbGzosiSens4+dPubT5NJqhauz3iwiqtX97bvchqo/kQLMGFPKrkNFhIWM8sJGpSBY+9/dz+pIC/QxLdp1QRI7UXJGTmy8g/gwQhZ/RE256939qh32hA8rCPE+02/+4P5J9uS7bxiUqYAGbzuD9fxzutbGF5rvLc5xzURdgHFBAe2ObrED6YPyHsQta4nkCTXN2xOn6hgbqMnNaIB5sMk6oZ1RyQ3aoC9WKtRniNfDUizL5A7wKvh//TIYQFCoJzLwLes0Dh78dKy6l/m8sHgLY0xnANpGwg0zcVJrOIEWhHUlTDWVLbCs7+EmVpcfa7D8eQVTBzGyDGci6JrbDudS/LEBGD08BfBvUj157mCsUCYViWyDxDhE5aaxgWJm3L/X0oCKncTotqFJBisbRXoaWGuESLHdVjKY0K3FWt6UueJzYJQ6bPL2+zMlKxa7KjoIxpnpAL3EqkgKHt88qzNgwVYG72gdDSkoXHkOY5fKLm8Y9qaEvw5gws5cyr8Ms7oFBJtP03+7NzfCwo1aNBI4xPleV4Ytc1C3pZtypun47M5967kD71cr04qokEXG/qUfBjaCEJD4GK1EtHoeIEiKIUTV1UKlOtXCiVJBoMgQx7hYqj+zHE80M4M3bPpq/0uWjokh6Ilhl8SMl3BFkHKhbaGjF/UAlgP0nYtpn6pSHSqKi41rgjxLPBVj2kUI7BNRvfo4SCTgEKN+mT87Eb/uN/162Dy7/1VtcgO/XzQWO8m2GbhbqN2cOfhK7Y0vWuKa6yAq7MlZ4CoM3X9XURAnbhn4MtUxIDKHO2RAKNbOQ1K0gM3YHKlr2oKrudABN28rNLSNkKXIDW94AQt8HCl0fIen7IjP2BxVTf6jqxxKa7mK0Z8taBHFCKBkNqCsE3XfW1rIIszfojo2kNDcgH5Cm4IU0SvLREjukKRZMJ5cxW7DUt1CAy7Bpehior1Bz5JmHPI5t1Zsi3bcz4QRBEkMGUK5AoPU61uvMROHzG8g5akjU0FRlPkBkEnoHqUjSAVmKuk5Nt3LN5MTJMGYBi/RaoAAG1FihHhiqR1WQxiJ+QGCQi1E721UULS9p324XNJnyIqyhSe0eO6c9zmYAAA==&quot;<span class="token punctuation">)</span></span>
      <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;woff2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>&quot;./font/iconfont.woff?t=1619246879033&quot;<span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;woff&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>&quot;./font/iconfont.ttf?t=1619246879033&quot;<span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;truetype&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/* chrome, firefox, opera, Safari, Android, iOS 4.2+ */</span>
      <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>&quot;./font/iconfont.svg?t=1619246879033#iconfont&quot;<span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;svg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* iOS 4.1- */</span>
<span class="token punctuation">}</span>

<span class="token selector">.iconfont</span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">&quot;iconfont&quot;</span> <span class="token important">!important</span><span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
  <span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
  <span class="token property">-webkit-font-smoothing</span><span class="token punctuation">:</span> antialiased<span class="token punctuation">;</span>
  <span class="token property">-moz-osx-font-smoothing</span><span class="token punctuation">:</span> grayscale<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.icon-fengche:before</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;\e60d&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>②使用file-loader解析这些后缀名的文件</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//使用loader</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex">/\.(eot|woff|ttf|svg)/</span><span class="token punctuation">,</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/font'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//只处理src下的font文件夹</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span> outputPath<span class="token operator">:</span> <span class="token string">'font/'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//打包到dist下的font文件夹</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>然后就可以使用对应的类名加载图标了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> App <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
<span class="token comment">//引入字体图标</span>
App<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;div class=&quot;iconfont icon-fengche&quot;&gt;&lt;/div&gt;'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="实现一个babel-loader："><a href="#实现一个babel-loader：" class="header-anchor">#</a> 实现一个babel-loader：</h3> <h4 id="步骤一："><a href="#步骤一：" class="header-anchor">#</a> 步骤一：</h4> <p>新建一个文件custom-loader/babel-loader.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//babel-loader.js</span>
<span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span><span class="token comment">//代码编写babel转换</span>
<span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token comment">//获取webpack配置中的传参</span>
<span class="token keyword">const</span> validateOptions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'schema-utils'</span><span class="token punctuation">)</span><span class="token comment">//用于验证loader配置中传的option的合法性(类似于mongoose)</span>

<span class="token keyword">function</span> <span class="token function">babel_loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//this--&gt;loaderContext（这里是使用bind去执行的这个loader）</span>
  <span class="token keyword">let</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token comment">//获取webpack配置loader时的options配置  </span>
 <span class="token comment">/* 验证传参合法性
 	let schema = { type:'object',
                properties:{
                  text:{ type:'string' },
                  filename:{ type:'string' }
                }}
   validateOptions(schema,options,'babel-loader')
 */</span>
  <span class="token keyword">let</span> cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//调用cb函数用来结束当前loader执行</span>
  babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token comment">//异步操作</span>
    <span class="token operator">...</span>options<span class="token punctuation">,</span>
    sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//开启sourcemap</span>
    filename<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//给sourcemap对应文件名</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">.</span>code<span class="token punctuation">,</span> res<span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token comment">//异步结束</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> babel_loader
</code></pre></div><h4 id="步骤二："><a href="#步骤二：" class="header-anchor">#</a> 步骤二：</h4> <p>安装@babel/core（babel提供的编程转换功能）和loader-utils（用于获取webpack中loader配置项的传参）</p> <ul><li><code>npm i -D @babel/core loader-utils</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
resolveLoader<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//配置loader存在的文件夹，默认只有node_modules</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'custom-loader'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="_3】sourcemap"><a href="#_3】sourcemap" class="header-anchor">#</a> 3】SourceMap</h2> <p><code>将dist文件夹下打包好的代码目录结构</code>和<code>源代码目录结构</code>联系起来，就是SourceMap</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//举例：比如说，在src/index.js的第一行，写了一句console.logg('下次一定！')</span>
<span class="token comment">/*很明显在打包好之后执行是有问题的，在浏览器上点开错误，我们发现是dist/bundle.js的第七行。
我们需要很快定位到源文件中代码的问题，就需要SourceMap
*/</span>
dist<span class="token operator">/</span>bundle<span class="token punctuation">.</span>js的第七行 <span class="token operator">--</span><span class="token operator">&gt;</span> src<span class="token operator">/</span>index<span class="token punctuation">.</span>js的第一行
</code></pre></div><h4 id="开启sourcemap"><a href="#开启sourcemap" class="header-anchor">#</a> 开启SourceMap</h4> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span><span class="token string">'eval-source-map'</span><span class="token punctuation">,</span><span class="token comment">//开启SourceMap代码映射，如果不使用就填false</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="配置sourcemap"><a href="#配置sourcemap" class="header-anchor">#</a> 配置SourceMap</h4> <p>这个devtool属性有很多取值，参考官网：https://v4.webpack.docschina.org/configuration/devtool/#devtool</p> <p>注意：不同的值<strong>会明显影响到构建</strong>(build)和重新构建(rebuild)的速度。</p> <p><code>SourceMapDevToolPlugin</code><em>/</em><code>EvalSourceMapDevToolPlugin</code>插件来使用sourcemap配置项更丰富。</p> <p><em>切勿同时使用</em> <code>devtool</code> <em>选项和</em> <code>SourceMapDevToolPlugin</code><em>/</em><code>EvalSourceMapDevToolPlugin</code> <em>插件</em></p> <ul><li><p>常用的配置：</p> <ul><li><p><code>eval</code>：打包是最快的。使用的是：js的eval来执行。（但是代码多了之后不是很准确）</p></li> <li><p><code>inline-source-map</code>：不会生成.map文件，而是将sourcemap放在bundle.js最后一行用<strong>base64格式储存</strong>。（<strong>完整代码</strong>映射关系）</p></li> <li><p><code>inline-cheap-source-map</code>：生成方式和👆的一样，但是这个更粗略，所以构建更快一点（<strong>行的代码映射、只会记录业务代码的映射</strong>）。</p></li> <li><p><code>inline-cheap-module-source-map</code>：生成方式和👆的一样，（<strong>也是行代码映射，但不仅会记录业务代码映射，而且会记录第三方库的代码映射</strong>）</p></li> <li><p><code>eval-cheap-module-source-map</code>：最佳实践开发的环境用这个。</p></li> <li><p><code>cheap-module-source-map</code>：生产环境用这个（线上发生错误的时候提示更全面）</p></li></ul></li></ul> <h2 id="_4】webpackdevserver"><a href="#_4】webpackdevserver" class="header-anchor">#</a> 4】WebpackDevServer</h2> <h4 id="方式一：命令行"><a href="#方式一：命令行" class="header-anchor">#</a> 方式一：命令行</h4> <p>使用webpack-cli命令行中的参数--watch，记得在HtmlWebpackPlugin插件中关掉缓存。</p> <p>弊端：每次保存代码之后，需要手动刷新浏览器（而且没有模块热更新功能）。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">//package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpacktest&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --watch&quot;</span>
  <span class="token punctuation">}</span>
  ...
<span class="token punctuation">}</span>
<span class="token comment">//webpack.config.js</span>
 new HtmlWebpackPlugin(<span class="token punctuation">{</span>
   template<span class="token operator">:</span> './src/index.html'<span class="token punctuation">,</span>
   cache<span class="token operator">:</span> <span class="token boolean">false</span><span class="token comment">//关闭缓存</span>
 <span class="token punctuation">}</span>)<span class="token punctuation">,</span>
</code></pre></div><h4 id="方式二：使用webpack-dev-server"><a href="#方式二：使用webpack-dev-server" class="header-anchor">#</a> 方式二：使用webpack-dev-server</h4> <p>优点：保存文件后会直接执行重新打包，并刷新服务器（有模块热更新、可以请求转发代理）</p> <p>分为三步：</p> <p>①安装开发者服务器</p> <p><code>npm i -D webpack-dev-server</code></p> <p>②配置webpack.config.js的devServer属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//配置告诉devServer，打包好的文件该到dist文件夹下去取</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span> contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>③使用命令行启动</p> <div class="language-bash extra-class"><pre class="language-bash"><code>webpack serve
</code></pre></div><h5 id="请求转发（反向代理）"><a href="#请求转发（反向代理）" class="header-anchor">#</a> 请求转发（反向代理）</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token comment">//配置告诉devServer，打包好的文件该到dist文件夹下去取</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span><span class="token comment">//在webpack4+该字段也可以用static</span>
    hot<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//启动热模块更新webpack-dev-server3默认不启动，4+默认启动</span>
    proxy<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//配置反向代理</span>
      <span class="token string">'/api'</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//只要是遇到域名后面是/api开头的请求都转发到target去</span>
        target<span class="token operator">:</span><span class="token string">'http://www.weshineapp.com/'</span><span class="token punctuation">,</span>
        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//将/api开头的，'/api'改成'api'</span>
          <span class="token string">'^/api'</span><span class="token operator">:</span> <span class="token string">'/api'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        changeOrigin<span class="token operator">:</span><span class="token boolean">true</span><span class="token comment">//跨域请求</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//index.js我们可以使用fetch来请求一个接口试试</span>
<span class="token comment">//其实接口地址是：http://www.weshineapp.com/api/v1/index/package/3454?offset=0&amp;limit=18</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/v1/index/package/3454?offset=0&amp;limit=18'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="hmr模块热替换"><a href="#hmr模块热替换" class="header-anchor">#</a> HMR模块热替换</h5> <p>默认是不启动热模块替换的，需要在devServer配置中加上<code>hot:true</code>。</p> <p>热替换会让页面不会进行刷新，而是<strong>会保留保存代码之前的页面运行中的状态</strong>。</p> <p>光光在devServer中配置<code>hot:true</code>，只能保证一些css代码改变之后再保存，页面的函数执行状态保留不变。（因为HMR修改css的时候使用了<code>style-loader</code>，并没有触发js文件解析，而这些状态都是JS执行产生的。css的HMR也就没有JS状态热更新麻烦）</p> <p>如果js中一个模块代码改变之后保存，想要不丢失另外的模块的状态，还需要一些深层次的配置。</p> <h6 id="js状态的hmr："><a href="#js状态的hmr：" class="header-anchor">#</a> JS状态的HMR：</h6> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*举个栗子：
一个模块中依赖了两个子组件，此时我们在页面上可以点击module1组件进行计数。
再修改module2的值，保存代码，会发现HMR丢失了module1的状态*/</span>

<span class="token comment">//index.js</span>
<span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">'./module/module1.js'</span>
<span class="token keyword">import</span> module2 <span class="token keyword">from</span> <span class="token string">'./module/module2.js'</span>
<span class="token comment">//加载模块一和模块二（js的HMR）</span>
<span class="token function">module1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">module2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//module/module1.js</span>
<span class="token keyword">function</span> <span class="token function">module1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Div<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token number">0</span>
  Div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'module1'</span><span class="token punctuation">)</span>
  Div<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Div<span class="token punctuation">.</span>innerText<span class="token operator">++</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>Div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> module1

<span class="token comment">//module/module2.js</span>
<span class="token keyword">function</span> <span class="token function">module2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'module2'</span><span class="token punctuation">)</span>
  Div<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token number">3000</span><span class="token comment">//触发点击改变了module1的状态，再修改module2的状态，保存代码，会发现HMR丢失了module1的状态</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>Div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> module2
</code></pre></div><p>此时如果我们想要实现更改module2的代码，但是module1中的执行状态不改变，就需要使用module.hot进行拦截一下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//index.js</span>
<span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">'./module/module1.js'</span>
<span class="token keyword">import</span> module2 <span class="token keyword">from</span> <span class="token string">'./module/module2.js'</span>

<span class="token comment">//HMR拦截</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//但我们接收到module2.js代码改变时做出拦截，只会执行回调中的代码，不进行其他刷新</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./module/module2.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//将之前的dom删除</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'module2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">module2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//重新执行module2.js</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//加载模块一和模块二（js的HMR）</span>
<span class="token function">module1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">module2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_5】plugin"><a href="#_5】plugin" class="header-anchor">#</a> 5】plugin</h2> <h3 id="常用plugin"><a href="#常用plugin" class="header-anchor">#</a> 常用plugin</h3> <p>总结一句话就是：插件可以在webpack运行在某个阶段（生命周期）做一些事情。</p> <p>比如：html-webpack-plugin就是在打包结束的时候，将打包好的js文件引用到指定模板html文件中。</p> <p>再比如： clean-webpack-plugin就是在刚开始webpack启动的时候，将dist文件夹清空。</p> <p>TerserPlugin：首先了解下 webpack 中用于代码删除和压缩的一个插件，TerserPlugin。 Webpack4.0 默认使用 terser-webpack-plugin 压缩插件，在此之前是使用 uglifyjs-webpack-plugin，其中的区别是内置对 ES6 的压缩不是很好，同时我们可以打开 parallel 参数，使用多进程压缩，加快压缩。也可以使用cache加快构建速度。</p> <p>webpack-bundle-analyzer可视化分析打包大小。</p> <p>mini-css-extract-plugin是用来单独打包css，用法如下</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name].[chunkhash:8].css&quot;</span><span class="token punctuation">,</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">&quot;[id].css&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
      MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span><span class="token comment">//这里就不使用'style-loader'，因为我们不需要使用style标签，自动使用link标签链接打包好的css</span>
      <span class="token string">&quot;css-loader&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="手写plugin"><a href="#手写plugin" class="header-anchor">#</a> 手写plugin</h3> <p>在webpack的npm依赖包中可以找到一个名叫Compiler.js的文件，里面有所所有的钩子。</p> <p><a href="https://webpack.docschina.org/api/compiler-hooks/" target="_blank" rel="noopener noreferrer">webpack提供了很多钩子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这里简单介绍几个：</p> <ul><li>entryOption : 在 webpack 选项中的 entry 配置项 处理过之后，执行插件。</li> <li>afterPlugins : 设置完初始插件之后，执行插件。</li> <li>compilation : 编译创建之后，生成文件之前，执行插件。。</li> <li>emit : 生成资源到 output 目录之前。</li> <li>done : 编译完成。</li></ul> <p>在 <code>compiler.hooks</code> 下指定事件钩子函数，便会触发钩子时，执行回调函数。
Webpack 提供<a href="https://blog.csdn.net/qq_36380426/article/details/104471422" target="_blank" rel="noopener noreferrer">三种触发钩子的方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <ul><li><code>tap</code> ：以<strong>同步方式</strong>触发钩子；
<ul><li>回调方式:<code>(compilation)=&gt;{}</code></li> <li>同步执行。</li></ul></li> <li><code>tapAsync</code> ：以<strong>异步方式</strong>触发钩子；
<ul><li>回调方式:<code>(compilation,end)=&gt;{end()}</code></li> <li>必须使用第二个参数来执行，结束该回调，webpack才能继续执行。</li></ul></li> <li><code>tapPromise</code> ：以<strong>异步方式</strong>触发钩子，返回 Promise；
<ul><li>回调方式:<code>(compilation)=&gt;Promise</code></li> <li>必须使用Promise提供的resolve或者reject才能结束回调，webpack才能继续。</li></ul></li></ul> <h4 id="①同步触发"><a href="#①同步触发" class="header-anchor">#</a> ①同步触发</h4> <p>需要在我们写的插件的类中写一个原型方法apply并传入一个上下文形参。</p> <p>因为在在webpack过程中，使用我们插件的时候，会调用执行插件原型上的apply方法，并将上下文实体传入。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//CustomPlugin.js</span>
<span class="token keyword">class</span> <span class="token class-name">CustomPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//compiler.hooks</span>
    <span class="token comment">//调用我们需要使用的钩子，并写入回调</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'Hello Custom Plugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
      compilation <span class="token comment">/* 在 hook 被触及时，会将 compilation 作为参数传入。 */</span>
    <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello Custom Plugin!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> CustomPlugin

<span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> CustomPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'CustomPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token comment">//传入的是插件实例</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CustomPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="②异步触发钩子"><a href="#②异步触发钩子" class="header-anchor">#</a> ②异步触发钩子</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">AsyncPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//compiler.hooks</span>
    <span class="token comment">//下面是指：异步调用compiler的emit钩子</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'AsyncPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'开始第一次等待~~~~~~~~'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第一次等待结束~~~~~~~~'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//下面是指：异步promise调用compiler的emit钩子</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'AsyncPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'开始第二次等待~~~~~~~~'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第二次等待结束~~~~~~~~'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> AsyncPlugin

<span class="token comment">/*此时执行的打包会在控制台输出一下内容：
开始第一次等待~~~~~~~~ 2021-05-01T04:18:57.491Z
第一次等待结束~~~~~~~~ 2021-05-01T04:19:00.495Z
开始第二次等待~~~~~~~~ 2021-05-01T04:19:00.496Z
第二次等待结束~~~~~~~~ 2021-05-01T04:19:03.499Z
编译完成~~~~
....
webpack 5.35.0 compiled successfully in 7078 ms
*/</span>
</code></pre></div><h3 id="filelistplugin"><a href="#filelistplugin" class="header-anchor">#</a> <a href="https://www.bilibili.com/video/BV1QE411M7sj?p=53" target="_blank" rel="noopener noreferrer">FileListPlugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>首先明确需求，我们想要获取webpack打包好的各文件的名字和大小，然后创建一个md格式的文件并输出。结果预览：以下是打包出来的list.md文件</p> <div class="language-md extra-class"><pre class="language-md"><code><span class="token title important"><span class="token punctuation">##</span> 文件名    资源大小</span>
<span class="token list punctuation">-</span> lazyLoad<span class="token italic"><span class="token punctuation">_</span><span class="token content">e5d002d4cb2150bdd8ce.bundle.js    13544
- src</span><span class="token punctuation">_</span></span>module<span class="token italic"><span class="token punctuation">_</span><span class="token content">module1</span><span class="token punctuation">_</span></span>js_e5d002d4cb2150bdd8ce.bundle.js    2243
<span class="token list punctuation">-</span> index.html    426
</code></pre></div><p>我们先来看看该怎么用我们写的这个插件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> FileListPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'FileListPlugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">FileListPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span><span class="token string">'list.md'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>开始写代码FileListPlugin.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">FileListPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> filename <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>filename <span class="token operator">=</span> filename
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//webpack会调用apply</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token comment">//同步处理。不需要结束回调</span>
      <span class="token string">'FileListPlugin'</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//我们需要使用assets资源对象获取打包好的文件明细</span>
        <span class="token keyword">const</span> assets <span class="token operator">=</span> compilation<span class="token punctuation">.</span>assets
        <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">## 文件名    资源大小\n</span><span class="token template-punctuation string">`</span></span>
        Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>filename<span class="token punctuation">,</span> statObj<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//获取文件名和对应文件的大小</span>
          content <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>statObj<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">//这样使用source和size就可以写入内容到相应文件</span>
        assets<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> content <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> content<span class="token punctuation">.</span>length <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FileListPlugin
</code></pre></div><h3 id="inlinesourceplugin"><a href="#inlinesourceplugin" class="header-anchor">#</a> <a href="https://www.bilibili.com/video/BV1QE411M7sj?p=54" target="_blank" rel="noopener noreferrer">InlineSourcePlugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>首先明确需求：常规的操作是使用html-webpack-plugin将打包好的js文件以外链src的形式导入html，css文件也是使用Link外链的形式去导入；而我们现在的需求是要把打包好的<strong>js文件内容和css文件内容</strong>直接以script和style标签的形式插到html中。</p> <p>需要配合html-webpack-plugin一起使用，因为需要使用到<a href="https://github.com/jantimon/html-webpack-plugin#events" target="_blank" rel="noopener noreferrer">html-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的钩子api对HtmlWebpackPlugin执行过程进行处理。（这里注意使用alterAssetTagGroups钩子，<strong>把使用了HtmlWebpackPlugin插件且即将插入html的标签都进行预处理一下</strong>，同时也可以将外链的文件放到<strong>cdn进行打包优化</strong>）</p> <p>还是我们先看下该怎么用这个插件再去写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> InlineSourcePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'InlineSourcePlugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">InlineSourcePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">/*需要传入一个正则，判断需要修改的标签中外链文件的后缀，
      因为也有可能link一些json等文件到html中，
      目的是处理外链文件是.js结尾的script标签和外链文件是.css结尾的link标签*/</span>
      match<span class="token operator">:</span> <span class="token regex">/\.(js|css)/</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>具体实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 首先明确需求：
 * 常规的操作是使用html-webpack-plugin将打包好的js文件以外链src的形式导入html，css文件也是使用Link外链的形式去导入；
 * 而我们现在的需求是要把打包好的js文件内容和css文件内容直接以script和style标签的形式插到html中。
 */</span>
<span class="token keyword">class</span> <span class="token class-name">InlineSourcePlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> match <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//需要传入一个正则，判断需要内联的文件类型</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>regex <span class="token operator">=</span> match
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//需要使用到HtmlWebpackPlugin的钩子api对HtmlWebpackPlugin执行过程进行处理。</span>
    <span class="token comment">//1.首先把webpack执行上下文compilation暴露给HtmlWebpackPlugin使用</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'InlineSourcePlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//2.使用HtmlWebpackPlugin提供的hooks api进行处理</span>
      <span class="token comment">//https://github.com/jantimon/html-webpack-plugin#events</span>
      <span class="token comment">//此时我们用到的是alterAssetTagGroups（修改插入标签组到html的时候的钩子）</span>
      HtmlWebpackPlugin<span class="token punctuation">.</span><span class="token function">getHooks</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">.</span>alterAssetTagGroups<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
        <span class="token string">'alterPlugin'</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// console.log(data)//打印出来的重要内容是，将要经HtmlWebpackPlugin处理插入html的标签信息</span>
          <span class="token comment">//需要写一个方法来处理标签并返回处理结果</span>
          data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processTags</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> compilation<span class="token punctuation">)</span>
          <span class="token comment">//成功之后把处理结果，以回调的方式返回去</span>
          <span class="token function">end</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//外链资源的标签处理成内联的形式（标签+内容）</span>
  <span class="token function">processTags</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> compilation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> headTags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> bodyTags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">//需要将要处理的项的记过分别存到数组中，最后一起返回</span>
    data<span class="token punctuation">.</span>headTags<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      headTags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleTag</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> compilation<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>bodyTags<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      bodyTags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleTag</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> compilation<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>data<span class="token punctuation">,</span> headTags<span class="token punctuation">,</span> bodyTags <span class="token punctuation">}</span><span class="token comment">//将处理结果返回</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//正式处理标签</span>
  <span class="token function">handleTag</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> compilation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*console.log(tag)//打印一下即将插入的标签对象，然后就可以开始安找自己的需求进行处理。
    {
      tagName: 'script',
      voidTag: false,
      meta: { plugin: 'html-webpack-plugin' },
      attributes: { defer: true, src: 'index_d187911761f8039b458f.bundle.js' }
    }
    {
      tagName: 'link',
      voidTag: true,
      meta: { plugin: 'html-webpack-plugin' },
      attributes: { href: 'index.70ae7073.css', rel: 'stylesheet' }
    }*/</span>
    <span class="token keyword">let</span> newTag <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>tag <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> url<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tag<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">'link'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>regex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tag<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//处理外链文件是.css结尾的link标签</span>
      newTag <span class="token operator">=</span> <span class="token punctuation">{</span>
        tagName<span class="token operator">:</span> <span class="token string">'style'</span><span class="token punctuation">,</span>
        voidTag<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text/css'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      url <span class="token operator">=</span> tag<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>href
      <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//使用compilation上下文的资源对象获取打包好的文件，然后写入到style标签的innerHTML属性上</span>
        newTag<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">delete</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token comment">//将原来将要打包生成的文件删除掉，因为内容已经放到了html的标签中</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>tag<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">'script'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>regex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tag<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//处理外链文件是.js结尾的script标签</span>
      newTag <span class="token operator">=</span> <span class="token punctuation">{</span>
        tagName<span class="token operator">:</span> <span class="token string">'script'</span><span class="token punctuation">,</span>
        voidTag<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'application/javascript'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      url <span class="token operator">=</span> tag<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>src
      <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//使用compilation上下文的资源对象获取打包好的文件，然后写入到script标签的innerHTML属性上</span>
        newTag<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">delete</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token comment">//将原来将要打包生成的文件删除掉，因为内容已经放到了html的标签中</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newTag<span class="token comment">//返回修改后的新标签</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> InlineSourcePlugin
</code></pre></div><p>可以用这个来实现资源打包到cdn，然后再插入标签，优化打包。</p> <h3 id="uploadplugin"><a href="#uploadplugin" class="header-anchor">#</a> <a href="https://www.bilibili.com/video/BV1QE411M7sj?p=55&amp;spm_id_from=pageDriver" target="_blank" rel="noopener noreferrer">UploadPlugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>需求：使用UploadPlugin可以将打包好的文件上传到cdn或oss上面，从而实现自动发布。</p> <p>还是先来看看该怎么使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> UploadPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'UploadPlugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token comment">//添加src时，的根路径比如现在就是src='http://cdn.xxx.com/[name].bundle.js'</span>
    publicPath<span class="token operator">:</span> <span class="token string">'http://cdn.xxx.com/'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token comment">//需要传入一些oss、cdn相关的对象存储配置项</span>
    <span class="token keyword">new</span> <span class="token class-name">UploadPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      region<span class="token operator">:</span> <span class="token string">'oss-cn-chengdu'</span><span class="token punctuation">,</span>
      accessKeyId<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      accessKeySecret<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      bucket<span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">UploadPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
    <span class="token comment">/*
    一般会去执行注册一些上传相关的sdk。
    */</span>
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//compiler是webpack提供的执行上下文，里面有钩子</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>afterEmit<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'UploadPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//我们需要去拿到打包好的文件，然后才能去上传</span>
      <span class="token keyword">let</span> assets <span class="token operator">=</span> compilation<span class="token punctuation">.</span>assets
      <span class="token comment">/*console.log(assets)
        {
          'index.6c0f3869.css': SizeOnlySource { _size: 2045 },
          'index_026f604ab272c4366956.bundle.js': SizeOnlySource { _size: 13811 },
          'index.html': SizeOnlySource { _size: 472 }
        }*/</span>
      <span class="token keyword">let</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">filename</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Upload</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">//这里使用Promise.all来处理多文件上传</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">Upload</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//拿到打包好的本地文件，然后才能正常去上传</span>
      <span class="token keyword">let</span> localFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
      <span class="token comment">/*
      ...上传oss服务器的代码,这里就主要实现一下，从webpack钩子上下文中拿打包好的文件。
      */</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'upload success!!!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//上传文件之前，我们在webpack.config.js的output项中设置publicPath到cdn就好了。</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UploadPlugin
</code></pre></div><h2 id="_6】webpack打包优化"><a href="#_6】webpack打包优化" class="header-anchor">#</a> 6】webpack打包优化</h2> <p>webpack可以做什么？代码转换、文件优化、代码分割、模块合并、模块热替换、代码校验、自动发布。</p> <h3 id="原理分析："><a href="#原理分析：" class="header-anchor">#</a> 原理分析：</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//theory_analysis.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//dist/bundle.js打包出来的结果</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> __webpack_modules__ <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;./src/theory_analysis.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;console.log('Hello');&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> __webpack_exports__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  __webpack_modules__<span class="token punctuation">[</span><span class="token string">&quot;./src/theory_analysis.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="webpack自带的优化："><a href="#webpack自带的优化：" class="header-anchor">#</a> webpack自带的优化：</h3> <h4 id="_1、tree-sharking"><a href="#_1、tree-sharking" class="header-anchor">#</a> 1、tree-sharking</h4> <p>依赖关系的解析（不用的代码不打包）<strong>webpack的生产环境才会使用tree-sharking</strong>。</p> <h4 id="_2、scope-hoisting"><a href="#_2、scope-hoisting" class="header-anchor">#</a> 2、scope-hoisting</h4> <p>作用域提升（定义的变量或者常量，如果不传入函数计算，都不打包到结果中，而是直接使用定义的常量）</p> <h3 id="速度的优化："><a href="#速度的优化：" class="header-anchor">#</a> 速度的优化：</h3> <h4 id="_1、happypack"><a href="#_1、happypack" class="header-anchor">#</a> 1、happypack</h4> <p>多线程打包（注意体积比较小的时候，打包比较慢）</p> <h4 id="_2、dll动态链接库"><a href="#_2、dll动态链接库" class="header-anchor">#</a> 2、<a href="https://blog.csdn.net/u012987546/article/details/100580745" target="_blank" rel="noopener noreferrer">Dll动态链接库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>拆一些公共的文件：react/react-dom/vue/jQuery，单独打包到一个文件。最后将这个文件放在cdn上。（也可以在开发时使用dll，链接库只需要被构建一次，大大提升项目构建效率）</p> <p>主要使用两个webpack内置的插件：<strong>DllPlugin</strong>、<strong>DllReferencePlugin</strong></p> <ul><li>DllPlugin：生成动态链接库dll的插件。（在打包比较大的公共框架（比如react、vue、jQuery）文件的webpack打包配置文件中使用）</li> <li>DllReferencePlugin：用来在项目中引用动态链接库的插件（在构建项目的webpack打包配置文件中使用）</li></ul> <h5 id="步骤一：-2"><a href="#步骤一：-2" class="header-anchor">#</a> 步骤一：</h5> <p>单独启webpack配置文件打包动态链接库。我们在项目根目录下创建一个<code>webpack_dll.config.js</code>文件（用于打包生成动态链接库），会用到DllPlugin插件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack_dll.config.js</span>
<span class="token comment">//单独打包react用动态链接库Dll</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/*把项目需要所有的 react 相关的放到一个单独的动态链接库
      又例如：vue: ['vue', 'vuex', 'vue-router'],
      jquery: ['jQuery']*/</span>
    react<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'react-dom'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span><span class="token comment">//打包后的文件名称</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//输出到的文件夹</span>
    library<span class="token operator">:</span> <span class="token string">'_dll_[name]'</span><span class="token comment">//存放动态链接库的全局变量名称，加上_dll_是为了防止全局变量冲突</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">//使用webpack内置的生成动态链接库dll的插件（会生成两个文件，一个是打包好的库代码，另一个是映射文件）</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">/*动态链接库的全局变量名称，需要和 output.library 中保持一致
        该字段的值也就是输出的 manifest.json 文件 中 name 字段的值
        例如 react.manifest.json 中就有 &quot;name&quot;: &quot;_dll_react&quot;*/</span>
      name<span class="token operator">:</span> <span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span>
      <span class="token comment">// 描述动态链接库的 manifest.json 文件输出时的文件名称</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll'</span><span class="token punctuation">,</span> <span class="token string">'[name].manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="步骤二：-2"><a href="#步骤二：-2" class="header-anchor">#</a> 步骤二：</h5> <p>此时，我们为了方便，需要在<code>package.json</code>中创建打包动态链接库的脚本命令：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpacktest&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack.config.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		...
    <span class="token property">&quot;dll&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode development --config webpack_dll.config.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><p>此时我们就可以执行命令<code>npm run dll</code>，将动态链接库打包好了。并输出到dll文件夹下，生成了两个文件<code>react.dll.js</code>（打包的库代码）和<code>react.manifest.json</code>（动态链接映射文件）（这个打包好的动态链接库可以放到cdn上进行优化）</p> <h5 id="步骤三："><a href="#步骤三：" class="header-anchor">#</a> 步骤三：</h5> <p>在html文件中以script标签的形式<strong>手动插入动态链接库</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>webpack测试打包<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 库文件必须要放在最前面 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>../dll/react.dll.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>theory_analysis_38a7916d0fdc58ecb1c9.bundle.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>头像<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这时候还不行，因为虽然我们这样引入了动态链接库，但是bundle.js打包出来的代码还不知道该怎么去使用这个动态链接库，所以还得在项目打包的时候进行使用DllReferencePlugin</p> <h5 id="步骤四："><a href="#步骤四：" class="header-anchor">#</a> 步骤四：</h5> <p>项目webpack配置中使用DllReferencePlugin进行引用库。使用了这个插件，webpack打包的时候就优先会去使用dll动态链接库中的变量，不会再去react这些框架了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token comment">//生成一个html模板</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">//启动时清空dist文件夹</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//入口</span>
    theory_analysis<span class="token operator">:</span> <span class="token string">'./src/theory_analysis.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_[hash].bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token comment">//打包到的文件夹</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token comment">//使用插件</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
      cache<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//引用动态链接库的插件(告诉webpack我们用了哪些动态链接库，该怎么使用这些dll)</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">//需要找到生成的dll动态链接库的manifest映射文件</span>
      manifest<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll'</span><span class="token punctuation">,</span> <span class="token string">'react.manifest.json'</span><span class="token punctuation">)</span>
      <span class="token comment">//manifest: require('./dll/react.manifest.json'),//这样也可以</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这是我打包的js文件，使用了react和react-dom</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">//theory_analysis.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">这是react-app</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_3、externals配置项忽略打包"><a href="#_3、externals配置项忽略打包" class="header-anchor">#</a> 3、Externals配置项忽略打包</h4> <p>当在webpack.config.js中配置Externals 项时，Externals 项用来告诉 Webpack 构建时代码中使用了哪些不用被打包的模块。Externals可以对某一个第三方框架 或者 库<strong>放到运行环境的全局变量中</strong>。例如：vue放到到运行环境的全局变量中 或者 vuex放到到运行环境的全局变量中。</p> <h3 id="体积的优化："><a href="#体积的优化：" class="header-anchor">#</a> 体积的优化：</h3> <h4 id="_1、webpack-ignoreplugin"><a href="#_1、webpack-ignoreplugin" class="header-anchor">#</a> 1、webpack.IgnorePlugin()</h4> <p>忽略不用的国际化语言包。</p> <p>典型：moment.js</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span><span class="token punctuation">[</span>
  <span class="token operator">...</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token regex">/\.\/locale/</span><span class="token punctuation">,</span><span class="token regex">/moment/</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="_2、抽离公共代码块"><a href="#_2、抽离公共代码块" class="header-anchor">#</a> 2、抽离公共代码块</h4> <p>optimization配置项中的splitChunks分割代码块</p> <p>一般多个入口打包才使用抽离公共代码块（将以已打包好的代码进行抽离）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  entry<span class="token operator">:</span><span class="token punctuation">{</span>
    index<span class="token operator">:</span><span class="token string">'./src/index.js'</span>
    other<span class="token operator">:</span><span class="token string">'./src/other.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//优化</span>
  	splitChunks<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//分割代码块（将以已打包好的代码进行抽离）</span>
  		cacheGroup<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//缓存组</span>
  			common<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//缓存组的名称叫common</span>
  				chunks<span class="token operator">:</span><span class="token string">'initial'</span><span class="token punctuation">,</span><span class="token comment">//定义什么时候进行抽离，刚开始就开始抽离</span>
  				minSize<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//代码块最小多大，才开始提取</span>
  				minChunks<span class="token operator">:</span><span class="token number">2</span><span class="token comment">//代码块最少公用过多少次的代码才进行提取</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
  			vendor<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//第三方库文件单独进行抽离，定义名称叫vendor</span>
          priority<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">//定义权重，先抽离第三方库文件，再去抽离其他的文件</span>
          test<span class="token operator">:</span><span class="token regex">/node_modules/</span><span class="token punctuation">,</span><span class="token comment">//只去把node_module中使用过的代码抽离出来</span>
          chunks<span class="token operator">:</span><span class="token string">'initial'</span><span class="token punctuation">,</span><span class="token comment">//也是刚开始的时候进行抽离</span>
          minSize<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
          minChunks<span class="token operator">:</span><span class="token number">2</span>
        <span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="懒加载模块（按需加载）"><a href="#懒加载模块（按需加载）" class="header-anchor">#</a> 懒加载模块（按需加载）</h3> <p>webpack提供按需动态加载，使用import语法（ajax来实现的）（或者<code>require.ensure</code>也可以动态加载）</p> <p>使用import语法动态导入，webpack会将该文件单独打包。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//index.js</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./source.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//es6草案中的语法，ajax实现</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//source.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'Hello'</span>
</code></pre></div><p>import语法懒加载原理：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//模块：file.js</span>
<span class="token keyword">function</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getUsefulContents</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getJSON</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//主程序：main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getUsefulContents <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'/modules/file.js'</span><span class="token punctuation">;</span>
<span class="token function">getUsefulContents</span><span class="token punctuation">(</span><span class="token string">'http://www.example.com'</span><span class="token punctuation">,</span>
    <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">doSomethingUseful</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="react懒加载"><a href="#react懒加载" class="header-anchor">#</a> <a href="https://www.cnblogs.com/xgqfrms/p/13820944.html" target="_blank" rel="noopener noreferrer">React懒加载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>React中可以使用lazy来实现懒加载组件。</p> <p>React.lazy 函数让你可以可以像导入将常规组件一样的渲染一个动态导入。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> OtherComponent <span class="token keyword">from</span> <span class="token string">'./OtherComponent'</span><span class="token punctuation">;</span>
<span class="token comment">// React.lazy</span>
<span class="token keyword">const</span> OtherComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./OtherComponent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>首次呈现此组件时，它将自动加载包含OtherComponent的捆绑包。</p> <p>React.lazy 采用了必须调用动态 import（）的函数。
这必须返回一个 Promise，该 Promise 解析为一个带有默认导出的模块，该模块包含一个 React组件。</p> <p>然后，应该将懒惰的组件呈现在Suspense组件中，这使我们可以在等待懒惰的组件加载时显示一些后备内容（例如加载指示符）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> OtherComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./OtherComponent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>OtherComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>fallback prop 支持在等待组件加载时接受要渲染的任何React元素</p> <p>您可以将 Suspense 组件放置在 lazy 组件上方的任何位置</p> <p>您甚至可以用一个 Suspense 组件包装多个惰性组件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> OtherComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./OtherComponent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> AnotherComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./AnotherComponent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>section<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>OtherComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>AnotherComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7】resolve配置"><a href="#_7】resolve配置" class="header-anchor">#</a> 7】<a href="https://www.cnblogs.com/pingan8787/p/11838067.html" target="_blank" rel="noopener noreferrer">resolve配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <div class="language-js extra-class"><pre class="language-js"><code> resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
   extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.tsx'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//不需要写后缀名，按顺序去找文件</span>
     alias<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//别名</span>
       <span class="token string">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
       modules<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">]</span>
   <span class="token comment">//告诉 webpack 解析模块时应该搜索的目录，即 require 或 import 模块的时候，只写模块名的时候，到哪里去找，其属性值为数组，因为可配置多个模块搜索路径，其搜索路径必须为绝对路径，</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="_8】localstorage缓存js实践"><a href="#_8】localstorage缓存js实践" class="header-anchor">#</a> 8】localStorage缓存js实践</h2> <p><img src="https://img-blog.csdnimg.cn/20210502193207855.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIyMTAzNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>思路:</p> <ol><li>js包都不以script标签的形式插入到html中，而是需要以dom的形式动态设置script，并写入脚本。</li> <li>判断bundle缓存是否过期：使用htmlwebpackplugin打包时不插入script标签，而是插入<div>z89e0af6.bundle.js</div>但是不让它显示。（我们需要手动写插件进行拦截）</li> <li>在index.html中写脚本进行判断。</li></ol> <h3 id="dll打包"><a href="#dll打包" class="header-anchor">#</a> dll打包</h3> <p>dll打包这里就不多说了。</p> <h3 id="bundlenameplugin"><a href="#bundlenameplugin" class="header-anchor">#</a> BundleNamePlugin</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">BundleNamePlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'BundleNamePlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      HtmlWebpackPlugin<span class="token punctuation">.</span><span class="token function">getHooks</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">.</span>alterAssetTagGroups<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
        <span class="token string">'alterPlugin'</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processTags</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> compilation<span class="token punctuation">)</span>
          <span class="token function">end</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">processTags</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> compilation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//data是htmlwebpackplugin要插入（等操作）的标签信息</span>
    <span class="token keyword">let</span> bodyTags <span class="token operator">=</span> data<span class="token punctuation">.</span>bodyTags
    <span class="token comment">//将bundlejsName插入到html中</span>
    <span class="token keyword">let</span> newTag <span class="token operator">=</span> <span class="token punctuation">{</span>
      tagName<span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
      voidTag<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      attributes<span class="token operator">:</span> <span class="token punctuation">{</span> style<span class="token operator">:</span> <span class="token string">'display:none'</span><span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token string">&quot;bundleName&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> bundleName
    data<span class="token punctuation">.</span>headTags<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">'script'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bundleName <span class="token operator">=</span> item<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>src
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    newTag<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> bundleName
    bodyTags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newTag<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>data<span class="token punctuation">,</span> bodyTags<span class="token punctuation">,</span> headTags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//本来要插入bundlejs的script标签,这里就把headerTags置空，不插入</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> BundleNamePlugin
</code></pre></div><h3 id="缓存判断脚本"><a href="#缓存判断脚本" class="header-anchor">#</a> 缓存判断脚本</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>雷浩简历<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>shortcut icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/x-icon<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://personal-financ.oss-cn-chengdu.aliyuncs.com/cdn/111.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>none</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bundleName<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    /z89e0af6.bundle.js
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">//判断本地是否有dll（dll的都是依赖包，不会变的不需要设置hash名）</span>
  <span class="token keyword">var</span> ReactDll <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'react.dll.js'</span><span class="token punctuation">)</span>
  <span class="token comment">//从div中获取bundle的hash文件名（需要打包的时候提前植入html中）</span>
  <span class="token keyword">var</span> bundleName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'bundleName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
  <span class="token comment">//判断本地是否有Bundle</span>
  <span class="token keyword">var</span> Bundle <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token function">getFilename</span><span class="token punctuation">(</span>bundleName<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">//bundle的缓存过期则移除</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token function">getFilename</span><span class="token punctuation">(</span>bundleName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token function">hasBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ReactDll<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//reactDll有缓存</span>
    <span class="token function">eval</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> ReactDll<span class="token punctuation">)</span><span class="token comment">//执行缓存函数必须挂载到全局，否则会被垃圾回收</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">getFilename</span><span class="token punctuation">(</span>bundleName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//Bundle没过期</span>
      <span class="token function">eval</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> Bundle<span class="token punctuation">)</span><span class="token comment">//执行缓存函数必须挂载到全局，否则会被垃圾回收</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">//Bundle过期</span>
      <span class="token function">cacheBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">//否则都不用缓存</span>
    <span class="token function">cacheReactDll</span><span class="token punctuation">(</span>cacheBundle<span class="token punctuation">)</span><span class="token comment">//一定要用回调，因为Bundle依赖于Dll，必须先执行Dll，否则报错</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//第一次获取并缓存Dll</span>
  <span class="token keyword">function</span> <span class="token function">cacheReactDll</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">FetchFile</span><span class="token punctuation">(</span><span class="token string">'https://personal-financ.oss-cn-chengdu.aliyuncs.com/cdn/react.dll.js'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//第一次获取并缓存Bundle</span>
  <span class="token keyword">function</span> <span class="token function">cacheBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">FetchFile</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href <span class="token operator">+</span> <span class="token function">getFilename</span><span class="token punctuation">(</span>bundleName<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//首次获取资源js文件,并写入到localstorage</span>
  <span class="token keyword">function</span> <span class="token function">FetchFile</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">myBlob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
          script<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> reader<span class="token punctuation">.</span>result
          script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/javascript'</span><span class="token punctuation">;</span>
          document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>
          window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token function">getFilename</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span> reader<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
          cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>myBlob<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//通过url获取文件名</span>
  <span class="token keyword">function</span> <span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> temp <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> temp<span class="token punctuation">[</span>temp<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//判断本地是有有bundle，并返回文件名</span>
  <span class="token keyword">function</span> <span class="token function">hasBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'bundle'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>参考视频：</p> <p>https://www.bilibili.com/video/BV12a4y1W76V</p> <p>https://www.bilibili.com/video/BV1eC4y147RX</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/1/2021, 1:43:20 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.27102bc9.js" defer></script><script src="/assets/js/2.8dfe8e5f.js" defer></script><script src="/assets/js/48.5d4fb10f.js" defer></script>
  </body>
</html>
